(()=>{var Ce=Object.create;var dt=Object.defineProperty;var xe=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Se=Object.getPrototypeOf,Te=Object.prototype.hasOwnProperty;var ke=(E,t,a)=>t in E?dt(E,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):E[t]=a;var Le=E=>dt(E,"__esModule",{value:!0});var Et=(E,t)=>()=>(t||E((t={exports:{}}).exports,t),t.exports);var De=(E,t,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let h of Ee(t))!Te.call(E,h)&&h!=="default"&&dt(E,h,{get:()=>t[h],enumerable:!(a=xe(t,h))||a.enumerable});return E},St=E=>De(Le(dt(E!=null?Ce(Se(E)):{},"default",E&&E.__esModule&&"default"in E?{get:()=>E.default,enumerable:!0}:{value:E,enumerable:!0})),E);var Q=(E,t,a)=>(ke(E,typeof t!="symbol"?t+"":t,a),a);var jt=Et((pt,Ft)=>{(function(E,t){typeof pt=="object"&&typeof Ft!="undefined"?t(pt):typeof define=="function"&&define.amd?define(["exports"],t):t(E.ActiveStorage={})})(pt,function(E){"use strict";function t(D,M){return M={exports:{}},D(M,M.exports),M.exports}var a=t(function(D,M){(function(F){D.exports=F()})(function(F){var W=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function V(U,j){var R=U[0],L=U[1],_=U[2],B=U[3];R+=(L&_|~L&B)+j[0]-680876936|0,R=(R<<7|R>>>25)+L|0,B+=(R&L|~R&_)+j[1]-389564586|0,B=(B<<12|B>>>20)+R|0,_+=(B&R|~B&L)+j[2]+606105819|0,_=(_<<17|_>>>15)+B|0,L+=(_&B|~_&R)+j[3]-1044525330|0,L=(L<<22|L>>>10)+_|0,R+=(L&_|~L&B)+j[4]-176418897|0,R=(R<<7|R>>>25)+L|0,B+=(R&L|~R&_)+j[5]+1200080426|0,B=(B<<12|B>>>20)+R|0,_+=(B&R|~B&L)+j[6]-1473231341|0,_=(_<<17|_>>>15)+B|0,L+=(_&B|~_&R)+j[7]-45705983|0,L=(L<<22|L>>>10)+_|0,R+=(L&_|~L&B)+j[8]+1770035416|0,R=(R<<7|R>>>25)+L|0,B+=(R&L|~R&_)+j[9]-1958414417|0,B=(B<<12|B>>>20)+R|0,_+=(B&R|~B&L)+j[10]-42063|0,_=(_<<17|_>>>15)+B|0,L+=(_&B|~_&R)+j[11]-1990404162|0,L=(L<<22|L>>>10)+_|0,R+=(L&_|~L&B)+j[12]+1804603682|0,R=(R<<7|R>>>25)+L|0,B+=(R&L|~R&_)+j[13]-40341101|0,B=(B<<12|B>>>20)+R|0,_+=(B&R|~B&L)+j[14]-1502002290|0,_=(_<<17|_>>>15)+B|0,L+=(_&B|~_&R)+j[15]+1236535329|0,L=(L<<22|L>>>10)+_|0,R+=(L&B|_&~B)+j[1]-165796510|0,R=(R<<5|R>>>27)+L|0,B+=(R&_|L&~_)+j[6]-1069501632|0,B=(B<<9|B>>>23)+R|0,_+=(B&L|R&~L)+j[11]+643717713|0,_=(_<<14|_>>>18)+B|0,L+=(_&R|B&~R)+j[0]-373897302|0,L=(L<<20|L>>>12)+_|0,R+=(L&B|_&~B)+j[5]-701558691|0,R=(R<<5|R>>>27)+L|0,B+=(R&_|L&~_)+j[10]+38016083|0,B=(B<<9|B>>>23)+R|0,_+=(B&L|R&~L)+j[15]-660478335|0,_=(_<<14|_>>>18)+B|0,L+=(_&R|B&~R)+j[4]-405537848|0,L=(L<<20|L>>>12)+_|0,R+=(L&B|_&~B)+j[9]+568446438|0,R=(R<<5|R>>>27)+L|0,B+=(R&_|L&~_)+j[14]-1019803690|0,B=(B<<9|B>>>23)+R|0,_+=(B&L|R&~L)+j[3]-187363961|0,_=(_<<14|_>>>18)+B|0,L+=(_&R|B&~R)+j[8]+1163531501|0,L=(L<<20|L>>>12)+_|0,R+=(L&B|_&~B)+j[13]-1444681467|0,R=(R<<5|R>>>27)+L|0,B+=(R&_|L&~_)+j[2]-51403784|0,B=(B<<9|B>>>23)+R|0,_+=(B&L|R&~L)+j[7]+1735328473|0,_=(_<<14|_>>>18)+B|0,L+=(_&R|B&~R)+j[12]-1926607734|0,L=(L<<20|L>>>12)+_|0,R+=(L^_^B)+j[5]-378558|0,R=(R<<4|R>>>28)+L|0,B+=(R^L^_)+j[8]-2022574463|0,B=(B<<11|B>>>21)+R|0,_+=(B^R^L)+j[11]+1839030562|0,_=(_<<16|_>>>16)+B|0,L+=(_^B^R)+j[14]-35309556|0,L=(L<<23|L>>>9)+_|0,R+=(L^_^B)+j[1]-1530992060|0,R=(R<<4|R>>>28)+L|0,B+=(R^L^_)+j[4]+1272893353|0,B=(B<<11|B>>>21)+R|0,_+=(B^R^L)+j[7]-155497632|0,_=(_<<16|_>>>16)+B|0,L+=(_^B^R)+j[10]-1094730640|0,L=(L<<23|L>>>9)+_|0,R+=(L^_^B)+j[13]+681279174|0,R=(R<<4|R>>>28)+L|0,B+=(R^L^_)+j[0]-358537222|0,B=(B<<11|B>>>21)+R|0,_+=(B^R^L)+j[3]-722521979|0,_=(_<<16|_>>>16)+B|0,L+=(_^B^R)+j[6]+76029189|0,L=(L<<23|L>>>9)+_|0,R+=(L^_^B)+j[9]-640364487|0,R=(R<<4|R>>>28)+L|0,B+=(R^L^_)+j[12]-421815835|0,B=(B<<11|B>>>21)+R|0,_+=(B^R^L)+j[15]+530742520|0,_=(_<<16|_>>>16)+B|0,L+=(_^B^R)+j[2]-995338651|0,L=(L<<23|L>>>9)+_|0,R+=(_^(L|~B))+j[0]-198630844|0,R=(R<<6|R>>>26)+L|0,B+=(L^(R|~_))+j[7]+1126891415|0,B=(B<<10|B>>>22)+R|0,_+=(R^(B|~L))+j[14]-1416354905|0,_=(_<<15|_>>>17)+B|0,L+=(B^(_|~R))+j[5]-57434055|0,L=(L<<21|L>>>11)+_|0,R+=(_^(L|~B))+j[12]+1700485571|0,R=(R<<6|R>>>26)+L|0,B+=(L^(R|~_))+j[3]-1894986606|0,B=(B<<10|B>>>22)+R|0,_+=(R^(B|~L))+j[10]-1051523|0,_=(_<<15|_>>>17)+B|0,L+=(B^(_|~R))+j[1]-2054922799|0,L=(L<<21|L>>>11)+_|0,R+=(_^(L|~B))+j[8]+1873313359|0,R=(R<<6|R>>>26)+L|0,B+=(L^(R|~_))+j[15]-30611744|0,B=(B<<10|B>>>22)+R|0,_+=(R^(B|~L))+j[6]-1560198380|0,_=(_<<15|_>>>17)+B|0,L+=(B^(_|~R))+j[13]+1309151649|0,L=(L<<21|L>>>11)+_|0,R+=(_^(L|~B))+j[4]-145523070|0,R=(R<<6|R>>>26)+L|0,B+=(L^(R|~_))+j[11]-1120210379|0,B=(B<<10|B>>>22)+R|0,_+=(R^(B|~L))+j[2]+718787259|0,_=(_<<15|_>>>17)+B|0,L+=(B^(_|~R))+j[9]-343485551|0,L=(L<<21|L>>>11)+_|0,U[0]=R+U[0]|0,U[1]=L+U[1]|0,U[2]=_+U[2]|0,U[3]=B+U[3]|0}function H(U){var j=[],R;for(R=0;R<64;R+=4)j[R>>2]=U.charCodeAt(R)+(U.charCodeAt(R+1)<<8)+(U.charCodeAt(R+2)<<16)+(U.charCodeAt(R+3)<<24);return j}function q(U){var j=[],R;for(R=0;R<64;R+=4)j[R>>2]=U[R]+(U[R+1]<<8)+(U[R+2]<<16)+(U[R+3]<<24);return j}function K(U){var j=U.length,R=[1732584193,-271733879,-1732584194,271733878],L,_,B,X,tt,$;for(L=64;L<=j;L+=64)V(R,H(U.substring(L-64,L)));for(U=U.substring(L-64),_=U.length,B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],L=0;L<_;L+=1)B[L>>2]|=U.charCodeAt(L)<<(L%4<<3);if(B[L>>2]|=128<<(L%4<<3),L>55)for(V(R,B),L=0;L<16;L+=1)B[L]=0;return X=j*8,X=X.toString(16).match(/(.*?)(.{0,8})$/),tt=parseInt(X[2],16),$=parseInt(X[1],16)||0,B[14]=tt,B[15]=$,V(R,B),R}function J(U){var j=U.length,R=[1732584193,-271733879,-1732584194,271733878],L,_,B,X,tt,$;for(L=64;L<=j;L+=64)V(R,q(U.subarray(L-64,L)));for(U=L-64<j?U.subarray(L-64):new Uint8Array(0),_=U.length,B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],L=0;L<_;L+=1)B[L>>2]|=U[L]<<(L%4<<3);if(B[L>>2]|=128<<(L%4<<3),L>55)for(V(R,B),L=0;L<16;L+=1)B[L]=0;return X=j*8,X=X.toString(16).match(/(.*?)(.{0,8})$/),tt=parseInt(X[2],16),$=parseInt(X[1],16)||0,B[14]=tt,B[15]=$,V(R,B),R}function Z(U){var j="",R;for(R=0;R<4;R+=1)j+=W[U>>R*8+4&15]+W[U>>R*8&15];return j}function G(U){var j;for(j=0;j<U.length;j+=1)U[j]=Z(U[j]);return U.join("")}G(K("hello"))!=="5d41402abc4b2a76b9719d911017c592",typeof ArrayBuffer!="undefined"&&!ArrayBuffer.prototype.slice&&function(){function U(j,R){return j=j|0||0,j<0?Math.max(j+R,0):Math.min(j,R)}ArrayBuffer.prototype.slice=function(j,R){var L=this.byteLength,_=U(j,L),B=L,X,tt,$,ot;return R!==F&&(B=U(R,L)),_>B?new ArrayBuffer(0):(X=B-_,tt=new ArrayBuffer(X),$=new Uint8Array(tt),ot=new Uint8Array(this,_,X),$.set(ot),tt)}}();function it(U){return/[\u0080-\uFFFF]/.test(U)&&(U=unescape(encodeURIComponent(U))),U}function rt(U,j){var R=U.length,L=new ArrayBuffer(R),_=new Uint8Array(L),B;for(B=0;B<R;B+=1)_[B]=U.charCodeAt(B);return j?_:L}function nt(U){return String.fromCharCode.apply(null,new Uint8Array(U))}function ct(U,j,R){var L=new Uint8Array(U.byteLength+j.byteLength);return L.set(new Uint8Array(U)),L.set(new Uint8Array(j),U.byteLength),R?L:L.buffer}function et(U){var j=[],R=U.length,L;for(L=0;L<R-1;L+=2)j.push(parseInt(U.substr(L,2),16));return String.fromCharCode.apply(String,j)}function z(){this.reset()}return z.prototype.append=function(U){return this.appendBinary(it(U)),this},z.prototype.appendBinary=function(U){this._buff+=U,this._length+=U.length;var j=this._buff.length,R;for(R=64;R<=j;R+=64)V(this._hash,H(this._buff.substring(R-64,R)));return this._buff=this._buff.substring(R-64),this},z.prototype.end=function(U){var j=this._buff,R=j.length,L,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],B;for(L=0;L<R;L+=1)_[L>>2]|=j.charCodeAt(L)<<(L%4<<3);return this._finish(_,R),B=G(this._hash),U&&(B=et(B)),this.reset(),B},z.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},z.prototype.setState=function(U){return this._buff=U.buff,this._length=U.length,this._hash=U.hash,this},z.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},z.prototype._finish=function(U,j){var R=j,L,_,B;if(U[R>>2]|=128<<(R%4<<3),R>55)for(V(this._hash,U),R=0;R<16;R+=1)U[R]=0;L=this._length*8,L=L.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(L[2],16),B=parseInt(L[1],16)||0,U[14]=_,U[15]=B,V(this._hash,U)},z.hash=function(U,j){return z.hashBinary(it(U),j)},z.hashBinary=function(U,j){var R=K(U),L=G(R);return j?et(L):L},z.ArrayBuffer=function(){this.reset()},z.ArrayBuffer.prototype.append=function(U){var j=ct(this._buff.buffer,U,!0),R=j.length,L;for(this._length+=U.byteLength,L=64;L<=R;L+=64)V(this._hash,q(j.subarray(L-64,L)));return this._buff=L-64<R?new Uint8Array(j.buffer.slice(L-64)):new Uint8Array(0),this},z.ArrayBuffer.prototype.end=function(U){var j=this._buff,R=j.length,L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_,B;for(_=0;_<R;_+=1)L[_>>2]|=j[_]<<(_%4<<3);return this._finish(L,R),B=G(this._hash),U&&(B=et(B)),this.reset(),B},z.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.ArrayBuffer.prototype.getState=function(){var U=z.prototype.getState.call(this);return U.buff=nt(U.buff),U},z.ArrayBuffer.prototype.setState=function(U){return U.buff=rt(U.buff,!0),z.prototype.setState.call(this,U)},z.ArrayBuffer.prototype.destroy=z.prototype.destroy,z.ArrayBuffer.prototype._finish=z.prototype._finish,z.ArrayBuffer.hash=function(U,j){var R=J(new Uint8Array(U)),L=G(R);return j?et(L):L},z})}),h=function(D,M){if(!(D instanceof M))throw new TypeError("Cannot call a class as a function")},v=function(){function D(M,F){for(var W=0;W<F.length;W++){var V=F[W];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(M,V.key,V)}}return function(M,F,W){return F&&D(M.prototype,F),W&&D(M,W),M}}(),f=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,d=function(){v(D,null,[{key:"create",value:function(F,W){var V=new D(F);V.create(W)}}]);function D(M){h(this,D),this.file=M,this.chunkSize=2097152,this.chunkCount=Math.ceil(this.file.size/this.chunkSize),this.chunkIndex=0}return v(D,[{key:"create",value:function(F){var W=this;this.callback=F,this.md5Buffer=new a.ArrayBuffer,this.fileReader=new FileReader,this.fileReader.addEventListener("load",function(V){return W.fileReaderDidLoad(V)}),this.fileReader.addEventListener("error",function(V){return W.fileReaderDidError(V)}),this.readNextChunk()}},{key:"fileReaderDidLoad",value:function(F){if(this.md5Buffer.append(F.target.result),!this.readNextChunk()){var W=this.md5Buffer.end(!0),V=btoa(W);this.callback(null,V)}}},{key:"fileReaderDidError",value:function(F){this.callback("Error reading "+this.file.name)}},{key:"readNextChunk",value:function(){if(this.chunkIndex<this.chunkCount||this.chunkIndex==0&&this.chunkCount==0){var F=this.chunkIndex*this.chunkSize,W=Math.min(F+this.chunkSize,this.file.size),V=f.call(this.file,F,W);return this.fileReader.readAsArrayBuffer(V),this.chunkIndex++,!0}else return!1}}]),D}();function s(D){var M=m(document.head,'meta[name="'+D+'"]');if(M)return M.getAttribute("content")}function p(D,M){typeof D=="string"&&(M=D,D=document);var F=D.querySelectorAll(M);return o(F)}function m(D,M){return typeof D=="string"&&(M=D,D=document),D.querySelector(M)}function e(D,M){var F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},W=D.disabled,V=F.bubbles,H=F.cancelable,q=F.detail,K=document.createEvent("Event");K.initEvent(M,V||!0,H||!0),K.detail=q||{};try{D.disabled=!1,D.dispatchEvent(K)}finally{D.disabled=W}return K}function o(D){return Array.isArray(D)?D:Array.from?Array.from(D):[].slice.call(D)}var i=function(){function D(M,F,W){var V=this;h(this,D),this.file=M,this.attributes={filename:M.name,content_type:M.type||"application/octet-stream",byte_size:M.size,checksum:F},this.xhr=new XMLHttpRequest,this.xhr.open("POST",W,!0),this.xhr.responseType="json",this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("Accept","application/json"),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");var H=s("csrf-token");H!=null&&this.xhr.setRequestHeader("X-CSRF-Token",H),this.xhr.addEventListener("load",function(q){return V.requestDidLoad(q)}),this.xhr.addEventListener("error",function(q){return V.requestDidError(q)})}return v(D,[{key:"create",value:function(F){this.callback=F,this.xhr.send(JSON.stringify({blob:this.attributes}))}},{key:"requestDidLoad",value:function(F){if(this.status>=200&&this.status<300){var W=this.response,V=W.direct_upload;delete W.direct_upload,this.attributes=W,this.directUploadData=V,this.callback(null,this.toJSON())}else this.requestDidError(F)}},{key:"requestDidError",value:function(F){this.callback('Error creating Blob for "'+this.file.name+'". Status: '+this.status)}},{key:"toJSON",value:function(){var F={};for(var W in this.attributes)F[W]=this.attributes[W];return F}},{key:"status",get:function(){return this.xhr.status}},{key:"response",get:function(){var F=this.xhr,W=F.responseType,V=F.response;return W=="json"?V:JSON.parse(V)}}]),D}(),r=function(){function D(M){var F=this;h(this,D),this.blob=M,this.file=M.file;var W=M.directUploadData,V=W.url,H=W.headers;this.xhr=new XMLHttpRequest,this.xhr.open("PUT",V,!0),this.xhr.responseType="text";for(var q in H)this.xhr.setRequestHeader(q,H[q]);this.xhr.addEventListener("load",function(K){return F.requestDidLoad(K)}),this.xhr.addEventListener("error",function(K){return F.requestDidError(K)})}return v(D,[{key:"create",value:function(F){this.callback=F,this.xhr.send(this.file.slice())}},{key:"requestDidLoad",value:function(F){var W=this.xhr,V=W.status,H=W.response;V>=200&&V<300?this.callback(null,H):this.requestDidError(F)}},{key:"requestDidError",value:function(F){this.callback('Error storing "'+this.file.name+'". Status: '+this.xhr.status)}}]),D}(),c=0,u=function(){function D(M,F,W){h(this,D),this.id=++c,this.file=M,this.url=F,this.delegate=W}return v(D,[{key:"create",value:function(F){var W=this;d.create(this.file,function(V,H){if(V){F(V);return}var q=new i(W.file,H,W.url);y(W.delegate,"directUploadWillCreateBlobWithXHR",q.xhr),q.create(function(K){if(K)F(K);else{var J=new r(q);y(W.delegate,"directUploadWillStoreFileWithXHR",J.xhr),J.create(function(Z){Z?F(Z):F(null,q.toJSON())})}})})}}]),D}();function y(D,M){if(D&&typeof D[M]=="function"){for(var F=arguments.length,W=Array(F>2?F-2:0),V=2;V<F;V++)W[V-2]=arguments[V];return D[M].apply(D,W)}}var n=function(){function D(M,F){h(this,D),this.input=M,this.file=F,this.directUpload=new u(this.file,this.url,this),this.dispatch("initialize")}return v(D,[{key:"start",value:function(F){var W=this,V=document.createElement("input");V.type="hidden",V.name=this.input.name,this.input.insertAdjacentElement("beforebegin",V),this.dispatch("start"),this.directUpload.create(function(H,q){H?(V.parentNode.removeChild(V),W.dispatchError(H)):V.value=q.signed_id,W.dispatch("end"),F(H)})}},{key:"uploadRequestDidProgress",value:function(F){var W=F.loaded/F.total*100;W&&this.dispatch("progress",{progress:W})}},{key:"dispatch",value:function(F){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return W.file=this.file,W.id=this.directUpload.id,e(this.input,"direct-upload:"+F,{detail:W})}},{key:"dispatchError",value:function(F){var W=this.dispatch("error",{error:F});W.defaultPrevented||alert(F)}},{key:"directUploadWillCreateBlobWithXHR",value:function(F){this.dispatch("before-blob-request",{xhr:F})}},{key:"directUploadWillStoreFileWithXHR",value:function(F){var W=this;this.dispatch("before-storage-request",{xhr:F}),F.upload.addEventListener("progress",function(V){return W.uploadRequestDidProgress(V)})}},{key:"url",get:function(){return this.input.getAttribute("data-direct-upload-url")}}]),D}(),l="input[type=file][data-direct-upload-url]:not([disabled])",g=function(){function D(M){h(this,D),this.form=M,this.inputs=p(M,l).filter(function(F){return F.files.length})}return v(D,[{key:"start",value:function(F){var W=this,V=this.createDirectUploadControllers(),H=function q(){var K=V.shift();K?K.start(function(J){J?(F(J),W.dispatch("end")):q()}):(F(),W.dispatch("end"))};this.dispatch("start"),H()}},{key:"createDirectUploadControllers",value:function(){var F=[];return this.inputs.forEach(function(W){o(W.files).forEach(function(V){var H=new n(W,V);F.push(H)})}),F}},{key:"dispatch",value:function(F){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e(this.form,"direct-uploads:"+F,{detail:W})}}]),D}(),w="data-direct-uploads-processing",b=new WeakMap,A=!1;function C(){A||(A=!0,document.addEventListener("click",S,!0),document.addEventListener("submit",I),document.addEventListener("ajax:before",P))}function S(D){var M=D.target;(M.tagName=="INPUT"||M.tagName=="BUTTON")&&M.type=="submit"&&M.form&&b.set(M.form,M)}function I(D){N(D)}function P(D){D.target.tagName=="FORM"&&N(D)}function N(D){var M=D.target;if(M.hasAttribute(w)){D.preventDefault();return}var F=new g(M),W=F.inputs;W.length&&(D.preventDefault(),M.setAttribute(w,""),W.forEach(T),F.start(function(V){M.removeAttribute(w),V?W.forEach(x):O(M)}))}function O(D){var M=b.get(D)||m(D,"input[type=submit], button[type=submit]");if(M){var F=M,W=F.disabled;M.disabled=!1,M.focus(),M.click(),M.disabled=W}else M=document.createElement("input"),M.type="submit",M.style.display="none",D.appendChild(M),M.click(),D.removeChild(M);b.delete(D)}function T(D){D.disabled=!0}function x(D){D.disabled=!1}function k(){window.ActiveStorage&&C()}setTimeout(k,1),E.start=C,E.DirectUpload=u,Object.defineProperty(E,"__esModule",{value:!0})})});var fe=Et((Bt,It)=>{(function(E,t){typeof Bt=="object"&&typeof It!="undefined"?It.exports=t():typeof define=="function"&&define.amd?define(t):(E=E||self).Tribute=t()})(Bt,function(){"use strict";function E(m,e){if(!(m instanceof e))throw new TypeError("Cannot call a class as a function")}function t(m,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(m,i.key,i)}}function a(m,e,o){return e&&t(m.prototype,e),o&&t(m,o),m}function h(m,e){return function(o){if(Array.isArray(o))return o}(m)||function(o,i){if(Symbol.iterator in Object(o)||Object.prototype.toString.call(o)==="[object Arguments]"){var r=[],c=!0,u=!1,y=void 0;try{for(var n,l=o[Symbol.iterator]();!(c=(n=l.next()).done)&&(r.push(n.value),!i||r.length!==i);c=!0);}catch(g){u=!0,y=g}finally{try{c||l.return==null||l.return()}finally{if(u)throw y}}return r}}(m,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}if(Array.prototype.find||(Array.prototype.find=function(m){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof m!="function")throw new TypeError("predicate must be a function");for(var e,o=Object(this),i=o.length>>>0,r=arguments[1],c=0;c<i;c++)if(e=o[c],m.call(r,e,c,o))return e}),window&&typeof window.CustomEvent!="function"){var v=function(m,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(m,e.bubbles,e.cancelable,e.detail),o};window.Event!==void 0&&(v.prototype=window.Event.prototype),window.CustomEvent=v}var f=function(){function m(e){E(this,m),this.tribute=e,this.tribute.events=this}return a(m,[{key:"bind",value:function(e){e.boundKeydown=this.keydown.bind(e,this),e.boundKeyup=this.keyup.bind(e,this),e.boundInput=this.input.bind(e,this),e.addEventListener("keydown",e.boundKeydown,!1),e.addEventListener("keyup",e.boundKeyup,!1),e.addEventListener("input",e.boundInput,!1)}},{key:"unbind",value:function(e){e.removeEventListener("keydown",e.boundKeydown,!1),e.removeEventListener("keyup",e.boundKeyup,!1),e.removeEventListener("input",e.boundInput,!1),delete e.boundKeydown,delete e.boundKeyup,delete e.boundInput}},{key:"keydown",value:function(e,o){e.shouldDeactivate(o)&&(e.tribute.isActive=!1,e.tribute.hideMenu());var i=this;e.commandEvent=!1,m.keys().forEach(function(r){r.key===o.keyCode&&(e.commandEvent=!0,e.callbacks()[r.value.toLowerCase()](o,i))})}},{key:"input",value:function(e,o){e.inputEvent=!0,e.keyup.call(this,e,o)}},{key:"click",value:function(e,o){var i=e.tribute;if(i.menu&&i.menu.contains(o.target)){var r=o.target;for(o.preventDefault(),o.stopPropagation();r.nodeName.toLowerCase()!=="li";)if(!(r=r.parentNode)||r===i.menu)throw new Error("cannot find the <li> container for the click");i.selectItemAtIndex(r.getAttribute("data-index"),o),i.hideMenu()}else i.current.element&&!i.current.externalTrigger&&(i.current.externalTrigger=!1,setTimeout(function(){return i.hideMenu()}))}},{key:"keyup",value:function(e,o){if(e.inputEvent&&(e.inputEvent=!1),e.updateSelection(this),o.keyCode!==27){if(!e.tribute.allowSpaces&&e.tribute.hasTrailingSpace)return e.tribute.hasTrailingSpace=!1,e.commandEvent=!0,void e.callbacks().space(o,this);if(!e.tribute.isActive)if(e.tribute.autocompleteMode)e.callbacks().triggerChar(o,this,"");else{var i=e.getKeyCode(e,this,o);if(isNaN(i)||!i)return;var r=e.tribute.triggers().find(function(c){return c.charCodeAt(0)===i});r!==void 0&&e.callbacks().triggerChar(o,this,r)}e.tribute.current.mentionText.length<e.tribute.current.collection.menuShowMinLength||((e.tribute.current.trigger||e.tribute.autocompleteMode)&&e.commandEvent===!1||e.tribute.isActive&&o.keyCode===8)&&e.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function(e){if(!this.tribute.isActive)return!1;if(this.tribute.current.mentionText.length===0){var o=!1;return m.keys().forEach(function(i){e.keyCode===i.key&&(o=!0)}),!o}return!1}},{key:"getKeyCode",value:function(e,o,i){var r=e.tribute,c=r.range.getTriggerInfo(!1,r.hasTrailingSpace,!0,r.allowSpaces,r.autocompleteMode);return!!c&&c.mentionTriggerChar.charCodeAt(0)}},{key:"updateSelection",value:function(e){this.tribute.current.element=e;var o=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);o&&(this.tribute.current.selectedPath=o.mentionSelectedPath,this.tribute.current.mentionText=o.mentionText,this.tribute.current.selectedOffset=o.mentionSelectedOffset)}},{key:"callbacks",value:function(){var e=this;return{triggerChar:function(o,i,r){var c=e.tribute;c.current.trigger=r;var u=c.collection.find(function(y){return y.trigger===r});c.current.collection=u,c.current.mentionText.length>=c.current.collection.menuShowMinLength&&c.inputEvent&&c.showMenuFor(i,!0)},enter:function(o,i){e.tribute.isActive&&e.tribute.current.filteredItems&&(o.preventDefault(),o.stopPropagation(),setTimeout(function(){e.tribute.selectItemAtIndex(e.tribute.menuSelected,o),e.tribute.hideMenu()},0))},escape:function(o,i){e.tribute.isActive&&(o.preventDefault(),o.stopPropagation(),e.tribute.isActive=!1,e.tribute.hideMenu())},tab:function(o,i){e.callbacks().enter(o,i)},space:function(o,i){e.tribute.isActive&&(e.tribute.spaceSelectsMatch?e.callbacks().enter(o,i):e.tribute.allowSpaces||(o.stopPropagation(),setTimeout(function(){e.tribute.hideMenu(),e.tribute.isActive=!1},0)))},up:function(o,i){if(e.tribute.isActive&&e.tribute.current.filteredItems){o.preventDefault(),o.stopPropagation();var r=e.tribute.current.filteredItems.length,c=e.tribute.menuSelected;r>c&&c>0?(e.tribute.menuSelected--,e.setActiveLi()):c===0&&(e.tribute.menuSelected=r-1,e.setActiveLi(),e.tribute.menu.scrollTop=e.tribute.menu.scrollHeight)}},down:function(o,i){if(e.tribute.isActive&&e.tribute.current.filteredItems){o.preventDefault(),o.stopPropagation();var r=e.tribute.current.filteredItems.length-1,c=e.tribute.menuSelected;r>c?(e.tribute.menuSelected++,e.setActiveLi()):r===c&&(e.tribute.menuSelected=0,e.setActiveLi(),e.tribute.menu.scrollTop=0)}},delete:function(o,i){e.tribute.isActive&&e.tribute.current.mentionText.length<1?e.tribute.hideMenu():e.tribute.isActive&&e.tribute.showMenuFor(i)}}}},{key:"setActiveLi",value:function(e){var o=this.tribute.menu.querySelectorAll("li"),i=o.length>>>0;e&&(this.tribute.menuSelected=parseInt(e));for(var r=0;r<i;r++){var c=o[r];if(r===this.tribute.menuSelected){c.classList.add(this.tribute.current.collection.selectClass);var u=c.getBoundingClientRect(),y=this.tribute.menu.getBoundingClientRect();if(u.bottom>y.bottom){var n=u.bottom-y.bottom;this.tribute.menu.scrollTop+=n}else if(u.top<y.top){var l=y.top-u.top;this.tribute.menu.scrollTop-=l}}else c.classList.remove(this.tribute.current.collection.selectClass)}}},{key:"getFullHeight",value:function(e,o){var i=e.getBoundingClientRect().height;if(o){var r=e.currentStyle||window.getComputedStyle(e);return i+parseFloat(r.marginTop)+parseFloat(r.marginBottom)}return i}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),m}(),d=function(){function m(e){E(this,m),this.tribute=e,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return a(m,[{key:"bind",value:function(e){var o=this;this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce(function(){o.tribute.isActive&&o.tribute.showMenuFor(o.tribute.current.element,!1)},300,!1),this.windowResizeEvent=this.debounce(function(){o.tribute.isActive&&o.tribute.range.positionMenuAtCaret(!0)},300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}},{key:"unbind",value:function(e){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}},{key:"debounce",value:function(e,o,i){var r,c=arguments,u=this;return function(){var y=u,n=c,l=i&&!r;clearTimeout(r),r=setTimeout(function(){r=null,i||e.apply(y,n)},o),l&&e.apply(y,n)}}}]),m}(),s=function(){function m(e){E(this,m),this.tribute=e,this.tribute.range=this}return a(m,[{key:"getDocument",value:function(){var e;return this.tribute.current.collection&&(e=this.tribute.current.collection.iframe),e?e.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(e){var o,i=this,r=this.tribute.current,c=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(c!==void 0){if(!this.tribute.positionMenu)return void(this.tribute.menu.style.cssText="display: block;");o=this.isContentEditable(r.element)?this.getContentEditableCaretPosition(c.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,c.mentionPosition),this.tribute.menu.style.cssText="top: ".concat(o.top,`px;
                                     left: `).concat(o.left,`px;
                                     right: `).concat(o.right,`px;
                                     bottom: `).concat(o.bottom,`px;
                                     position: absolute;
                                     display: block;`),o.left==="auto"&&(this.tribute.menu.style.left="auto"),o.top==="auto"&&(this.tribute.menu.style.top="auto"),e&&this.scrollIntoView(),window.setTimeout(function(){var u={width:i.tribute.menu.offsetWidth,height:i.tribute.menu.offsetHeight},y=i.isMenuOffScreen(o,u),n=window.innerWidth>u.width&&(y.left||y.right),l=window.innerHeight>u.height&&(y.top||y.bottom);(n||l)&&(i.tribute.menu.style.cssText="display: none",i.positionMenuAtCaret(e))},0)}else this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(e,o,i){var r,c=e;if(o)for(var u=0;u<o.length;u++){if((c=c.childNodes[o[u]])===void 0)return;for(;c.length<i;)i-=c.length,c=c.nextSibling;c.childNodes.length!==0||c.length||(c=c.previousSibling)}var y=this.getWindowSelection();(r=this.getDocument().createRange()).setStart(c,i),r.setEnd(c,i),r.collapse(!0);try{y.removeAllRanges()}catch{}y.addRange(r),e.focus()}},{key:"replaceTriggerText",value:function(e,o,i,r,c){var u=this.getTriggerInfo(!0,i,o,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(u!==void 0){var y=this.tribute.current,n=new CustomEvent("tribute-replaced",{detail:{item:c,instance:y,context:u,event:r}});if(this.isContentEditable(y.element)){e+=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:"\xA0";var l=u.mentionPosition+u.mentionText.length;this.tribute.autocompleteMode||(l+=u.mentionTriggerChar.length),this.pasteHtml(e,u.mentionPosition,l)}else{var g=this.tribute.current.element,w=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:" ";e+=w;var b=u.mentionPosition,A=u.mentionPosition+u.mentionText.length+w.length;this.tribute.autocompleteMode||(A+=u.mentionTriggerChar.length-1),g.value=g.value.substring(0,b)+e+g.value.substring(A,g.value.length),g.selectionStart=b+e.length,g.selectionEnd=b+e.length}y.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),y.element.dispatchEvent(n)}}},{key:"pasteHtml",value:function(e,o,i){var r,c;c=this.getWindowSelection(),(r=this.getDocument().createRange()).setStart(c.anchorNode,o),r.setEnd(c.anchorNode,i),r.deleteContents();var u=this.getDocument().createElement("div");u.innerHTML=e;for(var y,n,l=this.getDocument().createDocumentFragment();y=u.firstChild;)n=l.appendChild(y);r.insertNode(l),n&&((r=r.cloneRange()).setStartAfter(n),r.collapse(!0),c.removeAllRanges(),c.addRange(r))}},{key:"getWindowSelection",value:function(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(e){if(e.parentNode===null)return 0;for(var o=0;o<e.parentNode.childNodes.length;o++)if(e.parentNode.childNodes[o]===e)return o}},{key:"getContentEditableSelectedPath",value:function(e){var o=this.getWindowSelection(),i=o.anchorNode,r=[];if(i!=null){for(var c,u=i.contentEditable;i!==null&&u!=="true";)c=this.getNodePositionInParent(i),r.push(c),(i=i.parentNode)!==null&&(u=i.contentEditable);return r.reverse(),{selected:i,path:r,offset:o.getRangeAt(0).startOffset}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var e=this.tribute.current,o="";if(this.isContentEditable(e.element)){var i=this.getWindowSelection().anchorNode;if(i!=null){var r=i.textContent,c=this.getWindowSelection().getRangeAt(0).startOffset;r&&c>=0&&(o=r.substring(0,c))}}else{var u=this.tribute.current.element;if(u){var y=u.selectionStart;u.value&&y>=0&&(o=u.value.substring(0,y))}}return o}},{key:"getLastWordInText",value:function(e){var o=(e=e.replace(/\u00A0/g," ")).split(/\s+/);return o[o.length-1].trim()}},{key:"getTriggerInfo",value:function(e,o,i,r,c){var u,y,n,l=this,g=this.tribute.current;if(this.isContentEditable(g.element)){var w=this.getContentEditableSelectedPath(g);w&&(u=w.selected,y=w.path,n=w.offset)}else u=this.tribute.current.element;var b=this.getTextPrecedingCurrentSelection(),A=this.getLastWordInText(b);if(c)return{mentionPosition:b.length-A.length,mentionText:A,mentionSelectedElement:u,mentionSelectedPath:y,mentionSelectedOffset:n};if(b!=null){var C,S=-1;if(this.tribute.collection.forEach(function(T){var x=T.trigger,k=T.requireLeadingSpace?l.lastIndexWithLeadingSpace(b,x):b.lastIndexOf(x);k>S&&(S=k,C=x,i=T.requireLeadingSpace)}),S>=0&&(S===0||!i||/[\xA0\s]/g.test(b.substring(S-1,S)))){var I=b.substring(S+C.length,b.length);C=b.substring(S,S+C.length);var P=I.substring(0,1),N=I.length>0&&(P===" "||P==="\xA0");o&&(I=I.trim());var O=r?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=O.test(I),!N&&(e||!O.test(I)))return{mentionPosition:S,mentionText:I,mentionSelectedElement:u,mentionSelectedPath:y,mentionSelectedOffset:n,mentionTriggerChar:C}}}}},{key:"lastIndexWithLeadingSpace",value:function(e,o){for(var i=e.split("").reverse().join(""),r=-1,c=0,u=e.length;c<u;c++){for(var y=c===e.length-1,n=/\s/.test(i[c+1]),l=!0,g=o.length-1;g>=0;g--)if(o[g]!==i[c-g]){l=!1;break}if(l&&(y||n)){r=e.length-1-c;break}}return r}},{key:"isContentEditable",value:function(e){return e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"}},{key:"isMenuOffScreen",value:function(e,o){var i=window.innerWidth,r=window.innerHeight,c=document.documentElement,u=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),y=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),n=typeof e.top=="number"?e.top:y+r-e.bottom-o.height,l=typeof e.right=="number"?e.right:e.left+o.width,g=typeof e.bottom=="number"?e.bottom:e.top+o.height,w=typeof e.left=="number"?e.left:u+i-e.right-o.width;return{top:n<Math.floor(y),right:l>Math.ceil(u+i),bottom:g>Math.ceil(y+r),left:w<Math.floor(u)}}},{key:"getMenuDimensions",value:function(){var e={width:null,height:null};return this.tribute.menu.style.cssText=`top: 0px;
                                 left: 0px;
                                 position: fixed;
                                 display: block;
                                 visibility; hidden;`,e.width=this.tribute.menu.offsetWidth,e.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",e}},{key:"getTextAreaOrInputUnderlinePosition",value:function(e,o,i){var r=window.mozInnerScreenX!==null,c=this.getDocument().createElement("div");c.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(c);var u=c.style,y=window.getComputedStyle?getComputedStyle(e):e.currentStyle;u.whiteSpace="pre-wrap",e.nodeName!=="INPUT"&&(u.wordWrap="break-word"),u.position="absolute",u.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(function(k){u[k]=y[k]}),r?(u.width="".concat(parseInt(y.width)-2,"px"),e.scrollHeight>parseInt(y.height)&&(u.overflowY="scroll")):u.overflow="hidden",c.textContent=e.value.substring(0,o),e.nodeName==="INPUT"&&(c.textContent=c.textContent.replace(/\s/g,"\xA0"));var n=this.getDocument().createElement("span");n.textContent=e.value.substring(o)||".",c.appendChild(n);var l=e.getBoundingClientRect(),g=document.documentElement,w=(window.pageXOffset||g.scrollLeft)-(g.clientLeft||0),b=(window.pageYOffset||g.scrollTop)-(g.clientTop||0),A=0,C=0;this.menuContainerIsBody&&(A=l.top,C=l.left);var S={top:A+b+n.offsetTop+parseInt(y.borderTopWidth)+parseInt(y.fontSize)-e.scrollTop,left:C+w+n.offsetLeft+parseInt(y.borderLeftWidth)},I=window.innerWidth,P=window.innerHeight,N=this.getMenuDimensions(),O=this.isMenuOffScreen(S,N);O.right&&(S.right=I-S.left,S.left="auto");var T=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(O.bottom){var x=T-(P-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);S.bottom=x+(P-l.top-n.offsetTop),S.top="auto"}return(O=this.isMenuOffScreen(S,N)).left&&(S.left=I>N.width?w+I-N.width:w,delete S.right),O.top&&(S.top=P>N.height?b+P-N.height:b,delete S.bottom),this.getDocument().body.removeChild(c),S}},{key:"getContentEditableCaretPosition",value:function(e){var o,i=this.getWindowSelection();(o=this.getDocument().createRange()).setStart(i.anchorNode,e),o.setEnd(i.anchorNode,e),o.collapse(!1);var r=o.getBoundingClientRect(),c=document.documentElement,u=(window.pageXOffset||c.scrollLeft)-(c.clientLeft||0),y=(window.pageYOffset||c.scrollTop)-(c.clientTop||0),n={left:r.left+u,top:r.top+r.height+y},l=window.innerWidth,g=window.innerHeight,w=this.getMenuDimensions(),b=this.isMenuOffScreen(n,w);b.right&&(n.left="auto",n.right=l-r.left-u);var A=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(b.bottom){var C=A-(g-(this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect()).top);n.top="auto",n.bottom=C+(g-r.top)}return(b=this.isMenuOffScreen(n,w)).left&&(n.left=l>w.width?u+l-w.width:u,delete n.right),b.top&&(n.top=g>w.height?y+g-w.height:y,delete n.bottom),this.menuContainerIsBody||(n.left=n.left?n.left-this.tribute.menuContainer.offsetLeft:n.left,n.top=n.top?n.top-this.tribute.menuContainer.offsetTop:n.top),n}},{key:"scrollIntoView",value:function(e){var o,i=this.menu;if(i!==void 0){for(;o===void 0||o.height===0;)if((o=i.getBoundingClientRect()).height===0&&((i=i.childNodes[0])===void 0||!i.getBoundingClientRect))return;var r=o.top,c=r+o.height;if(r<0)window.scrollTo(0,window.pageYOffset+o.top-20);else if(c>window.innerHeight){var u=window.pageYOffset+o.top-20;u-window.pageYOffset>100&&(u=window.pageYOffset+100);var y=window.pageYOffset-(window.innerHeight-c);y>u&&(y=u),window.scrollTo(0,y)}}}},{key:"menuContainerIsBody",get:function(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}}]),m}(),p=function(){function m(e){E(this,m),this.tribute=e,this.tribute.search=this}return a(m,[{key:"simpleFilter",value:function(e,o){var i=this;return o.filter(function(r){return i.test(e,r)})}},{key:"test",value:function(e,o){return this.match(e,o)!==null}},{key:"match",value:function(e,o,i){i=i||{},o.length;var r=i.pre||"",c=i.post||"",u=i.caseSensitive&&o||o.toLowerCase();if(i.skip)return{rendered:o,score:0};e=i.caseSensitive&&e||e.toLowerCase();var y=this.traverse(u,e,0,0,[]);return y?{rendered:this.render(o,y.cache,r,c),score:y.score}:null}},{key:"traverse",value:function(e,o,i,r,c){if(o.length===r)return{score:this.calculateScore(c),cache:c.slice()};if(!(e.length===i||o.length-r>e.length-i)){for(var u,y,n=o[r],l=e.indexOf(n,i);l>-1;){if(c.push(l),y=this.traverse(e,o,l+1,r+1,c),c.pop(),!y)return u;(!u||u.score<y.score)&&(u=y),l=e.indexOf(n,l+1)}return u}}},{key:"calculateScore",value:function(e){var o=0,i=1;return e.forEach(function(r,c){c>0&&(e[c-1]+1===r?i+=i+1:i=1),o+=i}),o}},{key:"render",value:function(e,o,i,r){var c=e.substring(0,o[0]);return o.forEach(function(u,y){c+=i+e[u]+r+e.substring(u+1,o[y+1]?o[y+1]:e.length)}),c}},{key:"filter",value:function(e,o,i){var r=this;return i=i||{},o.reduce(function(c,u,y,n){var l=u;i.extract&&((l=i.extract(u))||(l=""));var g=r.match(e,l,i);return g!=null&&(c[c.length]={string:g.rendered,score:g.score,index:y,original:u}),c},[]).sort(function(c,u){var y=u.score-c.score;return y||c.index-u.index})}}]),m}();return function(){function m(e){var o,i=this,r=e.values,c=r===void 0?null:r,u=e.iframe,y=u===void 0?null:u,n=e.selectClass,l=n===void 0?"highlight":n,g=e.containerClass,w=g===void 0?"tribute-container":g,b=e.itemClass,A=b===void 0?"":b,C=e.trigger,S=C===void 0?"@":C,I=e.autocompleteMode,P=I!==void 0&&I,N=e.selectTemplate,O=N===void 0?null:N,T=e.menuItemTemplate,x=T===void 0?null:T,k=e.lookup,D=k===void 0?"key":k,M=e.fillAttr,F=M===void 0?"value":M,W=e.collection,V=W===void 0?null:W,H=e.menuContainer,q=H===void 0?null:H,K=e.noMatchTemplate,J=K===void 0?null:K,Z=e.requireLeadingSpace,G=Z===void 0||Z,it=e.allowSpaces,rt=it!==void 0&&it,nt=e.replaceTextSuffix,ct=nt===void 0?null:nt,et=e.positionMenu,z=et===void 0||et,U=e.spaceSelectsMatch,j=U!==void 0&&U,R=e.searchOpts,L=R===void 0?{}:R,_=e.menuItemLimit,B=_===void 0?null:_,X=e.menuShowMinLength,tt=X===void 0?0:X;if(E(this,m),this.autocompleteMode=P,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=q,this.allowSpaces=rt,this.replaceTextSuffix=ct,this.positionMenu=z,this.hasTrailingSpace=!1,this.spaceSelectsMatch=j,this.autocompleteMode&&(S="",rt=!1),c)this.collection=[{trigger:S,iframe:y,selectClass:l,containerClass:w,itemClass:A,selectTemplate:(O||m.defaultSelectTemplate).bind(this),menuItemTemplate:(x||m.defaultMenuItemTemplate).bind(this),noMatchTemplate:(o=J,typeof o=="string"?o.trim()===""?null:o:typeof o=="function"?o.bind(i):J||function(){return"<li>No Match Found!</li>"}.bind(i)),lookup:D,fillAttr:F,values:c,requireLeadingSpace:G,searchOpts:L,menuItemLimit:B,menuShowMinLength:tt}];else{if(!V)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=V.map(function($){return{trigger:$.trigger||S,iframe:$.iframe||y,selectClass:$.selectClass||l,containerClass:$.containerClass||w,itemClass:$.itemClass||A,selectTemplate:($.selectTemplate||m.defaultSelectTemplate).bind(i),menuItemTemplate:($.menuItemTemplate||m.defaultMenuItemTemplate).bind(i),noMatchTemplate:function(ot){return typeof ot=="string"?ot.trim()===""?null:ot:typeof ot=="function"?ot.bind(i):J||function(){return"<li>No Match Found!</li>"}.bind(i)}(J),lookup:$.lookup||D,fillAttr:$.fillAttr||F,values:$.values,requireLeadingSpace:$.requireLeadingSpace,searchOpts:$.searchOpts||L,menuItemLimit:$.menuItemLimit||B,menuShowMinLength:$.menuShowMinLength||tt}})}new s(this),new f(this),new d(this),new p(this)}return a(m,[{key:"triggers",value:function(){return this.collection.map(function(e){return e.trigger})}},{key:"attach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery!="undefined"&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var o=e.length,i=0;i<o;++i)this._attach(e[i]);else this._attach(e)}},{key:"_attach",value:function(e){e.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+e.nodeName),this.ensureEditable(e),this.events.bind(e),e.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function(e){if(m.inputTypes().indexOf(e.nodeName)===-1){if(!e.contentEditable)throw new Error("[Tribute] Cannot bind to "+e.nodeName);e.contentEditable=!0}}},{key:"createMenu",value:function(e){var o=this.range.getDocument().createElement("div"),i=this.range.getDocument().createElement("ul");return o.className=e,o.appendChild(i),this.menuContainer?this.menuContainer.appendChild(o):this.range.getDocument().body.appendChild(o)}},{key:"showMenuFor",value:function(e,o){var i=this;if(!this.isActive||this.current.element!==e||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass),e.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");var r=function(c){if(i.isActive){var u=i.search.filter(i.current.mentionText,c,{pre:i.current.collection.searchOpts.pre||"<span>",post:i.current.collection.searchOpts.post||"</span>",skip:i.current.collection.searchOpts.skip,extract:function(g){if(typeof i.current.collection.lookup=="string")return g[i.current.collection.lookup];if(typeof i.current.collection.lookup=="function")return i.current.collection.lookup(g,i.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});i.current.collection.menuItemLimit&&(u=u.slice(0,i.current.collection.menuItemLimit)),i.current.filteredItems=u;var y=i.menu.querySelector("ul");if(i.range.positionMenuAtCaret(o),!u.length){var n=new CustomEvent("tribute-no-match",{detail:i.menu});return i.current.element.dispatchEvent(n),void(typeof i.current.collection.noMatchTemplate=="function"&&!i.current.collection.noMatchTemplate()||!i.current.collection.noMatchTemplate?i.hideMenu():typeof i.current.collection.noMatchTemplate=="function"?y.innerHTML=i.current.collection.noMatchTemplate():y.innerHTML=i.current.collection.noMatchTemplate)}y.innerHTML="";var l=i.range.getDocument().createDocumentFragment();u.forEach(function(g,w){var b=i.range.getDocument().createElement("li");b.setAttribute("data-index",w),b.className=i.current.collection.itemClass,b.addEventListener("mousemove",function(A){var C=h(i._findLiTarget(A.target),2),S=(C[0],C[1]);A.movementY!==0&&i.events.setActiveLi(S)}),i.menuSelected===w&&b.classList.add(i.current.collection.selectClass),b.innerHTML=i.current.collection.menuItemTemplate(g),l.appendChild(b)}),y.appendChild(l)}};typeof this.current.collection.values=="function"?this.current.collection.values(this.current.mentionText,r):r(this.current.collection.values)}}},{key:"_findLiTarget",value:function(e){if(!e)return[];var o=e.getAttribute("data-index");return o?[e,o]:this._findLiTarget(e.parentNode)}},{key:"showMenuForCollection",value:function(e,o){e!==document.activeElement&&this.placeCaretAtEnd(e),this.current.collection=this.collection[o||0],this.current.externalTrigger=!0,this.current.element=e,e.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(e,this.current.collection.trigger),this.showMenuFor(e)}},{key:"placeCaretAtEnd",value:function(e){if(e.focus(),window.getSelection!==void 0&&document.createRange!==void 0){var o=document.createRange();o.selectNodeContents(e),o.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(o)}else if(document.body.createTextRange!==void 0){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}}},{key:"insertTextAtCursor",value:function(e){var o,i;(i=(o=window.getSelection()).getRangeAt(0)).deleteContents();var r=document.createTextNode(e);i.insertNode(r),i.selectNodeContents(r),i.collapse(!1),o.removeAllRanges(),o.addRange(i)}},{key:"insertAtCaret",value:function(e,o){var i=e.scrollTop,r=e.selectionStart,c=e.value.substring(0,r),u=e.value.substring(e.selectionEnd,e.value.length);e.value=c+o+u,r+=o.length,e.selectionStart=r,e.selectionEnd=r,e.focus(),e.scrollTop=i}},{key:"hideMenu",value:function(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function(e,o){if(typeof(e=parseInt(e))=="number"&&!isNaN(e)){var i=this.current.filteredItems[e],r=this.current.collection.selectTemplate(i);r!==null&&this.replaceText(r,o,i)}}},{key:"replaceText",value:function(e,o,i){this.range.replaceTriggerText(e,!0,!0,o,i)}},{key:"_append",value:function(e,o,i){if(typeof e.values=="function")throw new Error("Unable to append to values, as it is a function.");e.values=i?o:e.values.concat(o)}},{key:"append",value:function(e,o,i){var r=parseInt(e);if(typeof r!="number")throw new Error("please provide an index for the collection to update.");var c=this.collection[r];this._append(c,o,i)}},{key:"appendCurrent",value:function(e,o){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,e,o)}},{key:"detach",value:function(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery!="undefined"&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array)for(var o=e.length,i=0;i<o;++i)this._detach(e[i]);else this._detach(e)}},{key:"_detach",value:function(e){var o=this;this.events.unbind(e),e.tributeMenu&&this.menuEvents.unbind(e.tributeMenu),setTimeout(function(){e.removeAttribute("data-tribute"),o.isActive=!1,e.tributeMenu&&e.tributeMenu.remove()})}},{key:"isActive",get:function(){return this._isActive},set:function(e){if(this._isActive!=e&&(this._isActive=e,this.current.element)){var o=new CustomEvent("tribute-active-".concat(e));this.current.element.dispatchEvent(o)}}}],[{key:"defaultSelectTemplate",value:function(e){return e===void 0?"".concat(this.current.collection.trigger).concat(this.current.mentionText):this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+e.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+e.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(e){return e.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),m}()})});var ge=Et((st,at)=>{(function(){}).call(st),function(){var E;window.Set==null&&(window.Set=E=function(){function t(){this.clear()}return t.prototype.clear=function(){return this.values=[]},t.prototype.has=function(a){return this.values.indexOf(a)!==-1},t.prototype.add=function(a){return this.has(a)||this.values.push(a),this},t.prototype.delete=function(a){var h;return(h=this.values.indexOf(a))===-1?!1:(this.values.splice(h,1),!0)},t.prototype.forEach=function(){var a;return(a=this.values).forEach.apply(a,arguments)},t}())}.call(st),function(E){function t(){}function a(r,c){return function(){r.apply(c,arguments)}}function h(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof r!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],m(r,this)}function v(r,c){for(;r._state===3;)r=r._value;return r._state===0?void r._deferreds.push(c):(r._handled=!0,void o(function(){var u=r._state===1?c.onFulfilled:c.onRejected;if(u===null)return void(r._state===1?f:d)(c.promise,r._value);var y;try{y=u(r._value)}catch(n){return void d(c.promise,n)}f(c.promise,y)}))}function f(r,c){try{if(c===r)throw new TypeError("A promise cannot be resolved with itself.");if(c&&(typeof c=="object"||typeof c=="function")){var u=c.then;if(c instanceof h)return r._state=3,r._value=c,void s(r);if(typeof u=="function")return void m(a(u,c),r)}r._state=1,r._value=c,s(r)}catch(y){d(r,y)}}function d(r,c){r._state=2,r._value=c,s(r)}function s(r){r._state===2&&r._deferreds.length===0&&setTimeout(function(){r._handled||i(r._value)},1);for(var c=0,u=r._deferreds.length;u>c;c++)v(r,r._deferreds[c]);r._deferreds=null}function p(r,c,u){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof c=="function"?c:null,this.promise=u}function m(r,c){var u=!1;try{r(function(y){u||(u=!0,f(c,y))},function(y){u||(u=!0,d(c,y))})}catch(y){if(u)return;u=!0,d(c,y)}}var e=setTimeout,o=typeof setImmediate=="function"&&setImmediate||function(r){e(r,1)},i=function(r){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",r)};h.prototype.catch=function(r){return this.then(null,r)},h.prototype.then=function(r,c){var u=new h(t);return v(this,new p(r,c,u)),u},h.all=function(r){var c=Array.prototype.slice.call(r);return new h(function(u,y){function n(w,b){try{if(b&&(typeof b=="object"||typeof b=="function")){var A=b.then;if(typeof A=="function")return void A.call(b,function(C){n(w,C)},y)}c[w]=b,--l==0&&u(c)}catch(C){y(C)}}if(c.length===0)return u([]);for(var l=c.length,g=0;g<c.length;g++)n(g,c[g])})},h.resolve=function(r){return r&&typeof r=="object"&&r.constructor===h?r:new h(function(c){c(r)})},h.reject=function(r){return new h(function(c,u){u(r)})},h.race=function(r){return new h(function(c,u){for(var y=0,n=r.length;n>y;y++)r[y].then(c,u)})},h._setImmediateFn=function(r){o=r},h._setUnhandledRejectionFn=function(r){i=r},typeof at!="undefined"&&at.exports?at.exports=h:E.Promise||(E.Promise=h)}(st),function(){var E=typeof window.customElements=="object",t=typeof document.registerElement=="function",a=E||t;a||(typeof WeakMap=="undefined"&&function(){var h=Object.defineProperty,v=Date.now()%1e9,f=function(){this.name="__st"+(1e9*Math.random()>>>0)+(v+++"__")};f.prototype={set:function(d,s){var p=d[this.name];return p&&p[0]===d?p[1]=s:h(d,this.name,{value:[d,s],writable:!0}),this},get:function(d){var s;return(s=d[this.name])&&s[0]===d?s[1]:void 0},delete:function(d){var s=d[this.name];return s&&s[0]===d?(s[0]=s[1]=void 0,!0):!1},has:function(d){var s=d[this.name];return s?s[0]===d:!1}},window.WeakMap=f}(),function(h){function v(N){C.push(N),A||(A=!0,l(d))}function f(N){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(N)||N}function d(){A=!1;var N=C;C=[],N.sort(function(T,x){return T.uid_-x.uid_});var O=!1;N.forEach(function(T){var x=T.takeRecords();s(T),x.length&&(T.callback_(x,T),O=!0)}),O&&d()}function s(N){N.nodes_.forEach(function(O){var T=g.get(O);T&&T.forEach(function(x){x.observer===N&&x.removeTransientObservers()})})}function p(N,O){for(var T=N;T;T=T.parentNode){var x=g.get(T);if(x)for(var k=0;k<x.length;k++){var D=x[k],M=D.options;if(T===N||M.subtree){var F=O(M);F&&D.enqueue(F)}}}}function m(N){this.callback_=N,this.nodes_=[],this.records_=[],this.uid_=++S}function e(N,O){this.type=N,this.target=O,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function o(N){var O=new e(N.type,N.target);return O.addedNodes=N.addedNodes.slice(),O.removedNodes=N.removedNodes.slice(),O.previousSibling=N.previousSibling,O.nextSibling=N.nextSibling,O.attributeName=N.attributeName,O.attributeNamespace=N.attributeNamespace,O.oldValue=N.oldValue,O}function i(N,O){return I=new e(N,O)}function r(N){return P||(P=o(I),P.oldValue=N,P)}function c(){I=P=void 0}function u(N){return N===P||N===I}function y(N,O){return N===O?N:P&&u(N)?P:null}function n(N,O,T){this.observer=N,this.target=O,this.options=T,this.transientObservedNodes=[]}if(!h.JsMutationObserver){var l,g=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))l=setTimeout;else if(window.setImmediate)l=window.setImmediate;else{var w=[],b=String(Math.random());window.addEventListener("message",function(N){if(N.data===b){var O=w;w=[],O.forEach(function(T){T()})}}),l=function(N){w.push(N),window.postMessage(b,"*")}}var A=!1,C=[],S=0;m.prototype={observe:function(N,O){if(N=f(N),!O.childList&&!O.attributes&&!O.characterData||O.attributeOldValue&&!O.attributes||O.attributeFilter&&O.attributeFilter.length&&!O.attributes||O.characterDataOldValue&&!O.characterData)throw new SyntaxError;var T=g.get(N);T||g.set(N,T=[]);for(var x,k=0;k<T.length;k++)if(T[k].observer===this){x=T[k],x.removeListeners(),x.options=O;break}x||(x=new n(this,N,O),T.push(x),this.nodes_.push(N)),x.addListeners()},disconnect:function(){this.nodes_.forEach(function(N){for(var O=g.get(N),T=0;T<O.length;T++){var x=O[T];if(x.observer===this){x.removeListeners(),O.splice(T,1);break}}},this),this.records_=[]},takeRecords:function(){var N=this.records_;return this.records_=[],N}};var I,P;n.prototype={enqueue:function(N){var O=this.observer.records_,T=O.length;if(O.length>0){var x=O[T-1],k=y(x,N);if(k)return void(O[T-1]=k)}else v(this.observer);O[T]=N},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(N){var O=this.options;O.attributes&&N.addEventListener("DOMAttrModified",this,!0),O.characterData&&N.addEventListener("DOMCharacterDataModified",this,!0),O.childList&&N.addEventListener("DOMNodeInserted",this,!0),(O.childList||O.subtree)&&N.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(N){var O=this.options;O.attributes&&N.removeEventListener("DOMAttrModified",this,!0),O.characterData&&N.removeEventListener("DOMCharacterDataModified",this,!0),O.childList&&N.removeEventListener("DOMNodeInserted",this,!0),(O.childList||O.subtree)&&N.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(N){if(N!==this.target){this.addListeners_(N),this.transientObservedNodes.push(N);var O=g.get(N);O||g.set(N,O=[]),O.push(this)}},removeTransientObservers:function(){var N=this.transientObservedNodes;this.transientObservedNodes=[],N.forEach(function(O){this.removeListeners_(O);for(var T=g.get(O),x=0;x<T.length;x++)if(T[x]===this){T.splice(x,1);break}},this)},handleEvent:function(N){switch(N.stopImmediatePropagation(),N.type){case"DOMAttrModified":var O=N.attrName,T=N.relatedNode.namespaceURI,x=N.target,k=new i("attributes",x);k.attributeName=O,k.attributeNamespace=T;var D=N.attrChange===MutationEvent.ADDITION?null:N.prevValue;p(x,function(q){return!q.attributes||q.attributeFilter&&q.attributeFilter.length&&q.attributeFilter.indexOf(O)===-1&&q.attributeFilter.indexOf(T)===-1?void 0:q.attributeOldValue?r(D):k});break;case"DOMCharacterDataModified":var x=N.target,k=i("characterData",x),D=N.prevValue;p(x,function(q){return q.characterData?q.characterDataOldValue?r(D):k:void 0});break;case"DOMNodeRemoved":this.addTransientObserver(N.target);case"DOMNodeInserted":var M,F,W=N.target;N.type==="DOMNodeInserted"?(M=[W],F=[]):(M=[],F=[W]);var V=W.previousSibling,H=W.nextSibling,k=i("childList",N.target.parentNode);k.addedNodes=M,k.removedNodes=F,k.previousSibling=V,k.nextSibling=H,p(N.relatedNode,function(q){return q.childList?k:void 0})}c()}},h.JsMutationObserver=m,h.MutationObserver||(h.MutationObserver=m,m._isPolyfilled=!0)}}(self),function(){"use strict";if(!window.performance||!window.performance.now){var h=Date.now();window.performance={now:function(){return Date.now()-h}}}window.requestAnimationFrame||(window.requestAnimationFrame=function(){var p=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return p?function(m){return p(function(){m(performance.now())})}:function(m){return window.setTimeout(m,1e3/60)}}()),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(p){clearTimeout(p)}}());var v=function(){var p=document.createEvent("Event");return p.initEvent("foo",!0,!0),p.preventDefault(),p.defaultPrevented}();if(!v){var f=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(f.call(this),Object.defineProperty(this,"defaultPrevented",{get:function(){return!0},configurable:!0}))}}var d=/Trident/.test(navigator.userAgent);if((!window.CustomEvent||d&&typeof window.CustomEvent!="function")&&(window.CustomEvent=function(p,m){m=m||{};var e=document.createEvent("CustomEvent");return e.initCustomEvent(p,Boolean(m.bubbles),Boolean(m.cancelable),m.detail),e},window.CustomEvent.prototype=window.Event.prototype),!window.Event||d&&typeof window.Event!="function"){var s=window.Event;window.Event=function(p,m){m=m||{};var e=document.createEvent("Event");return e.initEvent(p,Boolean(m.bubbles),Boolean(m.cancelable)),e},window.Event.prototype=s.prototype}}(window.WebComponents),window.CustomElements=window.CustomElements||{flags:{}},function(h){var v=h.flags,f=[],d=function(p){f.push(p)},s=function(){f.forEach(function(p){p(h)})};h.addModule=d,h.initializeModules=s,h.hasNative=Boolean(document.registerElement),h.isIE=/Trident/.test(navigator.userAgent),h.useNative=!v.register&&h.hasNative&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||window.HTMLImports.useNative)}(window.CustomElements),window.CustomElements.addModule(function(h){function v(e,o){f(e,function(i){return o(i)?!0:void d(i,o)}),d(e,o)}function f(e,o,i){var r=e.firstElementChild;if(!r)for(r=e.firstChild;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.nextSibling;for(;r;)o(r,i)!==!0&&f(r,o,i),r=r.nextElementSibling;return null}function d(e,o){for(var i=e.shadowRoot;i;)v(i,o),i=i.olderShadowRoot}function s(e,o){p(e,o,[])}function p(e,o,i){if(e=window.wrap(e),!(i.indexOf(e)>=0)){i.push(e);for(var r,c=e.querySelectorAll("link[rel="+m+"]"),u=0,y=c.length;y>u&&(r=c[u]);u++)r.import&&p(r.import,o,i);o(e)}}var m=window.HTMLImports?window.HTMLImports.IMPORT_LINK_TYPE:"none";h.forDocumentTree=s,h.forSubtree=v}),window.CustomElements.addModule(function(h){function v(T,x){return f(T,x)||d(T,x)}function f(T,x){return h.upgrade(T,x)?!0:void(x&&m(T))}function d(T,x){A(T,function(k){return f(k,x)?!0:void 0})}function s(T){P.push(T),I||(I=!0,setTimeout(p))}function p(){I=!1;for(var T,x=P,k=0,D=x.length;D>k&&(T=x[k]);k++)T();P=[]}function m(T){S?s(function(){e(T)}):e(T)}function e(T){T.__upgraded__&&!T.__attached&&(T.__attached=!0,T.attachedCallback&&T.attachedCallback())}function o(T){i(T),A(T,function(x){i(x)})}function i(T){S?s(function(){r(T)}):r(T)}function r(T){T.__upgraded__&&T.__attached&&(T.__attached=!1,T.detachedCallback&&T.detachedCallback())}function c(T){for(var x=T,k=window.wrap(document);x;){if(x==k)return!0;x=x.parentNode||x.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&x.host}}function u(T){if(T.shadowRoot&&!T.shadowRoot.__watched){b.dom&&console.log("watching shadow-root for: ",T.localName);for(var x=T.shadowRoot;x;)l(x),x=x.olderShadowRoot}}function y(T,x){if(b.dom){var k=x[0];if(k&&k.type==="childList"&&k.addedNodes&&k.addedNodes){for(var D=k.addedNodes[0];D&&D!==document&&!D.host;)D=D.parentNode;var M=D&&(D.URL||D._URL||D.host&&D.host.localName)||"";M=M.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",x.length,M||"")}var F=c(T);x.forEach(function(W){W.type==="childList"&&(N(W.addedNodes,function(V){V.localName&&v(V,F)}),N(W.removedNodes,function(V){V.localName&&o(V)}))}),b.dom&&console.groupEnd()}function n(T){for(T=window.wrap(T),T||(T=window.wrap(document));T.parentNode;)T=T.parentNode;var x=T.__observer;x&&(y(T,x.takeRecords()),p())}function l(T){if(!T.__observer){var x=new MutationObserver(y.bind(this,T));x.observe(T,{childList:!0,subtree:!0}),T.__observer=x}}function g(T){T=window.wrap(T),b.dom&&console.group("upgradeDocument: ",T.baseURI.split("/").pop());var x=T===window.wrap(document);v(T,x),l(T),b.dom&&console.groupEnd()}function w(T){C(T,g)}var b=h.flags,A=h.forSubtree,C=h.forDocumentTree,S=window.MutationObserver._isPolyfilled&&b["throttle-attached"];h.hasPolyfillMutations=S,h.hasThrottledAttached=S;var I=!1,P=[],N=Array.prototype.forEach.call.bind(Array.prototype.forEach),O=Element.prototype.createShadowRoot;O&&(Element.prototype.createShadowRoot=function(){var T=O.call(this);return window.CustomElements.watchShadow(this),T}),h.watchShadow=u,h.upgradeDocumentTree=w,h.upgradeDocument=g,h.upgradeSubtree=d,h.upgradeAll=v,h.attached=m,h.takeRecords=n}),window.CustomElements.addModule(function(h){function v(e,o){if(e.localName==="template"&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(e),!e.__upgraded__&&e.nodeType===Node.ELEMENT_NODE){var i=e.getAttribute("is"),r=h.getRegisteredDefinition(e.localName)||h.getRegisteredDefinition(i);if(r&&(i&&r.tag==e.localName||!i&&!r.extends))return f(e,r,o)}}function f(e,o,i){return m.upgrade&&console.group("upgrade:",e.localName),o.is&&e.setAttribute("is",o.is),d(e,o),e.__upgraded__=!0,p(e),i&&h.attached(e),h.upgradeSubtree(e,i),m.upgrade&&console.groupEnd(),e}function d(e,o){Object.__proto__||s(e,o.prototype,o.native),e.__proto__=o.prototype}function s(e,o,i){for(var r={},c=o;c!==i&&c!==HTMLElement.prototype;){for(var u,y=Object.getOwnPropertyNames(c),n=0;u=y[n];n++)r[u]||(Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(c,u)),r[u]=1);c=Object.getPrototypeOf(c)}}function p(e){e.createdCallback&&e.createdCallback()}var m=h.flags;h.upgrade=v,h.upgradeWithDefinition=f,h.implementPrototype=d}),window.CustomElements.addModule(function(h){function v(T,x){var k=x||{};if(!T)throw new Error("document.registerElement: first argument `name` must not be empty");if(T.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(T)+"'.");if(s(T))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(T)+"'. The type name is invalid.");if(i(T))throw new Error("DuplicateDefinitionError: a type with name '"+String(T)+"' is already registered");return k.prototype||(k.prototype=Object.create(HTMLElement.prototype)),k.__name=T.toLowerCase(),k.extends&&(k.extends=k.extends.toLowerCase()),k.lifecycle=k.lifecycle||{},k.ancestry=p(k.extends),m(k),e(k),f(k.prototype),r(k.__name,k),k.ctor=c(k),k.ctor.prototype=k.prototype,k.prototype.constructor=k.ctor,h.ready&&g(document),k.ctor}function f(T){if(!T.setAttribute._polyfilled){var x=T.setAttribute;T.setAttribute=function(D,M){d.call(this,D,M,x)};var k=T.removeAttribute;T.removeAttribute=function(D){d.call(this,D,null,k)},T.setAttribute._polyfilled=!0}}function d(T,x,k){T=T.toLowerCase();var D=this.getAttribute(T);k.apply(this,arguments);var M=this.getAttribute(T);this.attributeChangedCallback&&M!==D&&this.attributeChangedCallback(T,D,M)}function s(T){for(var x=0;x<S.length;x++)if(T===S[x])return!0}function p(T){var x=i(T);return x?p(x.extends).concat([x]):[]}function m(T){for(var x,k=T.extends,D=0;x=T.ancestry[D];D++)k=x.is&&x.tag;T.tag=k||T.__name,k&&(T.is=T.__name)}function e(T){if(!Object.__proto__){var x=HTMLElement.prototype;if(T.is){var k=document.createElement(T.tag);x=Object.getPrototypeOf(k)}for(var D,M=T.prototype,F=!1;M;)M==x&&(F=!0),D=Object.getPrototypeOf(M),D&&(M.__proto__=D),M=D;F||console.warn(T.tag+" prototype not found in prototype chain for "+T.is),T.native=x}}function o(T){return b(N(T.tag),T)}function i(T){return T?I[T.toLowerCase()]:void 0}function r(T,x){I[T]=x}function c(T){return function(){return o(T)}}function u(T,x,k){return T===P?y(x,k):O(T,x)}function y(T,x){T&&(T=T.toLowerCase()),x&&(x=x.toLowerCase());var k=i(x||T);if(k){if(T==k.tag&&x==k.is)return new k.ctor;if(!x&&!k.is)return new k.ctor}var D;return x?(D=y(T),D.setAttribute("is",x),D):(D=N(T),T.indexOf("-")>=0&&A(D,HTMLElement),D)}function n(T,x){var k=T[x];T[x]=function(){var D=k.apply(this,arguments);return w(D),D}}var l,g=(h.isIE,h.upgradeDocumentTree),w=h.upgradeAll,b=h.upgradeWithDefinition,A=h.implementPrototype,C=h.useNative,S=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],I={},P="http://www.w3.org/1999/xhtml",N=document.createElement.bind(document),O=document.createElementNS.bind(document);l=Object.__proto__||C?function(T,x){return T instanceof x}:function(T,x){if(T instanceof x)return!0;for(var k=T;k;){if(k===x.prototype)return!0;k=k.__proto__}return!1},n(Node.prototype,"cloneNode"),n(document,"importNode"),document.registerElement=v,document.createElement=y,document.createElementNS=u,h.registry=I,h.instanceof=l,h.reservedTagList=S,h.getRegisteredDefinition=i,document.register=document.registerElement}),function(h){function v(){p(window.wrap(document)),window.CustomElements.ready=!0;var o=window.requestAnimationFrame||function(i){setTimeout(i,16)};o(function(){setTimeout(function(){window.CustomElements.readyTime=Date.now(),window.HTMLImports&&(window.CustomElements.elapsed=window.CustomElements.readyTime-window.HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))})})}var f=h.useNative,d=h.initializeModules;if(h.isIE,f){var s=function(){};h.watchShadow=s,h.upgrade=s,h.upgradeAll=s,h.upgradeDocumentTree=s,h.upgradeSubtree=s,h.takeRecords=s,h.instanceof=function(o,i){return o instanceof i}}else d();var p=h.upgradeDocumentTree,m=h.upgradeDocument;if(window.wrap||(window.ShadowDOMPolyfill?(window.wrap=window.ShadowDOMPolyfill.wrapIfNeeded,window.unwrap=window.ShadowDOMPolyfill.unwrapIfNeeded):window.wrap=window.unwrap=function(o){return o}),window.HTMLImports&&(window.HTMLImports.__importsParsingHook=function(o){o.import&&m(wrap(o.import))}),document.readyState==="complete"||h.flags.eager)v();else if(document.readyState!=="interactive"||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var e=window.HTMLImports&&!window.HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(e,v)}else v()}(window.CustomElements))}.call(st),function(){}.call(st),function(){var E=this;(function(){(function(){this.Trix={VERSION:"1.3.1",ZERO_WIDTH_SPACE:"\uFEFF",NON_BREAKING_SPACE:"\xA0",OBJECT_REPLACEMENT_CHARACTER:"\uFFFC",browser:{composesExistingText:/Android.*Chrome/.test(navigator.userAgent),forcesObjectResizing:/Trident.*rv:11/.test(navigator.userAgent),supportsInputEvents:function(){var a,h,v,f;if(typeof InputEvent=="undefined")return!1;for(f=["data","getTargetRanges","inputType"],a=0,h=f.length;h>a;a++)if(v=f[a],!(v in InputEvent.prototype))return!1;return!0}()},config:{}}}).call(this)}).call(E);var t=E.Trix;(function(){(function(){t.BasicObject=function(){function a(){}var h,v,f;return a.proxyMethod=function(d){var s,p,m,e,o;return m=v(d),s=m.name,e=m.toMethod,o=m.toProperty,p=m.optional,this.prototype[s]=function(){var i,r;return i=e!=null?p?typeof this[e]=="function"?this[e]():void 0:this[e]():o!=null?this[o]:void 0,p?(r=i!=null?i[s]:void 0,r!=null?h.call(r,i,arguments):void 0):(r=i[s],h.call(r,i,arguments))}},v=function(d){var s,p;if(!(p=d.match(f)))throw new Error("can't parse @proxyMethod expression: "+d);return s={name:p[4]},p[2]!=null?s.toMethod=p[1]:s.toProperty=p[1],p[3]!=null&&(s.optional=!0),s},h=Function.prototype.apply,f=/^(.+?)(\(\))?(\?)?\.(.+?)$/,a}()}).call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.Object=function(v){function f(){this.id=++d}var d;return a(f,v),d=0,f.fromJSONString=function(s){return this.fromJSON(JSON.parse(s))},f.prototype.hasSameConstructorAs=function(s){return this.constructor===(s!=null?s.constructor:void 0)},f.prototype.isEqualTo=function(s){return this===s},f.prototype.inspect=function(){var s,p,m;return s=function(){var e,o,i;o=(e=this.contentsForInspection())!=null?e:{},i=[];for(p in o)m=o[p],i.push(p+"="+m);return i}.call(this),"#<"+this.constructor.name+":"+this.id+(s.length?" "+s.join(", "):"")+">"},f.prototype.contentsForInspection=function(){},f.prototype.toJSONString=function(){return JSON.stringify(this)},f.prototype.toUTF16String=function(){return t.UTF16String.box(this)},f.prototype.getCacheKey=function(){return this.id.toString()},f}(t.BasicObject)}.call(this),function(){t.extend=function(a){var h,v;for(h in a)v=a[h],this[h]=v;return this}}.call(this),function(){t.extend({defer:function(a){return setTimeout(a,1)}})}.call(this),function(){var a,h;t.extend({normalizeSpaces:function(v){return v.replace(RegExp(""+t.ZERO_WIDTH_SPACE,"g"),"").replace(RegExp(""+t.NON_BREAKING_SPACE,"g")," ")},normalizeNewlines:function(v){return v.replace(/\r\n/g,`
`)},breakableWhitespacePattern:RegExp("[^\\S"+t.NON_BREAKING_SPACE+"]"),squishBreakableWhitespace:function(v){return v.replace(RegExp(""+t.breakableWhitespacePattern.source,"g")," ").replace(/\ {2,}/g," ")},summarizeStringChange:function(v,f){var d,s,p,m;return v=t.UTF16String.box(v),f=t.UTF16String.box(f),f.length<v.length?(s=h(v,f),m=s[0],d=s[1]):(p=h(f,v),d=p[0],m=p[1]),{added:d,removed:m}}}),h=function(v,f){var d,s,p,m,e;return v.isEqualTo(f)?["",""]:(s=a(v,f),m=s.utf16String.length,p=m?(e=s.offset,d=v.codepoints.slice(0,e).concat(v.codepoints.slice(e+m)),a(f,t.UTF16String.fromCodepoints(d))):a(f,v),[s.utf16String.toString(),p.utf16String.toString()])},a=function(v,f){var d,s,p;for(d=0,s=v.length,p=f.length;s>d&&v.charAt(d).isEqualTo(f.charAt(d));)d++;for(;s>d+1&&v.charAt(s-1).isEqualTo(f.charAt(p-1));)s--,p--;return{utf16String:v.slice(d,s),offset:d}}}.call(this),function(){t.extend({copyObject:function(a){var h,v,f;a==null&&(a={}),v={};for(h in a)f=a[h],v[h]=f;return v},objectsAreEqual:function(a,h){var v,f;if(a==null&&(a={}),h==null&&(h={}),Object.keys(a).length!==Object.keys(h).length)return!1;for(v in a)if(f=a[v],f!==h[v])return!1;return!0}})}.call(this),function(){var a=[].slice;t.extend({arraysAreEqual:function(h,v){var f,d,s,p;if(h==null&&(h=[]),v==null&&(v=[]),h.length!==v.length)return!1;for(d=f=0,s=h.length;s>f;d=++f)if(p=h[d],p!==v[d])return!1;return!0},arrayStartsWith:function(h,v){return h==null&&(h=[]),v==null&&(v=[]),t.arraysAreEqual(h.slice(0,v.length),v)},spliceArray:function(){var h,v,f;return v=arguments[0],h=2<=arguments.length?a.call(arguments,1):[],f=v.slice(0),f.splice.apply(f,h),f},summarizeArrayChange:function(h,v){var f,d,s,p,m,e,o,i,r,c,u;for(h==null&&(h=[]),v==null&&(v=[]),f=[],c=[],s=new Set,p=0,o=h.length;o>p;p++)u=h[p],s.add(u);for(d=new Set,m=0,i=v.length;i>m;m++)u=v[m],d.add(u),s.has(u)||f.push(u);for(e=0,r=h.length;r>e;e++)u=h[e],d.has(u)||c.push(u);return{added:f,removed:c}}})}.call(this),function(){var a,h,v,f;a=null,h=null,f=null,v=null,t.extend({getAllAttributeNames:function(){return a??(a=t.getTextAttributeNames().concat(t.getBlockAttributeNames()))},getBlockConfig:function(d){return t.config.blockAttributes[d]},getBlockAttributeNames:function(){return h??(h=Object.keys(t.config.blockAttributes))},getTextConfig:function(d){return t.config.textAttributes[d]},getTextAttributeNames:function(){return f??(f=Object.keys(t.config.textAttributes))},getListAttributeNames:function(){var d,s;return v??(v=function(){var p,m;p=t.config.blockAttributes,m=[];for(d in p)s=p[d].listAttribute,s!=null&&m.push(s);return m}())}})}.call(this),function(){var a,h,v,f,d,s=[].indexOf||function(p){for(var m=0,e=this.length;e>m;m++)if(m in this&&this[m]===p)return m;return-1};a=document.documentElement,h=(v=(f=(d=a.matchesSelector)!=null?d:a.webkitMatchesSelector)!=null?f:a.msMatchesSelector)!=null?v:a.mozMatchesSelector,t.extend({handleEvent:function(p,m){var e,o,i,r,c,u,y,n,l,g,w,b;return n=m??{},u=n.onElement,c=n.matchingSelector,b=n.withCallback,r=n.inPhase,y=n.preventDefault,g=n.times,o=u??a,l=c,e=b,w=r==="capturing",i=function(A){var C;return g!=null&&--g==0&&i.destroy(),C=t.findClosestElementFromNode(A.target,{matchingSelector:l}),C!=null&&(b!=null&&b.call(C,A,C),y)?A.preventDefault():void 0},i.destroy=function(){return o.removeEventListener(p,i,w)},o.addEventListener(p,i,w),i},handleEventOnce:function(p,m){return m==null&&(m={}),m.times=1,t.handleEvent(p,m)},triggerEvent:function(p,m){var e,o,i,r,c,u,y;return y=m??{},u=y.onElement,o=y.bubbles,i=y.cancelable,e=y.attributes,r=u??a,o=o!==!1,i=i!==!1,c=document.createEvent("Events"),c.initEvent(p,o,i),e!=null&&t.extend.call(c,e),r.dispatchEvent(c)},elementMatchesSelector:function(p,m){return(p!=null?p.nodeType:void 0)===1?h.call(p,m):void 0},findClosestElementFromNode:function(p,m){var e,o,i;for(o=m??{},e=o.matchingSelector,i=o.untilNode;p!=null&&p.nodeType!==Node.ELEMENT_NODE;)p=p.parentNode;if(p!=null){if(e==null)return p;if(p.closest&&i==null)return p.closest(e);for(;p&&p!==i;){if(t.elementMatchesSelector(p,e))return p;p=p.parentNode}}},findInnerElement:function(p){for(;p!=null?p.firstElementChild:void 0;)p=p.firstElementChild;return p},innerElementIsActive:function(p){return document.activeElement!==p&&t.elementContainsNode(p,document.activeElement)},elementContainsNode:function(p,m){if(p&&m)for(;m;){if(m===p)return!0;m=m.parentNode}},findNodeFromContainerAndOffset:function(p,m){var e;if(p)return p.nodeType===Node.TEXT_NODE?p:m===0?(e=p.firstChild)!=null?e:p:p.childNodes.item(m-1)},findElementFromContainerAndOffset:function(p,m){var e;return e=t.findNodeFromContainerAndOffset(p,m),t.findClosestElementFromNode(e)},findChildIndexOfNode:function(p){var m;if(p!=null?p.parentNode:void 0){for(m=0;p=p.previousSibling;)m++;return m}},removeNode:function(p){var m;return p!=null&&(m=p.parentNode)!=null?m.removeChild(p):void 0},walkTree:function(p,m){var e,o,i,r,c;return i=m??{},o=i.onlyNodesOfType,r=i.usingFilter,e=i.expandEntityReferences,c=function(){switch(o){case"element":return NodeFilter.SHOW_ELEMENT;case"text":return NodeFilter.SHOW_TEXT;case"comment":return NodeFilter.SHOW_COMMENT;default:return NodeFilter.SHOW_ALL}}(),document.createTreeWalker(p,c,r??null,e===!0)},tagName:function(p){var m;return p!=null&&(m=p.tagName)!=null?m.toLowerCase():void 0},makeElement:function(p,m){var e,o,i,r,c,u,y,n,l,g,w,b,A,C;if(m==null&&(m={}),typeof p=="object"?(m=p,p=m.tagName):m={attributes:m},i=document.createElement(p),m.editable!=null&&(m.attributes==null&&(m.attributes={}),m.attributes.contenteditable=m.editable),m.attributes){l=m.attributes;for(u in l)C=l[u],i.setAttribute(u,C)}if(m.style){g=m.style;for(u in g)C=g[u],i.style[u]=C}if(m.data){w=m.data;for(u in w)C=w[u],i.dataset[u]=C}if(m.className)for(b=m.className.split(" "),r=0,y=b.length;y>r;r++)o=b[r],i.classList.add(o);if(m.textContent&&(i.textContent=m.textContent),m.childNodes)for(A=[].concat(m.childNodes),c=0,n=A.length;n>c;c++)e=A[c],i.appendChild(e);return i},getBlockTagNames:function(){var p,m;return t.blockTagNames!=null?t.blockTagNames:t.blockTagNames=function(){var e,o;e=t.config.blockAttributes,o=[];for(p in e)m=e[p].tagName,m&&o.push(m);return o}()},nodeIsBlockContainer:function(p){return t.nodeIsBlockStartComment(p!=null?p.firstChild:void 0)},nodeProbablyIsBlockContainer:function(p){var m,e;return m=t.tagName(p),s.call(t.getBlockTagNames(),m)>=0&&(e=t.tagName(p.firstChild),s.call(t.getBlockTagNames(),e)<0)},nodeIsBlockStart:function(p,m){var e;return e=(m??{strict:!0}).strict,e?t.nodeIsBlockStartComment(p):t.nodeIsBlockStartComment(p)||!t.nodeIsBlockStartComment(p.firstChild)&&t.nodeProbablyIsBlockContainer(p)},nodeIsBlockStartComment:function(p){return t.nodeIsCommentNode(p)&&(p!=null?p.data:void 0)==="block"},nodeIsCommentNode:function(p){return(p!=null?p.nodeType:void 0)===Node.COMMENT_NODE},nodeIsCursorTarget:function(p,m){var e;return e=(m??{}).name,p?t.nodeIsTextNode(p)?p.data===t.ZERO_WIDTH_SPACE?e?p.parentNode.dataset.trixCursorTarget===e:!0:void 0:t.nodeIsCursorTarget(p.firstChild):void 0},nodeIsAttachmentElement:function(p){return t.elementMatchesSelector(p,t.AttachmentView.attachmentSelector)},nodeIsEmptyTextNode:function(p){return t.nodeIsTextNode(p)&&(p!=null?p.data:void 0)===""},nodeIsTextNode:function(p){return(p!=null?p.nodeType:void 0)===Node.TEXT_NODE}})}.call(this),function(){var a,h,v,f,d;a=t.copyObject,f=t.objectsAreEqual,t.extend({normalizeRange:v=function(s){var p;if(s!=null)return Array.isArray(s)||(s=[s,s]),[h(s[0]),h((p=s[1])!=null?p:s[0])]},rangeIsCollapsed:function(s){var p,m,e;if(s!=null)return m=v(s),e=m[0],p=m[1],d(e,p)},rangesAreEqual:function(s,p){var m,e,o,i,r,c;if(s!=null&&p!=null)return o=v(s),e=o[0],m=o[1],i=v(p),c=i[0],r=i[1],d(e,c)&&d(m,r)}}),h=function(s){return typeof s=="number"?s:a(s)},d=function(s,p){return typeof s=="number"?s===p:f(s,p)}}.call(this),function(){var a,h,v,f,d,s,p;t.registerElement=function(m,e){var o,i;return e==null&&(e={}),m=m.toLowerCase(),e=p(e),i=s(e),(o=i.defaultCSS)&&(delete i.defaultCSS,f(o,m)),d(m,i)},f=function(m,e){var o;return o=v(e),o.textContent=m.replace(/%t/g,e)},v=function(m){var e,o;return e=document.createElement("style"),e.setAttribute("type","text/css"),e.setAttribute("data-tag-name",m.toLowerCase()),(o=a())&&e.setAttribute("nonce",o),document.head.insertBefore(e,document.head.firstChild),e},a=function(){var m;return(m=h("trix-csp-nonce")||h("csp-nonce"))?m.getAttribute("content"):void 0},h=function(m){return document.head.querySelector("meta[name="+m+"]")},s=function(m){var e,o,i;o={};for(e in m)i=m[e],o[e]=typeof i=="function"?{value:i}:i;return o},p=function(){var m;return m=function(e){var o,i,r,c,u;for(o={},u=["initialize","connect","disconnect"],i=0,c=u.length;c>i;i++)r=u[i],o[r]=e[r],delete e[r];return o},window.customElements?function(e){var o,i,r,c,u;return u=m(e),r=u.initialize,o=u.connect,i=u.disconnect,r&&(c=o,o=function(){return this.initialized||(this.initialized=!0,r.call(this)),c!=null?c.call(this):void 0}),o&&(e.connectedCallback=o),i&&(e.disconnectedCallback=i),e}:function(e){var o,i,r,c;return c=m(e),r=c.initialize,o=c.connect,i=c.disconnect,r&&(e.createdCallback=r),o&&(e.attachedCallback=o),i&&(e.detachedCallback=i),e}}(),d=function(){return window.customElements?function(m,e){var o;return o=function(){return typeof Reflect=="object"?Reflect.construct(HTMLElement,[],o):HTMLElement.apply(this)},Object.setPrototypeOf(o.prototype,HTMLElement.prototype),Object.setPrototypeOf(o,HTMLElement),Object.defineProperties(o.prototype,e),window.customElements.define(m,o),o}:function(m,e){var o,i;return i=Object.create(HTMLElement.prototype,e),o=document.registerElement(m,{prototype:i}),Object.defineProperty(i,"constructor",{value:o}),o}}()}.call(this),function(){var a,h;t.extend({getDOMSelection:function(){var v;return v=window.getSelection(),v.rangeCount>0?v:void 0},getDOMRange:function(){var v,f;return(v=(f=t.getDOMSelection())!=null?f.getRangeAt(0):void 0)&&!a(v)?v:void 0},setDOMRange:function(v){var f;return f=window.getSelection(),f.removeAllRanges(),f.addRange(v),t.selectionChangeObserver.update()}}),a=function(v){return h(v.startContainer)||h(v.endContainer)},h=function(v){return!Object.getPrototypeOf(v)}}.call(this),function(){var a;a={"application/x-trix-feature-detection":"test"},t.extend({dataTransferIsPlainText:function(h){var v,f,d;return d=h.getData("text/plain"),f=h.getData("text/html"),d&&f?(v=new DOMParser().parseFromString(f,"text/html").body,v.textContent===d?!v.querySelector("*"):void 0):d!=null?d.length:void 0},dataTransferIsWritable:function(h){var v,f;if((h!=null?h.setData:void 0)!=null){for(v in a)if(f=a[v],!function(){try{return h.setData(v,f),h.getData(v)===f}catch{}}())return;return!0}},keyEventIsKeyboardCommand:function(){return/Mac|^iP/.test(navigator.platform)?function(h){return h.metaKey}:function(h){return h.ctrlKey}}()})}.call(this),function(){t.extend({RTL_PATTERN:/[\u05BE\u05C0\u05C3\u05D0-\u05EA\u05F0-\u05F4\u061B\u061F\u0621-\u063A\u0640-\u064A\u066D\u0671-\u06B7\u06BA-\u06BE\u06C0-\u06CE\u06D0-\u06D5\u06E5\u06E6\u200F\u202B\u202E\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE72\uFE74\uFE76-\uFEFC]/,getDirection:function(){var a,h,v,f;return h=t.makeElement("input",{dir:"auto",name:"x",dirName:"x.dir"}),a=t.makeElement("form"),a.appendChild(h),v=function(){try{return new FormData(a).has(h.dirName)}catch{}}(),f=function(){try{return h.matches(":dir(ltr),:dir(rtl)")}catch{}}(),v?function(d){return h.value=d,new FormData(a).get(h.dirName)}:f?function(d){return h.value=d,h.matches(":dir(rtl)")?"rtl":"ltr"}:function(d){var s;return s=d.trim().charAt(0),t.RTL_PATTERN.test(s)?"rtl":"ltr"}}()})}.call(this),function(){}.call(this),function(){var a,h=function(f,d){function s(){this.constructor=f}for(var p in d)v.call(d,p)&&(f[p]=d[p]);return s.prototype=d.prototype,f.prototype=new s,f.__super__=d.prototype,f},v={}.hasOwnProperty;a=t.arraysAreEqual,t.Hash=function(f){function d(i){i==null&&(i={}),this.values=p(i),d.__super__.constructor.apply(this,arguments)}var s,p,m,e,o;return h(d,f),d.fromCommonAttributesOfObjects=function(i){var r,c,u,y,n,l;if(i==null&&(i=[]),!i.length)return new this;for(r=s(i[0]),u=r.getKeys(),l=i.slice(1),c=0,y=l.length;y>c;c++)n=l[c],u=r.getKeysCommonToHash(s(n)),r=r.slice(u);return r},d.box=function(i){return s(i)},d.prototype.add=function(i,r){return this.merge(e(i,r))},d.prototype.remove=function(i){return new t.Hash(p(this.values,i))},d.prototype.get=function(i){return this.values[i]},d.prototype.has=function(i){return i in this.values},d.prototype.merge=function(i){return new t.Hash(m(this.values,o(i)))},d.prototype.slice=function(i){var r,c,u,y;for(y={},r=0,u=i.length;u>r;r++)c=i[r],this.has(c)&&(y[c]=this.values[c]);return new t.Hash(y)},d.prototype.getKeys=function(){return Object.keys(this.values)},d.prototype.getKeysCommonToHash=function(i){var r,c,u,y,n;for(i=s(i),y=this.getKeys(),n=[],r=0,u=y.length;u>r;r++)c=y[r],this.values[c]===i.values[c]&&n.push(c);return n},d.prototype.isEqualTo=function(i){return a(this.toArray(),s(i).toArray())},d.prototype.isEmpty=function(){return this.getKeys().length===0},d.prototype.toArray=function(){var i,r,c;return(this.array!=null?this.array:this.array=function(){var u;r=[],u=this.values;for(i in u)c=u[i],r.push(i,c);return r}.call(this)).slice(0)},d.prototype.toObject=function(){return p(this.values)},d.prototype.toJSON=function(){return this.toObject()},d.prototype.contentsForInspection=function(){return{values:JSON.stringify(this.values)}},e=function(i,r){var c;return c={},c[i]=r,c},m=function(i,r){var c,u,y;u=p(i);for(c in r)y=r[c],u[c]=y;return u},p=function(i,r){var c,u,y,n,l;for(n={},l=Object.keys(i).sort(),c=0,y=l.length;y>c;c++)u=l[c],u!==r&&(n[u]=i[u]);return n},s=function(i){return i instanceof t.Hash?i:new t.Hash(i)},o=function(i){return i instanceof t.Hash?i.values:i},d}(t.Object)}.call(this),function(){t.ObjectGroup=function(){function a(h,v){var f,d;this.objects=h??[],d=v.depth,f=v.asTree,f&&(this.depth=d,this.objects=this.constructor.groupObjects(this.objects,{asTree:f,depth:this.depth+1}))}return a.groupObjects=function(h,v){var f,d,s,p,m,e,o,i,r;for(h==null&&(h=[]),r=v??{},s=r.depth,f=r.asTree,f&&s==null&&(s=0),i=[],m=0,e=h.length;e>m;m++){if(o=h[m],p){if((typeof o.canBeGrouped=="function"?o.canBeGrouped(s):void 0)&&(typeof(d=p[p.length-1]).canBeGroupedWith=="function"?d.canBeGroupedWith(o,s):void 0)){p.push(o);continue}i.push(new this(p,{depth:s,asTree:f})),p=null}(typeof o.canBeGrouped=="function"?o.canBeGrouped(s):void 0)?p=[o]:i.push(o)}return p&&i.push(new this(p,{depth:s,asTree:f})),i},a.prototype.getObjects=function(){return this.objects},a.prototype.getDepth=function(){return this.depth},a.prototype.getCacheKey=function(){var h,v,f,d,s;for(v=["objectGroup"],s=this.getObjects(),h=0,f=s.length;f>h;h++)d=s[h],v.push(d.getCacheKey());return v.join("/")},a}()}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.ObjectMap=function(v){function f(d){var s,p,m,e,o;for(d==null&&(d=[]),this.objects={},m=0,e=d.length;e>m;m++)o=d[m],p=JSON.stringify(o),(s=this.objects)[p]==null&&(s[p]=o)}return a(f,v),f.prototype.find=function(d){var s;return s=JSON.stringify(d),this.objects[s]},f}(t.BasicObject)}.call(this),function(){t.ElementStore=function(){function a(v){this.reset(v)}var h;return a.prototype.add=function(v){var f;return f=h(v),this.elements[f]=v},a.prototype.remove=function(v){var f,d;return f=h(v),(d=this.elements[f])?(delete this.elements[f],d):void 0},a.prototype.reset=function(v){var f,d,s;for(v==null&&(v=[]),this.elements={},d=0,s=v.length;s>d;d++)f=v[d],this.add(f);return v},h=function(v){return v.dataset.trixStoreKey},a}()}.call(this),function(){}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.Operation=function(v){function f(){return f.__super__.constructor.apply(this,arguments)}return a(f,v),f.prototype.isPerforming=function(){return this.performing===!0},f.prototype.hasPerformed=function(){return this.performed===!0},f.prototype.hasSucceeded=function(){return this.performed&&this.succeeded},f.prototype.hasFailed=function(){return this.performed&&!this.succeeded},f.prototype.getPromise=function(){return this.promise!=null?this.promise:this.promise=new Promise(function(d){return function(s,p){return d.performing=!0,d.perform(function(m,e){return d.succeeded=m,d.performing=!1,d.performed=!0,d.succeeded?s(e):p(e)})}}(this))},f.prototype.perform=function(d){return d(!1)},f.prototype.release=function(){var d;return(d=this.promise)!=null&&typeof d.cancel=="function"&&d.cancel(),this.promise=null,this.performing=null,this.performed=null,this.succeeded=null},f.proxyMethod("getPromise().then"),f.proxyMethod("getPromise().catch"),f}(t.BasicObject)}.call(this),function(){var a,h,v,f,d,s=function(m,e){function o(){this.constructor=m}for(var i in e)p.call(e,i)&&(m[i]=e[i]);return o.prototype=e.prototype,m.prototype=new o,m.__super__=e.prototype,m},p={}.hasOwnProperty;t.UTF16String=function(m){function e(o,i){this.ucs2String=o,this.codepoints=i,this.length=this.codepoints.length,this.ucs2Length=this.ucs2String.length}return s(e,m),e.box=function(o){return o==null&&(o=""),o instanceof this?o:this.fromUCS2String(o!=null?o.toString():void 0)},e.fromUCS2String=function(o){return new this(o,f(o))},e.fromCodepoints=function(o){return new this(d(o),o)},e.prototype.offsetToUCS2Offset=function(o){return d(this.codepoints.slice(0,Math.max(0,o))).length},e.prototype.offsetFromUCS2Offset=function(o){return f(this.ucs2String.slice(0,Math.max(0,o))).length},e.prototype.slice=function(){var o;return this.constructor.fromCodepoints((o=this.codepoints).slice.apply(o,arguments))},e.prototype.charAt=function(o){return this.slice(o,o+1)},e.prototype.isEqualTo=function(o){return this.constructor.box(o).ucs2String===this.ucs2String},e.prototype.toJSON=function(){return this.ucs2String},e.prototype.getCacheKey=function(){return this.ucs2String},e.prototype.toString=function(){return this.ucs2String},e}(t.BasicObject),a=(typeof Array.from=="function"?Array.from("\u{1F47C}").length:void 0)===1,h=(typeof" ".codePointAt=="function"?" ".codePointAt(0):void 0)!=null,v=(typeof String.fromCodePoint=="function"?String.fromCodePoint(32,128124):void 0)===" \u{1F47C}",f=a&&h?function(m){return Array.from(m).map(function(e){return e.codePointAt(0)})}:function(m){var e,o,i,r,c;for(r=[],e=0,i=m.length;i>e;)c=m.charCodeAt(e++),c>=55296&&56319>=c&&i>e&&(o=m.charCodeAt(e++),(64512&o)==56320?c=((1023&c)<<10)+(1023&o)+65536:e--),r.push(c);return r},d=v?function(m){return String.fromCodePoint.apply(String,m)}:function(m){var e,o,i;return e=function(){var r,c,u;for(u=[],r=0,c=m.length;c>r;r++)i=m[r],o="",i>65535&&(i-=65536,o+=String.fromCharCode(i>>>10&1023|55296),i=56320|1023&i),u.push(o+String.fromCharCode(i));return u}(),e.join("")}}.call(this),function(){}.call(this),function(){}.call(this),function(){t.config.lang={attachFiles:"Attach Files",bold:"Bold",bullets:"Bullets",byte:"Byte",bytes:"Bytes",captionPlaceholder:"Add a caption\u2026",code:"Code",heading1:"Heading",indent:"Increase Level",italic:"Italic",link:"Link",numbers:"Numbers",outdent:"Decrease Level",quote:"Quote",redo:"Redo",remove:"Remove",strike:"Strikethrough",undo:"Undo",unlink:"Unlink",url:"URL",urlPlaceholder:"Enter a URL\u2026",GB:"GB",KB:"KB",MB:"MB",PB:"PB",TB:"TB"}}.call(this),function(){t.config.css={attachment:"attachment",attachmentCaption:"attachment__caption",attachmentCaptionEditor:"attachment__caption-editor",attachmentMetadata:"attachment__metadata",attachmentMetadataContainer:"attachment__metadata-container",attachmentName:"attachment__name",attachmentProgress:"attachment__progress",attachmentSize:"attachment__size",attachmentToolbar:"attachment__toolbar",attachmentGallery:"attachment-gallery"}}.call(this),function(){var a;t.config.blockAttributes=a={default:{tagName:"div",parse:!1},quote:{tagName:"blockquote",nestable:!0},heading1:{tagName:"h1",terminal:!0,breakOnReturn:!0,group:!1},code:{tagName:"pre",terminal:!0,text:{plaintext:!0}},bulletList:{tagName:"ul",parse:!1},bullet:{tagName:"li",listAttribute:"bulletList",group:!1,nestable:!0,test:function(h){return t.tagName(h.parentNode)===a[this.listAttribute].tagName}},numberList:{tagName:"ol",parse:!1},number:{tagName:"li",listAttribute:"numberList",group:!1,nestable:!0,test:function(h){return t.tagName(h.parentNode)===a[this.listAttribute].tagName}},attachmentGallery:{tagName:"div",exclusive:!0,terminal:!0,parse:!1,group:!1}}}.call(this),function(){var a,h;a=t.config.lang,h=[a.bytes,a.KB,a.MB,a.GB,a.TB,a.PB],t.config.fileSize={prefix:"IEC",precision:2,formatter:function(v){var f,d,s,p,m;switch(v){case 0:return"0 "+a.bytes;case 1:return"1 "+a.byte;default:return f=function(){switch(this.prefix){case"SI":return 1e3;case"IEC":return 1024}}.call(this),d=Math.floor(Math.log(v)/Math.log(f)),s=v/Math.pow(f,d),p=s.toFixed(this.precision),m=p.replace(/0*$/,"").replace(/\.$/,""),m+" "+h[d]}}}}.call(this),function(){t.config.textAttributes={bold:{tagName:"strong",inheritable:!0,parser:function(a){var h;return h=window.getComputedStyle(a),h.fontWeight==="bold"||h.fontWeight>=600}},italic:{tagName:"em",inheritable:!0,parser:function(a){var h;return h=window.getComputedStyle(a),h.fontStyle==="italic"}},href:{groupTagName:"a",parser:function(a){var h,v,f;return h=t.AttachmentView.attachmentSelector,f="a:not("+h+")",(v=t.findClosestElementFromNode(a,{matchingSelector:f}))?v.getAttribute("href"):void 0}},strike:{tagName:"del",inheritable:!0},frozen:{style:{backgroundColor:"highlight"}}}}.call(this),function(){var a,h,v,f,d;d="[data-trix-serialize=false]",f=["contenteditable","data-trix-id","data-trix-store-key","data-trix-mutable","data-trix-placeholder","tabindex"],h="data-trix-serialized-attributes",v="["+h+"]",a=new RegExp("<!--block-->","g"),t.extend({serializers:{"application/json":function(s){var p;if(s instanceof t.Document)p=s;else{if(!(s instanceof HTMLElement))throw new Error("unserializable object");p=t.Document.fromHTML(s.innerHTML)}return p.toSerializableDocument().toJSONString()},"text/html":function(s){var p,m,e,o,i,r,c,u,y,n,l,g,w,b,A,C,S;if(s instanceof t.Document)o=t.DocumentView.render(s);else{if(!(s instanceof HTMLElement))throw new Error("unserializable object");o=s.cloneNode(!0)}for(b=o.querySelectorAll(d),i=0,y=b.length;y>i;i++)e=b[i],t.removeNode(e);for(r=0,n=f.length;n>r;r++)for(p=f[r],A=o.querySelectorAll("["+p+"]"),c=0,l=A.length;l>c;c++)e=A[c],e.removeAttribute(p);for(C=o.querySelectorAll(v),u=0,g=C.length;g>u;u++){e=C[u];try{m=JSON.parse(e.getAttribute(h)),e.removeAttribute(h);for(w in m)S=m[w],e.setAttribute(w,S)}catch{}}return o.innerHTML.replace(a,"")}},deserializers:{"application/json":function(s){return t.Document.fromJSONString(s)},"text/html":function(s){return t.Document.fromHTML(s)}},serializeToContentType:function(s,p){var m;if(m=t.serializers[p])return m(s);throw new Error("unknown content type: "+p)},deserializeFromContentType:function(s,p){var m;if(m=t.deserializers[p])return m(s);throw new Error("unknown content type: "+p)}})}.call(this),function(){var a;a=t.config.lang,t.config.toolbar={getDefaultHTML:function(){return`<div class="trix-button-row">
  <span class="trix-button-group trix-button-group--text-tools" data-trix-button-group="text-tools">
    <button type="button" class="trix-button trix-button--icon trix-button--icon-bold" data-trix-attribute="bold" data-trix-key="b" title="`+a.bold+'" tabindex="-1">'+a.bold+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-italic" data-trix-attribute="italic" data-trix-key="i" title="`+a.italic+'" tabindex="-1">'+a.italic+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-strike" data-trix-attribute="strike" title="`+a.strike+'" tabindex="-1">'+a.strike+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-link" data-trix-attribute="href" data-trix-action="link" data-trix-key="k" title="`+a.link+'" tabindex="-1">'+a.link+`</button>
  </span>

  <span class="trix-button-group trix-button-group--block-tools" data-trix-button-group="block-tools">
    <button type="button" class="trix-button trix-button--icon trix-button--icon-heading-1" data-trix-attribute="heading1" title="`+a.heading1+'" tabindex="-1">'+a.heading1+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-quote" data-trix-attribute="quote" title="`+a.quote+'" tabindex="-1">'+a.quote+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-code" data-trix-attribute="code" title="`+a.code+'" tabindex="-1">'+a.code+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-bullet-list" data-trix-attribute="bullet" title="`+a.bullets+'" tabindex="-1">'+a.bullets+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-number-list" data-trix-attribute="number" title="`+a.numbers+'" tabindex="-1">'+a.numbers+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-decrease-nesting-level" data-trix-action="decreaseNestingLevel" title="`+a.outdent+'" tabindex="-1">'+a.outdent+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-increase-nesting-level" data-trix-action="increaseNestingLevel" title="`+a.indent+'" tabindex="-1">'+a.indent+`</button>
  </span>

  <span class="trix-button-group trix-button-group--file-tools" data-trix-button-group="file-tools">
    <button type="button" class="trix-button trix-button--icon trix-button--icon-attach" data-trix-action="attachFiles" title="`+a.attachFiles+'" tabindex="-1">'+a.attachFiles+`</button>
  </span>

  <span class="trix-button-group-spacer"></span>

  <span class="trix-button-group trix-button-group--history-tools" data-trix-button-group="history-tools">
    <button type="button" class="trix-button trix-button--icon trix-button--icon-undo" data-trix-action="undo" data-trix-key="z" title="`+a.undo+'" tabindex="-1">'+a.undo+`</button>
    <button type="button" class="trix-button trix-button--icon trix-button--icon-redo" data-trix-action="redo" data-trix-key="shift+z" title="`+a.redo+'" tabindex="-1">'+a.redo+`</button>
  </span>
</div>

<div class="trix-dialogs" data-trix-dialogs>
  <div class="trix-dialog trix-dialog--link" data-trix-dialog="href" data-trix-dialog-attribute="href">
    <div class="trix-dialog__link-fields">
      <input type="url" name="href" class="trix-input trix-input--dialog" placeholder="`+a.urlPlaceholder+'" aria-label="'+a.url+`" required data-trix-input>
      <div class="trix-button-group">
        <input type="button" class="trix-button trix-button--dialog" value="`+a.link+`" data-trix-method="setAttribute">
        <input type="button" class="trix-button trix-button--dialog" value="`+a.unlink+`" data-trix-method="removeAttribute">
      </div>
    </div>
  </div>
</div>`}}}.call(this),function(){t.config.undoInterval=5e3}.call(this),function(){t.config.attachments={preview:{presentation:"gallery",caption:{name:!0,size:!0}},file:{caption:{size:!0}}}}.call(this),function(){t.config.keyNames={8:"backspace",9:"tab",13:"return",27:"escape",37:"left",39:"right",46:"delete",68:"d",72:"h",79:"o"}}.call(this),function(){t.config.input={level2Enabled:!0,getLevel:function(){return this.level2Enabled&&t.browser.supportsInputEvents?2:0},pickFiles:function(a){var h;return h=t.makeElement("input",{type:"file",multiple:!0,hidden:!0,id:this.fileInputId}),h.addEventListener("change",function(){return a(h.files),t.removeNode(h)}),t.removeNode(document.getElementById(this.fileInputId)),document.body.appendChild(h),h.click()},fileInputId:"trix-file-input-"+Date.now().toString(16)}}.call(this),function(){}.call(this),function(){t.registerElement("trix-toolbar",{defaultCSS:`%t {
  display: block;
}

%t {
  white-space: nowrap;
}

%t [data-trix-dialog] {
  display: none;
}

%t [data-trix-dialog][data-trix-active] {
  display: block;
}

%t [data-trix-dialog] [data-trix-validate]:invalid {
  background-color: #ffdddd;
}`,initialize:function(){return this.innerHTML===""?this.innerHTML=t.config.toolbar.getDefaultHTML():void 0}})}.call(this),function(){var a=function(f,d){function s(){this.constructor=f}for(var p in d)h.call(d,p)&&(f[p]=d[p]);return s.prototype=d.prototype,f.prototype=new s,f.__super__=d.prototype,f},h={}.hasOwnProperty,v=[].indexOf||function(f){for(var d=0,s=this.length;s>d;d++)if(d in this&&this[d]===f)return d;return-1};t.ObjectView=function(f){function d(s,p){this.object=s,this.options=p??{},this.childViews=[],this.rootView=this}return a(d,f),d.prototype.getNodes=function(){var s,p,m,e,o;for(this.nodes==null&&(this.nodes=this.createNodes()),e=this.nodes,o=[],s=0,p=e.length;p>s;s++)m=e[s],o.push(m.cloneNode(!0));return o},d.prototype.invalidate=function(){var s;return this.nodes=null,this.childViews=[],(s=this.parentView)!=null?s.invalidate():void 0},d.prototype.invalidateViewForObject=function(s){var p;return(p=this.findViewForObject(s))!=null?p.invalidate():void 0},d.prototype.findOrCreateCachedChildView=function(s,p){var m;return(m=this.getCachedViewForObject(p))?this.recordChildView(m):(m=this.createChildView.apply(this,arguments),this.cacheViewForObject(m,p)),m},d.prototype.createChildView=function(s,p,m){var e;return m==null&&(m={}),p instanceof t.ObjectGroup&&(m.viewClass=s,s=t.ObjectGroupView),e=new s(p,m),this.recordChildView(e)},d.prototype.recordChildView=function(s){return s.parentView=this,s.rootView=this.rootView,this.childViews.push(s),s},d.prototype.getAllChildViews=function(){var s,p,m,e,o;for(o=[],e=this.childViews,p=0,m=e.length;m>p;p++)s=e[p],o.push(s),o=o.concat(s.getAllChildViews());return o},d.prototype.findElement=function(){return this.findElementForObject(this.object)},d.prototype.findElementForObject=function(s){var p;return(p=s!=null?s.id:void 0)?this.rootView.element.querySelector("[data-trix-id='"+p+"']"):void 0},d.prototype.findViewForObject=function(s){var p,m,e,o;for(e=this.getAllChildViews(),p=0,m=e.length;m>p;p++)if(o=e[p],o.object===s)return o},d.prototype.getViewCache=function(){return this.rootView!==this?this.rootView.getViewCache():this.isViewCachingEnabled()?this.viewCache!=null?this.viewCache:this.viewCache={}:void 0},d.prototype.isViewCachingEnabled=function(){return this.shouldCacheViews!==!1},d.prototype.enableViewCaching=function(){return this.shouldCacheViews=!0},d.prototype.disableViewCaching=function(){return this.shouldCacheViews=!1},d.prototype.getCachedViewForObject=function(s){var p;return(p=this.getViewCache())!=null?p[s.getCacheKey()]:void 0},d.prototype.cacheViewForObject=function(s,p){var m;return(m=this.getViewCache())!=null?m[p.getCacheKey()]=s:void 0},d.prototype.garbageCollectCachedViews=function(){var s,p,m,e,o,i;if(s=this.getViewCache()){i=this.getAllChildViews().concat(this),m=function(){var r,c,u;for(u=[],r=0,c=i.length;c>r;r++)o=i[r],u.push(o.object.getCacheKey());return u}(),e=[];for(p in s)v.call(m,p)<0&&e.push(delete s[p]);return e}},d}(t.BasicObject)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.ObjectGroupView=function(v){function f(){f.__super__.constructor.apply(this,arguments),this.objectGroup=this.object,this.viewClass=this.options.viewClass,delete this.options.viewClass}return a(f,v),f.prototype.getChildViews=function(){var d,s,p,m;if(!this.childViews.length)for(m=this.objectGroup.getObjects(),d=0,s=m.length;s>d;d++)p=m[d],this.findOrCreateCachedChildView(this.viewClass,p,this.options);return this.childViews},f.prototype.createNodes=function(){var d,s,p,m,e,o,i,r,c;for(d=this.createContainerElement(),i=this.getChildViews(),s=0,m=i.length;m>s;s++)for(c=i[s],r=c.getNodes(),p=0,e=r.length;e>p;p++)o=r[p],d.appendChild(o);return[d]},f.prototype.createContainerElement=function(d){return d==null&&(d=this.objectGroup.getDepth()),this.getChildViews()[0].createContainerElement(d)},f}(t.ObjectView)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.Controller=function(v){function f(){return f.__super__.constructor.apply(this,arguments)}return a(f,v),f}(t.BasicObject)}.call(this),function(){var a,h,v,f,d,s,p=function(i,r){return function(){return i.apply(r,arguments)}},m=function(i,r){function c(){this.constructor=i}for(var u in r)e.call(r,u)&&(i[u]=r[u]);return c.prototype=r.prototype,i.prototype=new c,i.__super__=r.prototype,i},e={}.hasOwnProperty,o=[].indexOf||function(i){for(var r=0,c=this.length;c>r;r++)if(r in this&&this[r]===i)return r;return-1};a=t.findClosestElementFromNode,v=t.nodeIsEmptyTextNode,h=t.nodeIsBlockStartComment,f=t.normalizeSpaces,d=t.summarizeStringChange,s=t.tagName,t.MutationObserver=function(i){function r(l){this.element=l,this.didMutate=p(this.didMutate,this),this.observer=new window.MutationObserver(this.didMutate),this.start()}var c,u,y,n;return m(r,i),u="data-trix-mutable",y="["+u+"]",n={attributes:!0,childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0},r.prototype.start=function(){return this.reset(),this.observer.observe(this.element,n)},r.prototype.stop=function(){return this.observer.disconnect()},r.prototype.didMutate=function(l){var g,w;return(g=this.mutations).push.apply(g,this.findSignificantMutations(l)),this.mutations.length?((w=this.delegate)!=null&&typeof w.elementDidMutate=="function"&&w.elementDidMutate(this.getMutationSummary()),this.reset()):void 0},r.prototype.reset=function(){return this.mutations=[]},r.prototype.findSignificantMutations=function(l){var g,w,b,A;for(A=[],g=0,w=l.length;w>g;g++)b=l[g],this.mutationIsSignificant(b)&&A.push(b);return A},r.prototype.mutationIsSignificant=function(l){var g,w,b,A;if(this.nodeIsMutable(l.target))return!1;for(A=this.nodesModifiedByMutation(l),g=0,w=A.length;w>g;g++)if(b=A[g],this.nodeIsSignificant(b))return!0;return!1},r.prototype.nodeIsSignificant=function(l){return l!==this.element&&!this.nodeIsMutable(l)&&!v(l)},r.prototype.nodeIsMutable=function(l){return a(l,{matchingSelector:y})},r.prototype.nodesModifiedByMutation=function(l){var g;switch(g=[],l.type){case"attributes":l.attributeName!==u&&g.push(l.target);break;case"characterData":g.push(l.target.parentNode),g.push(l.target);break;case"childList":g.push.apply(g,l.addedNodes),g.push.apply(g,l.removedNodes)}return g},r.prototype.getMutationSummary=function(){return this.getTextMutationSummary()},r.prototype.getTextMutationSummary=function(){var l,g,w,b,A,C,S,I,P,N,O;for(I=this.getTextChangesFromCharacterData(),w=I.additions,A=I.deletions,O=this.getTextChangesFromChildList(),P=O.additions,C=0,S=P.length;S>C;C++)g=P[C],o.call(w,g)<0&&w.push(g);return A.push.apply(A,O.deletions),N={},(l=w.join(""))&&(N.textAdded=l),(b=A.join(""))&&(N.textDeleted=b),N},r.prototype.getMutationsByType=function(l){var g,w,b,A,C;for(A=this.mutations,C=[],g=0,w=A.length;w>g;g++)b=A[g],b.type===l&&C.push(b);return C},r.prototype.getTextChangesFromChildList=function(){var l,g,w,b,A,C,S,I,P,N,O;for(l=[],S=[],C=this.getMutationsByType("childList"),g=0,b=C.length;b>g;g++)A=C[g],l.push.apply(l,A.addedNodes),S.push.apply(S,A.removedNodes);return I=l.length===0&&S.length===1&&h(S[0]),I?(N=[],O=[`
`]):(N=c(l),O=c(S)),{additions:function(){var T,x,k;for(k=[],w=T=0,x=N.length;x>T;w=++T)P=N[w],P!==O[w]&&k.push(f(P));return k}(),deletions:function(){var T,x,k;for(k=[],w=T=0,x=O.length;x>T;w=++T)P=O[w],P!==N[w]&&k.push(f(P));return k}()}},r.prototype.getTextChangesFromCharacterData=function(){var l,g,w,b,A,C,S,I;return g=this.getMutationsByType("characterData"),g.length&&(I=g[0],w=g[g.length-1],A=f(I.oldValue),b=f(w.target.data),C=d(A,b),l=C.added,S=C.removed),{additions:l?[l]:[],deletions:S?[S]:[]}},c=function(l){var g,w,b,A;for(l==null&&(l=[]),A=[],g=0,w=l.length;w>g;g++)switch(b=l[g],b.nodeType){case Node.TEXT_NODE:A.push(b.data);break;case Node.ELEMENT_NODE:s(b)==="br"?A.push(`
`):A.push.apply(A,c(b.childNodes))}return A},r}(t.BasicObject)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.FileVerificationOperation=function(v){function f(d){this.file=d}return a(f,v),f.prototype.perform=function(d){var s;return s=new FileReader,s.onerror=function(){return d(!1)},s.onload=function(p){return function(){s.onerror=null;try{s.abort()}catch{}return d(!0,p.file)}}(this),s.readAsArrayBuffer(this.file)},f}(t.Operation)}.call(this),function(){var a,h,v=function(d,s){function p(){this.constructor=d}for(var m in s)f.call(s,m)&&(d[m]=s[m]);return p.prototype=s.prototype,d.prototype=new p,d.__super__=s.prototype,d},f={}.hasOwnProperty;a=t.handleEvent,h=t.innerElementIsActive,t.InputController=function(d){function s(p){var m;this.element=p,this.mutationObserver=new t.MutationObserver(this.element),this.mutationObserver.delegate=this;for(m in this.events)a(m,{onElement:this.element,withCallback:this.handlerFor(m)})}return v(s,d),s.prototype.events={},s.prototype.elementDidMutate=function(){},s.prototype.editorWillSyncDocumentView=function(){return this.mutationObserver.stop()},s.prototype.editorDidSyncDocumentView=function(){return this.mutationObserver.start()},s.prototype.requestRender=function(){var p;return(p=this.delegate)!=null&&typeof p.inputControllerDidRequestRender=="function"?p.inputControllerDidRequestRender():void 0},s.prototype.requestReparse=function(){var p;return(p=this.delegate)!=null&&typeof p.inputControllerDidRequestReparse=="function"&&p.inputControllerDidRequestReparse(),this.requestRender()},s.prototype.attachFiles=function(p){var m,e;return e=function(){var o,i,r;for(r=[],o=0,i=p.length;i>o;o++)m=p[o],r.push(new t.FileVerificationOperation(m));return r}(),Promise.all(e).then(function(o){return function(i){return o.handleInput(function(){var r,c;return(r=this.delegate)!=null&&r.inputControllerWillAttachFiles(),(c=this.responder)!=null&&c.insertFiles(i),this.requestRender()})}}(this))},s.prototype.handlerFor=function(p){return function(m){return function(e){return e.defaultPrevented?void 0:m.handleInput(function(){return h(this.element)?void 0:(this.eventName=p,this.events[p].call(this,e))})}}(this)},s.prototype.handleInput=function(p){var m,e;try{return(m=this.delegate)!=null&&m.inputControllerWillHandleInput(),p.call(this)}finally{(e=this.delegate)!=null&&e.inputControllerDidHandleInput()}},s.prototype.createLinkHTML=function(p,m){var e;return e=document.createElement("a"),e.href=p,e.textContent=m??p,e.outerHTML},s}(t.BasicObject)}.call(this),function(){var a,h,v,f,d,s,p,m,e,o,i,r,c,u=function(l,g){function w(){this.constructor=l}for(var b in g)y.call(g,b)&&(l[b]=g[b]);return w.prototype=g.prototype,l.prototype=new w,l.__super__=g.prototype,l},y={}.hasOwnProperty,n=[].indexOf||function(l){for(var g=0,w=this.length;w>g;g++)if(g in this&&this[g]===l)return g;return-1};e=t.makeElement,o=t.objectsAreEqual,c=t.tagName,h=t.browser,p=t.keyEventIsKeyboardCommand,f=t.dataTransferIsWritable,v=t.dataTransferIsPlainText,m=t.config.keyNames,t.Level0InputController=function(l){function g(){g.__super__.constructor.apply(this,arguments),this.resetInputSummary()}var w;return u(g,l),w=0,g.prototype.setInputSummary=function(b){var A,C;b==null&&(b={}),this.inputSummary.eventName=this.eventName;for(A in b)C=b[A],this.inputSummary[A]=C;return this.inputSummary},g.prototype.resetInputSummary=function(){return this.inputSummary={}},g.prototype.reset=function(){return this.resetInputSummary(),t.selectionChangeObserver.reset()},g.prototype.elementDidMutate=function(b){var A;return this.isComposing()?(A=this.delegate)!=null&&typeof A.inputControllerDidAllowUnhandledInput=="function"?A.inputControllerDidAllowUnhandledInput():void 0:this.handleInput(function(){return this.mutationIsSignificant(b)&&(this.mutationIsExpected(b)?this.requestRender():this.requestReparse()),this.reset()})},g.prototype.mutationIsExpected=function(b){var A,C,S,I,P,N,O,T,x,k;return O=b.textAdded,T=b.textDeleted,this.inputSummary.preferDocument?!0:(A=O!=null?O===this.inputSummary.textAdded:!this.inputSummary.textAdded,C=T!=null?this.inputSummary.didDelete:!this.inputSummary.didDelete,x=(O===`
`||O===` 
`)&&!A,k=T===`
`&&!C,N=x&&!k||k&&!x,N&&(I=this.getSelectedRange())&&(S=x?O.replace(/\n$/,"").length||-1:(O!=null?O.length:void 0)||1,(P=this.responder)!=null?P.positionIsBlockBreak(I[1]+S):void 0)?!0:A&&C)},g.prototype.mutationIsSignificant=function(b){var A,C,S;return S=Object.keys(b).length>0,A=((C=this.compositionInput)!=null?C.getEndData():void 0)==="",S||!A},g.prototype.events={keydown:function(b){var A,C,S,I,P,N,O,T,x;if(this.isComposing()||this.resetInputSummary(),this.inputSummary.didInput=!0,I=m[b.keyCode]){for(C=this.keys,T=["ctrl","alt","shift","meta"],S=0,N=T.length;N>S;S++)O=T[S],b[O+"Key"]&&(O==="ctrl"&&(O="control"),C=C!=null?C[O]:void 0);(C!=null?C[I]:void 0)!=null&&(this.setInputSummary({keyName:I}),t.selectionChangeObserver.reset(),C[I].call(this,b))}return p(b)&&(A=String.fromCharCode(b.keyCode).toLowerCase())&&(P=function(){var k,D,M,F;for(M=["alt","shift"],F=[],k=0,D=M.length;D>k;k++)O=M[k],b[O+"Key"]&&F.push(O);return F}(),P.push(A),(x=this.delegate)!=null?x.inputControllerDidReceiveKeyboardCommand(P):void 0)?b.preventDefault():void 0},keypress:function(b){var A,C,S;if(this.inputSummary.eventName==null&&!b.metaKey&&(!b.ctrlKey||b.altKey))return(S=r(b))?((A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),(C=this.responder)!=null&&C.insertString(S),this.setInputSummary({textAdded:S,didDelete:this.selectionIsExpanded()})):void 0},textInput:function(b){var A,C,S,I;return A=b.data,I=this.inputSummary.textAdded,I&&I!==A&&I.toUpperCase()===A?(C=this.getSelectedRange(),this.setSelectedRange([C[0],C[1]+I.length]),(S=this.responder)!=null&&S.insertString(A),this.setInputSummary({textAdded:A}),this.setSelectedRange(C)):void 0},dragenter:function(b){return b.preventDefault()},dragstart:function(b){var A,C;return C=b.target,this.serializeSelectionToDataTransfer(b.dataTransfer),this.draggedRange=this.getSelectedRange(),(A=this.delegate)!=null&&typeof A.inputControllerDidStartDrag=="function"?A.inputControllerDidStartDrag():void 0},dragover:function(b){var A,C;return!this.draggedRange&&!this.canAcceptDataTransfer(b.dataTransfer)||(b.preventDefault(),A={x:b.clientX,y:b.clientY},o(A,this.draggingPoint))?void 0:(this.draggingPoint=A,(C=this.delegate)!=null&&typeof C.inputControllerDidReceiveDragOverPoint=="function"?C.inputControllerDidReceiveDragOverPoint(this.draggingPoint):void 0)},dragend:function(){var b;return(b=this.delegate)!=null&&typeof b.inputControllerDidCancelDrag=="function"&&b.inputControllerDidCancelDrag(),this.draggedRange=null,this.draggingPoint=null},drop:function(b){var A,C,S,I,P,N,O,T,x;return b.preventDefault(),S=(P=b.dataTransfer)!=null?P.files:void 0,I={x:b.clientX,y:b.clientY},(N=this.responder)!=null&&N.setLocationRangeFromPointRange(I),(S!=null?S.length:void 0)?this.attachFiles(S):this.draggedRange?((O=this.delegate)!=null&&O.inputControllerWillMoveText(),(T=this.responder)!=null&&T.moveTextFromRange(this.draggedRange),this.draggedRange=null,this.requestRender()):(C=b.dataTransfer.getData("application/x-trix-document"))&&(A=t.Document.fromJSONString(C),(x=this.responder)!=null&&x.insertDocument(A),this.requestRender()),this.draggedRange=null,this.draggingPoint=null},cut:function(b){var A,C;return((A=this.responder)!=null?A.selectionIsExpanded():void 0)&&(this.serializeSelectionToDataTransfer(b.clipboardData)&&b.preventDefault(),(C=this.delegate)!=null&&C.inputControllerWillCutText(),this.deleteInDirection("backward"),b.defaultPrevented)?this.requestRender():void 0},copy:function(b){var A;return((A=this.responder)!=null?A.selectionIsExpanded():void 0)&&this.serializeSelectionToDataTransfer(b.clipboardData)?b.preventDefault():void 0},paste:function(b){var A,C,S,I,P,N,O,T,x,k,D,M,F,W,V,H,q,K,J,Z,G,it,rt;return A=(T=b.clipboardData)!=null?T:b.testClipboardData,O={clipboard:A},A==null||i(b)?void this.getPastedHTMLUsingHiddenElement(function(nt){return function(ct){var et,z,U;return O.type="text/html",O.html=ct,(et=nt.delegate)!=null&&et.inputControllerWillPaste(O),(z=nt.responder)!=null&&z.insertHTML(O.html),nt.requestRender(),(U=nt.delegate)!=null?U.inputControllerDidPaste(O):void 0}}(this)):((I=A.getData("URL"))?(O.type="text/html",rt=(N=A.getData("public.url-name"))?t.squishBreakableWhitespace(N).trim():I,O.html=this.createLinkHTML(I,rt),(x=this.delegate)!=null&&x.inputControllerWillPaste(O),this.setInputSummary({textAdded:rt,didDelete:this.selectionIsExpanded()}),(V=this.responder)!=null&&V.insertHTML(O.html),this.requestRender(),(H=this.delegate)!=null&&H.inputControllerDidPaste(O)):v(A)?(O.type="text/plain",O.string=A.getData("text/plain"),(q=this.delegate)!=null&&q.inputControllerWillPaste(O),this.setInputSummary({textAdded:O.string,didDelete:this.selectionIsExpanded()}),(K=this.responder)!=null&&K.insertString(O.string),this.requestRender(),(J=this.delegate)!=null&&J.inputControllerDidPaste(O)):(P=A.getData("text/html"))?(O.type="text/html",O.html=P,(Z=this.delegate)!=null&&Z.inputControllerWillPaste(O),(G=this.responder)!=null&&G.insertHTML(O.html),this.requestRender(),(it=this.delegate)!=null&&it.inputControllerDidPaste(O)):n.call(A.types,"Files")>=0&&(S=(k=A.items)!=null&&(D=k[0])!=null&&typeof D.getAsFile=="function"?D.getAsFile():void 0)&&(!S.name&&(C=d(S))&&(S.name="pasted-file-"+ ++w+"."+C),O.type="File",O.file=S,(M=this.delegate)!=null&&M.inputControllerWillAttachFiles(),(F=this.responder)!=null&&F.insertFile(O.file),this.requestRender(),(W=this.delegate)!=null&&W.inputControllerDidPaste(O)),b.preventDefault())},compositionstart:function(b){return this.getCompositionInput().start(b.data)},compositionupdate:function(b){return this.getCompositionInput().update(b.data)},compositionend:function(b){return this.getCompositionInput().end(b.data)},beforeinput:function(){return this.inputSummary.didInput=!0},input:function(b){return this.inputSummary.didInput=!0,b.stopPropagation()}},g.prototype.keys={backspace:function(b){var A;return(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),this.deleteInDirection("backward",b)},delete:function(b){var A;return(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),this.deleteInDirection("forward",b)},return:function(){var b,A;return this.setInputSummary({preferDocument:!0}),(b=this.delegate)!=null&&b.inputControllerWillPerformTyping(),(A=this.responder)!=null?A.insertLineBreak():void 0},tab:function(b){var A,C;return((A=this.responder)!=null?A.canIncreaseNestingLevel():void 0)?((C=this.responder)!=null&&C.increaseNestingLevel(),this.requestRender(),b.preventDefault()):void 0},left:function(b){var A;return this.selectionIsInCursorTarget()?(b.preventDefault(),(A=this.responder)!=null?A.moveCursorInDirection("backward"):void 0):void 0},right:function(b){var A;return this.selectionIsInCursorTarget()?(b.preventDefault(),(A=this.responder)!=null?A.moveCursorInDirection("forward"):void 0):void 0},control:{d:function(b){var A;return(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),this.deleteInDirection("forward",b)},h:function(b){var A;return(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),this.deleteInDirection("backward",b)},o:function(b){var A,C;return b.preventDefault(),(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),(C=this.responder)!=null&&C.insertString(`
`,{updatePosition:!1}),this.requestRender()}},shift:{return:function(b){var A,C;return(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),(C=this.responder)!=null&&C.insertString(`
`),this.requestRender(),b.preventDefault()},tab:function(b){var A,C;return((A=this.responder)!=null?A.canDecreaseNestingLevel():void 0)?((C=this.responder)!=null&&C.decreaseNestingLevel(),this.requestRender(),b.preventDefault()):void 0},left:function(b){return this.selectionIsInCursorTarget()?(b.preventDefault(),this.expandSelectionInDirection("backward")):void 0},right:function(b){return this.selectionIsInCursorTarget()?(b.preventDefault(),this.expandSelectionInDirection("forward")):void 0}},alt:{backspace:function(){var b;return this.setInputSummary({preferDocument:!1}),(b=this.delegate)!=null?b.inputControllerWillPerformTyping():void 0}},meta:{backspace:function(){var b;return this.setInputSummary({preferDocument:!1}),(b=this.delegate)!=null?b.inputControllerWillPerformTyping():void 0}}},g.prototype.getCompositionInput=function(){return this.isComposing()?this.compositionInput:this.compositionInput=new a(this)},g.prototype.isComposing=function(){return this.compositionInput!=null&&!this.compositionInput.isEnded()},g.prototype.deleteInDirection=function(b,A){var C;return((C=this.responder)!=null?C.deleteInDirection(b):void 0)!==!1?this.setInputSummary({didDelete:!0}):A?(A.preventDefault(),this.requestRender()):void 0},g.prototype.serializeSelectionToDataTransfer=function(b){var A,C;if(f(b))return A=(C=this.responder)!=null?C.getSelectedDocument().toSerializableDocument():void 0,b.setData("application/x-trix-document",JSON.stringify(A)),b.setData("text/html",t.DocumentView.render(A).innerHTML),b.setData("text/plain",A.toString().replace(/\n$/,"")),!0},g.prototype.canAcceptDataTransfer=function(b){var A,C,S,I,P,N;for(N={},I=(S=b!=null?b.types:void 0)!=null?S:[],A=0,C=I.length;C>A;A++)P=I[A],N[P]=!0;return N.Files||N["application/x-trix-document"]||N["text/html"]||N["text/plain"]},g.prototype.getPastedHTMLUsingHiddenElement=function(b){var A,C,S;return C=this.getSelectedRange(),S={position:"absolute",left:window.pageXOffset+"px",top:window.pageYOffset+"px",opacity:0},A=e({style:S,tagName:"div",editable:!0}),document.body.appendChild(A),A.focus(),requestAnimationFrame(function(I){return function(){var P;return P=A.innerHTML,t.removeNode(A),I.setSelectedRange(C),b(P)}}(this))},g.proxyMethod("responder?.getSelectedRange"),g.proxyMethod("responder?.setSelectedRange"),g.proxyMethod("responder?.expandSelectionInDirection"),g.proxyMethod("responder?.selectionIsInCursorTarget"),g.proxyMethod("responder?.selectionIsExpanded"),g}(t.InputController),d=function(l){var g,w;return(g=l.type)!=null&&(w=g.match(/\/(\w+)$/))!=null?w[1]:void 0},s=(typeof" ".codePointAt=="function"?" ".codePointAt(0):void 0)!=null,r=function(l){var g;return l.key&&s&&l.key.codePointAt(0)===l.keyCode?l.key:(l.which===null?g=l.keyCode:l.which!==0&&l.charCode!==0&&(g=l.charCode),g!=null&&m[g]!=="escape"?t.UTF16String.fromCodepoints([g]).toString():void 0)},i=function(l){var g,w,b,A,C,S,I,P,N,O;if(P=l.clipboardData){if(n.call(P.types,"text/html")>=0){for(N=P.types,b=0,S=N.length;S>b;b++)if(O=N[b],g=/^CorePasteboardFlavorType/.test(O),w=/^dyn\./.test(O)&&P.getData(O),I=g||w)return!0;return!1}return A=n.call(P.types,"com.apple.webarchive")>=0,C=n.call(P.types,"com.apple.flat-rtfd")>=0,A||C}},a=function(l){function g(w){var b;this.inputController=w,b=this.inputController,this.responder=b.responder,this.delegate=b.delegate,this.inputSummary=b.inputSummary,this.data={}}return u(g,l),g.prototype.start=function(w){var b,A;return this.data.start=w,this.isSignificant()?(this.inputSummary.eventName==="keypress"&&this.inputSummary.textAdded&&(b=this.responder)!=null&&b.deleteInDirection("left"),this.selectionIsExpanded()||(this.insertPlaceholder(),this.requestRender()),this.range=(A=this.responder)!=null?A.getSelectedRange():void 0):void 0},g.prototype.update=function(w){var b;return this.data.update=w,this.isSignificant()&&(b=this.selectPlaceholder())?(this.forgetPlaceholder(),this.range=b):void 0},g.prototype.end=function(w){var b,A,C,S;return this.data.end=w,this.isSignificant()?(this.forgetPlaceholder(),this.canApplyToDocument()?(this.setInputSummary({preferDocument:!0,didInput:!1}),(b=this.delegate)!=null&&b.inputControllerWillPerformTyping(),(A=this.responder)!=null&&A.setSelectedRange(this.range),(C=this.responder)!=null&&C.insertString(this.data.end),(S=this.responder)!=null?S.setSelectedRange(this.range[0]+this.data.end.length):void 0):this.data.start!=null||this.data.update!=null?(this.requestReparse(),this.inputController.reset()):void 0):this.inputController.reset()},g.prototype.getEndData=function(){return this.data.end},g.prototype.isEnded=function(){return this.getEndData()!=null},g.prototype.isSignificant=function(){return h.composesExistingText?this.inputSummary.didInput:!0},g.prototype.canApplyToDocument=function(){var w,b;return((w=this.data.start)!=null?w.length:void 0)===0&&((b=this.data.end)!=null?b.length:void 0)>0&&this.range!=null},g.proxyMethod("inputController.setInputSummary"),g.proxyMethod("inputController.requestRender"),g.proxyMethod("inputController.requestReparse"),g.proxyMethod("responder?.selectionIsExpanded"),g.proxyMethod("responder?.insertPlaceholder"),g.proxyMethod("responder?.selectPlaceholder"),g.proxyMethod("responder?.forgetPlaceholder"),g}(t.BasicObject)}.call(this),function(){var a,h,v,f=function(m,e){return function(){return m.apply(e,arguments)}},d=function(m,e){function o(){this.constructor=m}for(var i in e)s.call(e,i)&&(m[i]=e[i]);return o.prototype=e.prototype,m.prototype=new o,m.__super__=e.prototype,m},s={}.hasOwnProperty,p=[].indexOf||function(m){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===m)return e;return-1};a=t.dataTransferIsPlainText,h=t.keyEventIsKeyboardCommand,v=t.objectsAreEqual,t.Level2InputController=function(m){function e(){return this.render=f(this.render,this),e.__super__.constructor.apply(this,arguments)}var o,i,r,c,u,y;return d(e,m),e.prototype.elementDidMutate=function(){var n;return this.scheduledRender?this.composing&&(n=this.delegate)!=null&&typeof n.inputControllerDidAllowUnhandledInput=="function"?n.inputControllerDidAllowUnhandledInput():void 0:this.reparse()},e.prototype.scheduleRender=function(){return this.scheduledRender!=null?this.scheduledRender:this.scheduledRender=requestAnimationFrame(this.render)},e.prototype.render=function(){var n;return cancelAnimationFrame(this.scheduledRender),this.scheduledRender=null,this.composing||(n=this.delegate)!=null&&n.render(),typeof this.afterRender=="function"&&this.afterRender(),this.afterRender=null},e.prototype.reparse=function(){var n;return(n=this.delegate)!=null?n.reparse():void 0},e.prototype.events={keydown:function(n){var l,g,w,b;if(h(n)){if(l=i(n),(b=this.delegate)!=null?b.inputControllerDidReceiveKeyboardCommand(l):void 0)return n.preventDefault()}else if(w=n.key,n.altKey&&(w+="+Alt"),n.shiftKey&&(w+="+Shift"),g=this.keys[w])return this.withEvent(n,g)},paste:function(n){var l,g,w,b,A,C,S,I,P;return r(n)?(n.preventDefault(),this.attachFiles(n.clipboardData.files)):c(n)?(n.preventDefault(),g={type:"text/plain",string:n.clipboardData.getData("text/plain")},(w=this.delegate)!=null&&w.inputControllerWillPaste(g),(b=this.responder)!=null&&b.insertString(g.string),this.render(),(A=this.delegate)!=null?A.inputControllerDidPaste(g):void 0):(l=(C=n.clipboardData)!=null?C.getData("URL"):void 0)?(n.preventDefault(),g={type:"text/html",html:this.createLinkHTML(l)},(S=this.delegate)!=null&&S.inputControllerWillPaste(g),(I=this.responder)!=null&&I.insertHTML(g.html),this.render(),(P=this.delegate)!=null?P.inputControllerDidPaste(g):void 0):void 0},beforeinput:function(n){var l;return(l=this.inputTypes[n.inputType])?(this.withEvent(n,l),this.scheduleRender()):void 0},input:function(){return t.selectionChangeObserver.reset()},dragstart:function(n){var l,g;return((l=this.responder)!=null?l.selectionContainsAttachments():void 0)?(n.dataTransfer.setData("application/x-trix-dragging",!0),this.dragging={range:(g=this.responder)!=null?g.getSelectedRange():void 0,point:u(n)}):void 0},dragenter:function(n){return o(n)?n.preventDefault():void 0},dragover:function(n){var l,g;if(this.dragging){if(n.preventDefault(),l=u(n),!v(l,this.dragging.point))return this.dragging.point=l,(g=this.responder)!=null?g.setLocationRangeFromPointRange(l):void 0}else if(o(n))return n.preventDefault()},drop:function(n){var l,g,w,b;return this.dragging?(n.preventDefault(),(g=this.delegate)!=null&&g.inputControllerWillMoveText(),(w=this.responder)!=null&&w.moveTextFromRange(this.dragging.range),this.dragging=null,this.scheduleRender()):o(n)?(n.preventDefault(),l=u(n),(b=this.responder)!=null&&b.setLocationRangeFromPointRange(l),this.attachFiles(n.dataTransfer.files)):void 0},dragend:function(){var n;return this.dragging?((n=this.responder)!=null&&n.setSelectedRange(this.dragging.range),this.dragging=null):void 0},compositionend:function(){return this.composing?(this.composing=!1,this.scheduleRender()):void 0}},e.prototype.keys={ArrowLeft:function(){var n,l;return((n=this.responder)!=null?n.shouldManageMovingCursorInDirection("backward"):void 0)?(this.event.preventDefault(),(l=this.responder)!=null?l.moveCursorInDirection("backward"):void 0):void 0},ArrowRight:function(){var n,l;return((n=this.responder)!=null?n.shouldManageMovingCursorInDirection("forward"):void 0)?(this.event.preventDefault(),(l=this.responder)!=null?l.moveCursorInDirection("forward"):void 0):void 0},Backspace:function(){var n,l,g;return((n=this.responder)!=null?n.shouldManageDeletingInDirection("backward"):void 0)?(this.event.preventDefault(),(l=this.delegate)!=null&&l.inputControllerWillPerformTyping(),(g=this.responder)!=null&&g.deleteInDirection("backward"),this.render()):void 0},Tab:function(){var n,l;return((n=this.responder)!=null?n.canIncreaseNestingLevel():void 0)?(this.event.preventDefault(),(l=this.responder)!=null&&l.increaseNestingLevel(),this.render()):void 0},"Tab+Shift":function(){var n,l;return((n=this.responder)!=null?n.canDecreaseNestingLevel():void 0)?(this.event.preventDefault(),(l=this.responder)!=null&&l.decreaseNestingLevel(),this.render()):void 0}},e.prototype.inputTypes={deleteByComposition:function(){return this.deleteInDirection("backward",{recordUndoEntry:!1})},deleteByCut:function(){return this.deleteInDirection("backward")},deleteByDrag:function(){return this.event.preventDefault(),this.withTargetDOMRange(function(){var n;return this.deleteByDragRange=(n=this.responder)!=null?n.getSelectedRange():void 0})},deleteCompositionText:function(){return this.deleteInDirection("backward",{recordUndoEntry:!1})},deleteContent:function(){return this.deleteInDirection("backward")},deleteContentBackward:function(){return this.deleteInDirection("backward")},deleteContentForward:function(){return this.deleteInDirection("forward")},deleteEntireSoftLine:function(){return this.deleteInDirection("forward")},deleteHardLineBackward:function(){return this.deleteInDirection("backward")},deleteHardLineForward:function(){return this.deleteInDirection("forward")},deleteSoftLineBackward:function(){return this.deleteInDirection("backward")},deleteSoftLineForward:function(){return this.deleteInDirection("forward")},deleteWordBackward:function(){return this.deleteInDirection("backward")},deleteWordForward:function(){return this.deleteInDirection("forward")},formatBackColor:function(){return this.activateAttributeIfSupported("backgroundColor",this.event.data)},formatBold:function(){return this.toggleAttributeIfSupported("bold")},formatFontColor:function(){return this.activateAttributeIfSupported("color",this.event.data)},formatFontName:function(){return this.activateAttributeIfSupported("font",this.event.data)},formatIndent:function(){var n;return((n=this.responder)!=null?n.canIncreaseNestingLevel():void 0)?this.withTargetDOMRange(function(){var l;return(l=this.responder)!=null?l.increaseNestingLevel():void 0}):void 0},formatItalic:function(){return this.toggleAttributeIfSupported("italic")},formatJustifyCenter:function(){return this.toggleAttributeIfSupported("justifyCenter")},formatJustifyFull:function(){return this.toggleAttributeIfSupported("justifyFull")},formatJustifyLeft:function(){return this.toggleAttributeIfSupported("justifyLeft")},formatJustifyRight:function(){return this.toggleAttributeIfSupported("justifyRight")},formatOutdent:function(){var n;return((n=this.responder)!=null?n.canDecreaseNestingLevel():void 0)?this.withTargetDOMRange(function(){var l;return(l=this.responder)!=null?l.decreaseNestingLevel():void 0}):void 0},formatRemove:function(){return this.withTargetDOMRange(function(){var n,l,g,w;w=[];for(n in(l=this.responder)!=null?l.getCurrentAttributes():void 0)w.push((g=this.responder)!=null?g.removeCurrentAttribute(n):void 0);return w})},formatSetBlockTextDirection:function(){return this.activateAttributeIfSupported("blockDir",this.event.data)},formatSetInlineTextDirection:function(){return this.activateAttributeIfSupported("textDir",this.event.data)},formatStrikeThrough:function(){return this.toggleAttributeIfSupported("strike")},formatSubscript:function(){return this.toggleAttributeIfSupported("sub")},formatSuperscript:function(){return this.toggleAttributeIfSupported("sup")},formatUnderline:function(){return this.toggleAttributeIfSupported("underline")},historyRedo:function(){var n;return(n=this.delegate)!=null?n.inputControllerWillPerformRedo():void 0},historyUndo:function(){var n;return(n=this.delegate)!=null?n.inputControllerWillPerformUndo():void 0},insertCompositionText:function(){return this.composing=!0,this.insertString(this.event.data)},insertFromComposition:function(){return this.composing=!1,this.insertString(this.event.data)},insertFromDrop:function(){var n,l;return(n=this.deleteByDragRange)?(this.deleteByDragRange=null,(l=this.delegate)!=null&&l.inputControllerWillMoveText(),this.withTargetDOMRange(function(){var g;return(g=this.responder)!=null?g.moveTextFromRange(n):void 0})):void 0},insertFromPaste:function(){var n,l,g,w,b,A,C,S,I,P,N;return n=this.event.dataTransfer,b={dataTransfer:n},(l=n.getData("URL"))?(this.event.preventDefault(),b.type="text/html",N=(w=n.getData("public.url-name"))?t.squishBreakableWhitespace(w).trim():l,b.html=this.createLinkHTML(l,N),(A=this.delegate)!=null&&A.inputControllerWillPaste(b),this.withTargetDOMRange(function(){var O;return(O=this.responder)!=null?O.insertHTML(b.html):void 0}),this.afterRender=function(O){return function(){var T;return(T=O.delegate)!=null?T.inputControllerDidPaste(b):void 0}}(this)):a(n)?(b.type="text/plain",b.string=n.getData("text/plain"),(C=this.delegate)!=null&&C.inputControllerWillPaste(b),this.withTargetDOMRange(function(){var O;return(O=this.responder)!=null?O.insertString(b.string):void 0}),this.afterRender=function(O){return function(){var T;return(T=O.delegate)!=null?T.inputControllerDidPaste(b):void 0}}(this)):(g=n.getData("text/html"))?(this.event.preventDefault(),b.type="text/html",b.html=g,(S=this.delegate)!=null&&S.inputControllerWillPaste(b),this.withTargetDOMRange(function(){var O;return(O=this.responder)!=null?O.insertHTML(b.html):void 0}),this.afterRender=function(O){return function(){var T;return(T=O.delegate)!=null?T.inputControllerDidPaste(b):void 0}}(this)):((I=n.files)!=null?I.length:void 0)?(b.type="File",b.file=n.files[0],(P=this.delegate)!=null&&P.inputControllerWillPaste(b),this.withTargetDOMRange(function(){var O;return(O=this.responder)!=null?O.insertFile(b.file):void 0}),this.afterRender=function(O){return function(){var T;return(T=O.delegate)!=null?T.inputControllerDidPaste(b):void 0}}(this)):void 0},insertFromYank:function(){return this.insertString(this.event.data)},insertLineBreak:function(){return this.insertString(`
`)},insertLink:function(){return this.activateAttributeIfSupported("href",this.event.data)},insertOrderedList:function(){return this.toggleAttributeIfSupported("number")},insertParagraph:function(){var n;return(n=this.delegate)!=null&&n.inputControllerWillPerformTyping(),this.withTargetDOMRange(function(){var l;return(l=this.responder)!=null?l.insertLineBreak():void 0})},insertReplacementText:function(){return this.insertString(this.event.dataTransfer.getData("text/plain"),{updatePosition:!1})},insertText:function(){var n,l;return this.insertString((n=this.event.data)!=null?n:(l=this.event.dataTransfer)!=null?l.getData("text/plain"):void 0)},insertTranspose:function(){return this.insertString(this.event.data)},insertUnorderedList:function(){return this.toggleAttributeIfSupported("bullet")}},e.prototype.insertString=function(n,l){var g;return n==null&&(n=""),(g=this.delegate)!=null&&g.inputControllerWillPerformTyping(),this.withTargetDOMRange(function(){var w;return(w=this.responder)!=null?w.insertString(n,l):void 0})},e.prototype.toggleAttributeIfSupported=function(n){var l;return p.call(t.getAllAttributeNames(),n)>=0?((l=this.delegate)!=null&&l.inputControllerWillPerformFormatting(n),this.withTargetDOMRange(function(){var g;return(g=this.responder)!=null?g.toggleCurrentAttribute(n):void 0})):void 0},e.prototype.activateAttributeIfSupported=function(n,l){var g;return p.call(t.getAllAttributeNames(),n)>=0?((g=this.delegate)!=null&&g.inputControllerWillPerformFormatting(n),this.withTargetDOMRange(function(){var w;return(w=this.responder)!=null?w.setCurrentAttribute(n,l):void 0})):void 0},e.prototype.deleteInDirection=function(n,l){var g,w,b,A;return b=(l??{recordUndoEntry:!0}).recordUndoEntry,b&&(A=this.delegate)!=null&&A.inputControllerWillPerformTyping(),w=function(C){return function(){var S;return(S=C.responder)!=null?S.deleteInDirection(n):void 0}}(this),(g=this.getTargetDOMRange({minLength:2}))?this.withTargetDOMRange(g,w):w()},e.prototype.withTargetDOMRange=function(n,l){var g;return typeof n=="function"&&(l=n,n=this.getTargetDOMRange()),n?(g=this.responder)!=null?g.withTargetDOMRange(n,l.bind(this)):void 0:(t.selectionChangeObserver.reset(),l.call(this))},e.prototype.getTargetDOMRange=function(n){var l,g,w,b;return w=(n??{minLength:0}).minLength,(b=typeof(l=this.event).getTargetRanges=="function"?l.getTargetRanges():void 0)&&b.length&&(g=y(b[0]),w===0||g.toString().length>=w)?g:void 0},y=function(n){var l;return l=document.createRange(),l.setStart(n.startContainer,n.startOffset),l.setEnd(n.endContainer,n.endOffset),l},e.prototype.withEvent=function(n,l){var g;this.event=n;try{g=l.call(this)}finally{this.event=null}return g},o=function(n){var l,g;return p.call((l=(g=n.dataTransfer)!=null?g.types:void 0)!=null?l:[],"Files")>=0},r=function(n){var l;return(l=n.clipboardData)?p.call(l.types,"Files")>=0&&l.types.length===1&&l.files.length>=1:void 0},c=function(n){var l;return(l=n.clipboardData)?p.call(l.types,"text/plain")>=0&&l.types.length===1:void 0},i=function(n){var l;return l=[],n.altKey&&l.push("alt"),n.shiftKey&&l.push("shift"),l.push(n.key),l},u=function(n){return{x:n.clientX,y:n.clientY}},e}(t.InputController)}.call(this),function(){var a,h,v,f,d,s,p,m,e=function(r,c){return function(){return r.apply(c,arguments)}},o=function(r,c){function u(){this.constructor=r}for(var y in c)i.call(c,y)&&(r[y]=c[y]);return u.prototype=c.prototype,r.prototype=new u,r.__super__=c.prototype,r},i={}.hasOwnProperty;h=t.defer,v=t.handleEvent,s=t.makeElement,m=t.tagName,p=t.config,d=p.lang,a=p.css,f=p.keyNames,t.AttachmentEditorController=function(r){function c(y,n,l,g){this.attachmentPiece=y,this.element=n,this.container=l,this.options=g??{},this.didBlurCaption=e(this.didBlurCaption,this),this.didChangeCaption=e(this.didChangeCaption,this),this.didInputCaption=e(this.didInputCaption,this),this.didKeyDownCaption=e(this.didKeyDownCaption,this),this.didClickActionButton=e(this.didClickActionButton,this),this.didClickToolbar=e(this.didClickToolbar,this),this.attachment=this.attachmentPiece.attachment,m(this.element)==="a"&&(this.element=this.element.firstChild),this.install()}var u;return o(c,r),u=function(y){return function(){var n;return n=y.apply(this,arguments),n.do(),this.undos==null&&(this.undos=[]),this.undos.push(n.undo)}},c.prototype.install=function(){return this.makeElementMutable(),this.addToolbar(),this.attachment.isPreviewable()?this.installCaptionEditor():void 0},c.prototype.uninstall=function(){var y,n;for(this.savePendingCaption();n=this.undos.pop();)n();return(y=this.delegate)!=null?y.didUninstallAttachmentEditor(this):void 0},c.prototype.savePendingCaption=function(){var y,n,l;return this.pendingCaption!=null?(y=this.pendingCaption,this.pendingCaption=null,y?(n=this.delegate)!=null&&typeof n.attachmentEditorDidRequestUpdatingAttributesForAttachment=="function"?n.attachmentEditorDidRequestUpdatingAttributesForAttachment({caption:y},this.attachment):void 0:(l=this.delegate)!=null&&typeof l.attachmentEditorDidRequestRemovingAttributeForAttachment=="function"?l.attachmentEditorDidRequestRemovingAttributeForAttachment("caption",this.attachment):void 0):void 0},c.prototype.makeElementMutable=u(function(){return{do:function(y){return function(){return y.element.dataset.trixMutable=!0}}(this),undo:function(y){return function(){return delete y.element.dataset.trixMutable}}(this)}}),c.prototype.addToolbar=u(function(){var y;return y=s({tagName:"div",className:a.attachmentToolbar,data:{trixMutable:!0},childNodes:s({tagName:"div",className:"trix-button-row",childNodes:s({tagName:"span",className:"trix-button-group trix-button-group--actions",childNodes:s({tagName:"button",className:"trix-button trix-button--remove",textContent:d.remove,attributes:{title:d.remove},data:{trixAction:"remove"}})})})}),this.attachment.isPreviewable()&&y.appendChild(s({tagName:"div",className:a.attachmentMetadataContainer,childNodes:s({tagName:"span",className:a.attachmentMetadata,childNodes:[s({tagName:"span",className:a.attachmentName,textContent:this.attachment.getFilename(),attributes:{title:this.attachment.getFilename()}}),s({tagName:"span",className:a.attachmentSize,textContent:this.attachment.getFormattedFilesize()})]})})),v("click",{onElement:y,withCallback:this.didClickToolbar}),v("click",{onElement:y,matchingSelector:"[data-trix-action]",withCallback:this.didClickActionButton}),{do:function(n){return function(){return n.element.appendChild(y)}}(this),undo:function(){return function(){return t.removeNode(y)}}(this)}}),c.prototype.installCaptionEditor=u(function(){var y,n,l,g,w;return g=s({tagName:"textarea",className:a.attachmentCaptionEditor,attributes:{placeholder:d.captionPlaceholder},data:{trixMutable:!0}}),g.value=this.attachmentPiece.getCaption(),w=g.cloneNode(),w.classList.add("trix-autoresize-clone"),w.tabIndex=-1,y=function(){return w.value=g.value,g.style.height=w.scrollHeight+"px"},v("input",{onElement:g,withCallback:y}),v("input",{onElement:g,withCallback:this.didInputCaption}),v("keydown",{onElement:g,withCallback:this.didKeyDownCaption}),v("change",{onElement:g,withCallback:this.didChangeCaption}),v("blur",{onElement:g,withCallback:this.didBlurCaption}),l=this.element.querySelector("figcaption"),n=l.cloneNode(),{do:function(b){return function(){return l.style.display="none",n.appendChild(g),n.appendChild(w),n.classList.add(a.attachmentCaption+"--editing"),l.parentElement.insertBefore(n,l),y(),b.options.editCaption?h(function(){return g.focus()}):void 0}}(this),undo:function(){return t.removeNode(n),l.style.display=null}}}),c.prototype.didClickToolbar=function(y){return y.preventDefault(),y.stopPropagation()},c.prototype.didClickActionButton=function(y){var n,l;switch(n=y.target.getAttribute("data-trix-action")){case"remove":return(l=this.delegate)!=null?l.attachmentEditorDidRequestRemovalOfAttachment(this.attachment):void 0}},c.prototype.didKeyDownCaption=function(y){var n;return f[y.keyCode]==="return"?(y.preventDefault(),this.savePendingCaption(),(n=this.delegate)!=null&&typeof n.attachmentEditorDidRequestDeselectingAttachment=="function"?n.attachmentEditorDidRequestDeselectingAttachment(this.attachment):void 0):void 0},c.prototype.didInputCaption=function(y){return this.pendingCaption=y.target.value.replace(/\s/g," ").trim()},c.prototype.didChangeCaption=function(){return this.savePendingCaption()},c.prototype.didBlurCaption=function(){return this.savePendingCaption()},c}(t.BasicObject)}.call(this),function(){var a,h,v,f=function(s,p){function m(){this.constructor=s}for(var e in p)d.call(p,e)&&(s[e]=p[e]);return m.prototype=p.prototype,s.prototype=new m,s.__super__=p.prototype,s},d={}.hasOwnProperty;v=t.makeElement,a=t.config.css,t.AttachmentView=function(s){function p(){p.__super__.constructor.apply(this,arguments),this.attachment=this.object,this.attachment.uploadProgressDelegate=this,this.attachmentPiece=this.options.piece}var m;return f(p,s),p.attachmentSelector="[data-trix-attachment]",p.prototype.createContentNodes=function(){return[]},p.prototype.createNodes=function(){var e,o,i,r,c,u,y;if(e=r=v({tagName:"figure",className:this.getClassName(),data:this.getData(),editable:!1}),(o=this.getHref())&&(r=v({tagName:"a",editable:!1,attributes:{href:o,tabindex:-1}}),e.appendChild(r)),this.attachment.hasContent())r.innerHTML=this.attachment.getContent();else for(y=this.createContentNodes(),i=0,c=y.length;c>i;i++)u=y[i],r.appendChild(u);return r.appendChild(this.createCaptionElement()),this.attachment.isPending()&&(this.progressElement=v({tagName:"progress",attributes:{class:a.attachmentProgress,value:this.attachment.getUploadProgress(),max:100},data:{trixMutable:!0,trixStoreKey:["progressElement",this.attachment.id].join("/")}}),e.appendChild(this.progressElement)),[m("left"),e,m("right")]},p.prototype.createCaptionElement=function(){var e,o,i,r,c,u,y;return i=v({tagName:"figcaption",className:a.attachmentCaption}),(e=this.attachmentPiece.getCaption())?(i.classList.add(a.attachmentCaption+"--edited"),i.textContent=e):(o=this.getCaptionConfig(),o.name&&(r=this.attachment.getFilename()),o.size&&(u=this.attachment.getFormattedFilesize()),r&&(c=v({tagName:"span",className:a.attachmentName,textContent:r}),i.appendChild(c)),u&&(r&&i.appendChild(document.createTextNode(" ")),y=v({tagName:"span",className:a.attachmentSize,textContent:u}),i.appendChild(y))),i},p.prototype.getClassName=function(){var e,o;return o=[a.attachment,a.attachment+"--"+this.attachment.getType()],(e=this.attachment.getExtension())&&o.push(a.attachment+"--"+e),o.join(" ")},p.prototype.getData=function(){var e,o;return o={trixAttachment:JSON.stringify(this.attachment),trixContentType:this.attachment.getContentType(),trixId:this.attachment.id},e=this.attachmentPiece.attributes,e.isEmpty()||(o.trixAttributes=JSON.stringify(e)),this.attachment.isPending()&&(o.trixSerialize=!1),o},p.prototype.getHref=function(){return h(this.attachment.getContent(),"a")?void 0:this.attachment.getHref()},p.prototype.getCaptionConfig=function(){var e,o,i;return i=this.attachment.getType(),e=t.copyObject((o=t.config.attachments[i])!=null?o.caption:void 0),i==="file"&&(e.name=!0),e},p.prototype.findProgressElement=function(){var e;return(e=this.findElement())!=null?e.querySelector("progress"):void 0},m=function(e){return v({tagName:"span",textContent:t.ZERO_WIDTH_SPACE,data:{trixCursorTarget:e,trixSerialize:!1}})},p.prototype.attachmentDidChangeUploadProgress=function(){var e,o;return o=this.attachment.getUploadProgress(),(e=this.findProgressElement())!=null?e.value=o:void 0},p}(t.ObjectView),h=function(s,p){var m;return m=v("div"),m.innerHTML=s??"",m.querySelector(p)}}.call(this),function(){var a,h=function(f,d){function s(){this.constructor=f}for(var p in d)v.call(d,p)&&(f[p]=d[p]);return s.prototype=d.prototype,f.prototype=new s,f.__super__=d.prototype,f},v={}.hasOwnProperty;a=t.makeElement,t.PreviewableAttachmentView=function(f){function d(){d.__super__.constructor.apply(this,arguments),this.attachment.previewDelegate=this}return h(d,f),d.prototype.createContentNodes=function(){return this.image=a({tagName:"img",attributes:{src:""},data:{trixMutable:!0}}),this.refresh(this.image),[this.image]},d.prototype.createCaptionElement=function(){var s;return s=d.__super__.createCaptionElement.apply(this,arguments),s.textContent||s.setAttribute("data-trix-placeholder",t.config.lang.captionPlaceholder),s},d.prototype.refresh=function(s){var p;return s==null&&(s=(p=this.findElement())!=null?p.querySelector("img"):void 0),s?this.updateAttributesForImage(s):void 0},d.prototype.updateAttributesForImage=function(s){var p,m,e,o,i,r;return i=this.attachment.getURL(),m=this.attachment.getPreviewURL(),s.src=m||i,m===i?s.removeAttribute("data-trix-serialized-attributes"):(e=JSON.stringify({src:i}),s.setAttribute("data-trix-serialized-attributes",e)),r=this.attachment.getWidth(),p=this.attachment.getHeight(),r!=null&&(s.width=r),p!=null&&(s.height=p),o=["imageElement",this.attachment.id,s.src,s.width,s.height].join("/"),s.dataset.trixStoreKey=o},d.prototype.attachmentDidChangeAttributes=function(){return this.refresh(this.image),this.refresh()},d}(t.AttachmentView)}.call(this),function(){var a,h,v,f=function(s,p){function m(){this.constructor=s}for(var e in p)d.call(p,e)&&(s[e]=p[e]);return m.prototype=p.prototype,s.prototype=new m,s.__super__=p.prototype,s},d={}.hasOwnProperty;v=t.makeElement,a=t.findInnerElement,h=t.getTextConfig,t.PieceView=function(s){function p(){var e;p.__super__.constructor.apply(this,arguments),this.piece=this.object,this.attributes=this.piece.getAttributes(),e=this.options,this.textConfig=e.textConfig,this.context=e.context,this.piece.attachment?this.attachment=this.piece.attachment:this.string=this.piece.toString()}var m;return f(p,s),p.prototype.createNodes=function(){var e,o,i,r,c,u;if(u=this.attachment?this.createAttachmentNodes():this.createStringNodes(),e=this.createElement()){for(i=a(e),o=0,r=u.length;r>o;o++)c=u[o],i.appendChild(c);u=[e]}return u},p.prototype.createAttachmentNodes=function(){var e,o;return e=this.attachment.isPreviewable()?t.PreviewableAttachmentView:t.AttachmentView,o=this.createChildView(e,this.piece.attachment,{piece:this.piece}),o.getNodes()},p.prototype.createStringNodes=function(){var e,o,i,r,c,u,y,n,l,g;if((n=this.textConfig)!=null?n.plaintext:void 0)return[document.createTextNode(this.string)];for(y=[],l=this.string.split(`
`),i=o=0,r=l.length;r>o;i=++o)g=l[i],i>0&&(e=v("br"),y.push(e)),(c=g.length)&&(u=document.createTextNode(this.preserveSpaces(g)),y.push(u));return y},p.prototype.createElement=function(){var e,o,i,r,c,u,y,n,l;n={},u=this.attributes;for(r in u)if(l=u[r],(e=h(r))&&(e.tagName&&(c=v(e.tagName),i?(i.appendChild(c),i=c):o=i=c),e.styleProperty&&(n[e.styleProperty]=l),e.style)){y=e.style;for(r in y)l=y[r],n[r]=l}if(Object.keys(n).length){o==null&&(o=v("span"));for(r in n)l=n[r],o.style[r]=l}return o},p.prototype.createContainerElement=function(){var e,o,i,r,c;r=this.attributes;for(i in r)if(c=r[i],(o=h(i))&&o.groupTagName)return e={},e[i]=c,v(o.groupTagName,e)},m=t.NON_BREAKING_SPACE,p.prototype.preserveSpaces=function(e){return this.context.isLast&&(e=e.replace(/\ $/,m)),e=e.replace(/(\S)\ {3}(\S)/g,"$1 "+m+" $2").replace(/\ {2}/g,m+" ").replace(/\ {2}/g," "+m),(this.context.isFirst||this.context.followsWhitespace)&&(e=e.replace(/^\ /,m)),e},p}(t.ObjectView)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.TextView=function(v){function f(){f.__super__.constructor.apply(this,arguments),this.text=this.object,this.textConfig=this.options.textConfig}var d;return a(f,v),f.prototype.createNodes=function(){var s,p,m,e,o,i,r,c,u,y;for(i=[],c=t.ObjectGroup.groupObjects(this.getPieces()),e=c.length-1,m=p=0,o=c.length;o>p;m=++p)r=c[m],s={},m===0&&(s.isFirst=!0),m===e&&(s.isLast=!0),d(u)&&(s.followsWhitespace=!0),y=this.findOrCreateCachedChildView(t.PieceView,r,{textConfig:this.textConfig,context:s}),i.push.apply(i,y.getNodes()),u=r;return i},f.prototype.getPieces=function(){var s,p,m,e,o;for(e=this.text.getPieces(),o=[],s=0,p=e.length;p>s;s++)m=e[s],m.hasAttribute("blockBreak")||o.push(m);return o},d=function(s){return/\s$/.test(s!=null?s.toString():void 0)},f}(t.ObjectView)}.call(this),function(){var a,h,v,f=function(s,p){function m(){this.constructor=s}for(var e in p)d.call(p,e)&&(s[e]=p[e]);return m.prototype=p.prototype,s.prototype=new m,s.__super__=p.prototype,s},d={}.hasOwnProperty;v=t.makeElement,h=t.getBlockConfig,a=t.config.css,t.BlockView=function(s){function p(){p.__super__.constructor.apply(this,arguments),this.block=this.object,this.attributes=this.block.getAttributes()}return f(p,s),p.prototype.createNodes=function(){var m,e,o,i,r,c,u,y,n,l,g;if(e=document.createComment("block"),u=[e],this.block.isEmpty()?u.push(v("br")):(l=(y=h(this.block.getLastAttribute()))!=null?y.text:void 0,g=this.findOrCreateCachedChildView(t.TextView,this.block.text,{textConfig:l}),u.push.apply(u,g.getNodes()),this.shouldAddExtraNewlineElement()&&u.push(v("br"))),this.attributes.length)return u;for(n=t.config.blockAttributes.default.tagName,this.block.isRTL()&&(m={dir:"rtl"}),o=v({tagName:n,attributes:m}),i=0,r=u.length;r>i;i++)c=u[i],o.appendChild(c);return[o]},p.prototype.createContainerElement=function(m){var e,o,i,r,c;return e=this.attributes[m],c=h(e).tagName,m===0&&this.block.isRTL()&&(o={dir:"rtl"}),e==="attachmentGallery"&&(r=this.block.getBlockBreakPosition(),i=a.attachmentGallery+" "+a.attachmentGallery+"--"+r),v({tagName:c,className:i,attributes:o})},p.prototype.shouldAddExtraNewlineElement=function(){return/\n\n$/.test(this.block.toString())},p}(t.ObjectView)}.call(this),function(){var a,h,v=function(d,s){function p(){this.constructor=d}for(var m in s)f.call(s,m)&&(d[m]=s[m]);return p.prototype=s.prototype,d.prototype=new p,d.__super__=s.prototype,d},f={}.hasOwnProperty;a=t.defer,h=t.makeElement,t.DocumentView=function(d){function s(){s.__super__.constructor.apply(this,arguments),this.element=this.options.element,this.elementStore=new t.ElementStore,this.setDocument(this.object)}var p,m,e;return v(s,d),s.render=function(o){var i,r;return i=h("div"),r=new this(o,{element:i}),r.render(),r.sync(),i},s.prototype.setDocument=function(o){return o.isEqualTo(this.document)?void 0:this.document=this.object=o},s.prototype.render=function(){var o,i,r,c,u,y,n;if(this.childViews=[],this.shadowElement=h("div"),!this.document.isEmpty()){for(u=t.ObjectGroup.groupObjects(this.document.getBlocks(),{asTree:!0}),y=[],o=0,i=u.length;i>o;o++)c=u[o],n=this.findOrCreateCachedChildView(t.BlockView,c),y.push(function(){var l,g,w,b;for(w=n.getNodes(),b=[],l=0,g=w.length;g>l;l++)r=w[l],b.push(this.shadowElement.appendChild(r));return b}.call(this));return y}},s.prototype.isSynced=function(){return p(this.shadowElement,this.element)},s.prototype.sync=function(){var o;for(o=this.createDocumentFragmentForSync();this.element.lastChild;)this.element.removeChild(this.element.lastChild);return this.element.appendChild(o),this.didSync()},s.prototype.didSync=function(){return this.elementStore.reset(m(this.element)),a(function(o){return function(){return o.garbageCollectCachedViews()}}(this))},s.prototype.createDocumentFragmentForSync=function(){var o,i,r,c,u,y,n,l,g,w;for(i=document.createDocumentFragment(),l=this.shadowElement.childNodes,r=0,u=l.length;u>r;r++)n=l[r],i.appendChild(n.cloneNode(!0));for(g=m(i),c=0,y=g.length;y>c;c++)o=g[c],(w=this.elementStore.remove(o))&&o.parentNode.replaceChild(w,o);return i},m=function(o){return o.querySelectorAll("[data-trix-store-key]")},p=function(o,i){return e(o.innerHTML)===e(i.innerHTML)},e=function(o){return o.replace(/&nbsp;/g," ")},s}(t.ObjectView)}.call(this),function(){var a,h,v,f,d,s=function(e,o){return function(){return e.apply(o,arguments)}},p=function(e,o){function i(){this.constructor=e}for(var r in o)m.call(o,r)&&(e[r]=o[r]);return i.prototype=o.prototype,e.prototype=new i,e.__super__=o.prototype,e},m={}.hasOwnProperty;v=t.findClosestElementFromNode,f=t.handleEvent,d=t.innerElementIsActive,h=t.defer,a=t.AttachmentView.attachmentSelector,t.CompositionController=function(e){function o(i,r){this.element=i,this.composition=r,this.didClickAttachment=s(this.didClickAttachment,this),this.didBlur=s(this.didBlur,this),this.didFocus=s(this.didFocus,this),this.documentView=new t.DocumentView(this.composition.document,{element:this.element}),f("focus",{onElement:this.element,withCallback:this.didFocus}),f("blur",{onElement:this.element,withCallback:this.didBlur}),f("click",{onElement:this.element,matchingSelector:"a[contenteditable=false]",preventDefault:!0}),f("mousedown",{onElement:this.element,matchingSelector:a,withCallback:this.didClickAttachment}),f("click",{onElement:this.element,matchingSelector:"a"+a,preventDefault:!0})}return p(o,e),o.prototype.didFocus=function(){var i,r,c;return i=function(u){return function(){var y;return u.focused?void 0:(u.focused=!0,(y=u.delegate)!=null&&typeof y.compositionControllerDidFocus=="function"?y.compositionControllerDidFocus():void 0)}}(this),(r=(c=this.blurPromise)!=null?c.then(i):void 0)!=null?r:i()},o.prototype.didBlur=function(){return this.blurPromise=new Promise(function(i){return function(r){return h(function(){var c;return d(i.element)||(i.focused=null,(c=i.delegate)!=null&&typeof c.compositionControllerDidBlur=="function"&&c.compositionControllerDidBlur()),i.blurPromise=null,r()})}}(this))},o.prototype.didClickAttachment=function(i,r){var c,u,y;return c=this.findAttachmentForElement(r),u=v(i.target,{matchingSelector:"figcaption"})!=null,(y=this.delegate)!=null&&typeof y.compositionControllerDidSelectAttachment=="function"?y.compositionControllerDidSelectAttachment(c,{editCaption:u}):void 0},o.prototype.getSerializableElement=function(){return this.isEditingAttachment()?this.documentView.shadowElement:this.element},o.prototype.render=function(){var i,r,c;return this.revision!==this.composition.revision&&(this.documentView.setDocument(this.composition.document),this.documentView.render(),this.revision=this.composition.revision),this.canSyncDocumentView()&&!this.documentView.isSynced()&&((i=this.delegate)!=null&&typeof i.compositionControllerWillSyncDocumentView=="function"&&i.compositionControllerWillSyncDocumentView(),this.documentView.sync(),(r=this.delegate)!=null&&typeof r.compositionControllerDidSyncDocumentView=="function"&&r.compositionControllerDidSyncDocumentView()),(c=this.delegate)!=null&&typeof c.compositionControllerDidRender=="function"?c.compositionControllerDidRender():void 0},o.prototype.rerenderViewForObject=function(i){return this.invalidateViewForObject(i),this.render()},o.prototype.invalidateViewForObject=function(i){return this.documentView.invalidateViewForObject(i)},o.prototype.isViewCachingEnabled=function(){return this.documentView.isViewCachingEnabled()},o.prototype.enableViewCaching=function(){return this.documentView.enableViewCaching()},o.prototype.disableViewCaching=function(){return this.documentView.disableViewCaching()},o.prototype.refreshViewCache=function(){return this.documentView.garbageCollectCachedViews()},o.prototype.isEditingAttachment=function(){return this.attachmentEditor!=null},o.prototype.installAttachmentEditorForAttachment=function(i,r){var c,u,y;if(((y=this.attachmentEditor)!=null?y.attachment:void 0)!==i&&(u=this.documentView.findElementForObject(i)))return this.uninstallAttachmentEditor(),c=this.composition.document.getAttachmentPieceForAttachment(i),this.attachmentEditor=new t.AttachmentEditorController(c,u,this.element,r),this.attachmentEditor.delegate=this},o.prototype.uninstallAttachmentEditor=function(){var i;return(i=this.attachmentEditor)!=null?i.uninstall():void 0},o.prototype.didUninstallAttachmentEditor=function(){return this.attachmentEditor=null,this.render()},o.prototype.attachmentEditorDidRequestUpdatingAttributesForAttachment=function(i,r){var c;return(c=this.delegate)!=null&&typeof c.compositionControllerWillUpdateAttachment=="function"&&c.compositionControllerWillUpdateAttachment(r),this.composition.updateAttributesForAttachment(i,r)},o.prototype.attachmentEditorDidRequestRemovingAttributeForAttachment=function(i,r){var c;return(c=this.delegate)!=null&&typeof c.compositionControllerWillUpdateAttachment=="function"&&c.compositionControllerWillUpdateAttachment(r),this.composition.removeAttributeForAttachment(i,r)},o.prototype.attachmentEditorDidRequestRemovalOfAttachment=function(i){var r;return(r=this.delegate)!=null&&typeof r.compositionControllerDidRequestRemovalOfAttachment=="function"?r.compositionControllerDidRequestRemovalOfAttachment(i):void 0},o.prototype.attachmentEditorDidRequestDeselectingAttachment=function(i){var r;return(r=this.delegate)!=null&&typeof r.compositionControllerDidRequestDeselectingAttachment=="function"?r.compositionControllerDidRequestDeselectingAttachment(i):void 0},o.prototype.canSyncDocumentView=function(){return!this.isEditingAttachment()},o.prototype.findAttachmentForElement=function(i){return this.composition.document.getAttachmentById(parseInt(i.dataset.trixId,10))},o}(t.BasicObject)}.call(this),function(){var a,h,v,f=function(p,m){return function(){return p.apply(m,arguments)}},d=function(p,m){function e(){this.constructor=p}for(var o in m)s.call(m,o)&&(p[o]=m[o]);return e.prototype=m.prototype,p.prototype=new e,p.__super__=m.prototype,p},s={}.hasOwnProperty;h=t.handleEvent,v=t.triggerEvent,a=t.findClosestElementFromNode,t.ToolbarController=function(p){function m(b){this.element=b,this.didKeyDownDialogInput=f(this.didKeyDownDialogInput,this),this.didClickDialogButton=f(this.didClickDialogButton,this),this.didClickAttributeButton=f(this.didClickAttributeButton,this),this.didClickActionButton=f(this.didClickActionButton,this),this.attributes={},this.actions={},this.resetDialogInputs(),h("mousedown",{onElement:this.element,matchingSelector:e,withCallback:this.didClickActionButton}),h("mousedown",{onElement:this.element,matchingSelector:i,withCallback:this.didClickAttributeButton}),h("click",{onElement:this.element,matchingSelector:w,preventDefault:!0}),h("click",{onElement:this.element,matchingSelector:r,withCallback:this.didClickDialogButton}),h("keydown",{onElement:this.element,matchingSelector:c,withCallback:this.didKeyDownDialogInput})}var e,o,i,r,c,u,y,n,l,g,w;return d(m,p),i="[data-trix-attribute]",e="[data-trix-action]",w=i+", "+e,u="[data-trix-dialog]",o=u+"[data-trix-active]",r=u+" [data-trix-method]",c=u+" [data-trix-input]",m.prototype.didClickActionButton=function(b,A){var C,S,I;return(S=this.delegate)!=null&&S.toolbarDidClickButton(),b.preventDefault(),C=y(A),this.getDialog(C)?this.toggleDialog(C):(I=this.delegate)!=null?I.toolbarDidInvokeAction(C):void 0},m.prototype.didClickAttributeButton=function(b,A){var C,S,I;return(S=this.delegate)!=null&&S.toolbarDidClickButton(),b.preventDefault(),C=n(A),this.getDialog(C)?this.toggleDialog(C):(I=this.delegate)!=null&&I.toolbarDidToggleAttribute(C),this.refreshAttributeButtons()},m.prototype.didClickDialogButton=function(b,A){var C,S;return C=a(A,{matchingSelector:u}),S=A.getAttribute("data-trix-method"),this[S].call(this,C)},m.prototype.didKeyDownDialogInput=function(b,A){var C,S;return b.keyCode===13&&(b.preventDefault(),C=A.getAttribute("name"),S=this.getDialog(C),this.setAttribute(S)),b.keyCode===27?(b.preventDefault(),this.hideDialog()):void 0},m.prototype.updateActions=function(b){return this.actions=b,this.refreshActionButtons()},m.prototype.refreshActionButtons=function(){return this.eachActionButton(function(b){return function(A,C){return A.disabled=b.actions[C]===!1}}(this))},m.prototype.eachActionButton=function(b){var A,C,S,I,P;for(I=this.element.querySelectorAll(e),P=[],C=0,S=I.length;S>C;C++)A=I[C],P.push(b(A,y(A)));return P},m.prototype.updateAttributes=function(b){return this.attributes=b,this.refreshAttributeButtons()},m.prototype.refreshAttributeButtons=function(){return this.eachAttributeButton(function(b){return function(A,C){return A.disabled=b.attributes[C]===!1,b.attributes[C]||b.dialogIsVisible(C)?(A.setAttribute("data-trix-active",""),A.classList.add("trix-active")):(A.removeAttribute("data-trix-active"),A.classList.remove("trix-active"))}}(this))},m.prototype.eachAttributeButton=function(b){var A,C,S,I,P;for(I=this.element.querySelectorAll(i),P=[],C=0,S=I.length;S>C;C++)A=I[C],P.push(b(A,n(A)));return P},m.prototype.applyKeyboardCommand=function(b){var A,C,S,I,P,N,O;for(P=JSON.stringify(b.sort()),O=this.element.querySelectorAll("[data-trix-key]"),I=0,N=O.length;N>I;I++)if(A=O[I],S=A.getAttribute("data-trix-key").split("+"),C=JSON.stringify(S.sort()),C===P)return v("mousedown",{onElement:A}),!0;return!1},m.prototype.dialogIsVisible=function(b){var A;return(A=this.getDialog(b))?A.hasAttribute("data-trix-active"):void 0},m.prototype.toggleDialog=function(b){return this.dialogIsVisible(b)?this.hideDialog():this.showDialog(b)},m.prototype.showDialog=function(b){var A,C,S,I,P,N,O,T,x,k;for(this.hideDialog(),(O=this.delegate)!=null&&O.toolbarWillShowDialog(),S=this.getDialog(b),S.setAttribute("data-trix-active",""),S.classList.add("trix-active"),T=S.querySelectorAll("input[disabled]"),I=0,N=T.length;N>I;I++)C=T[I],C.removeAttribute("disabled");return(A=n(S))&&(P=g(S,b))&&(P.value=(x=this.attributes[A])!=null?x:"",P.select()),(k=this.delegate)!=null?k.toolbarDidShowDialog(b):void 0},m.prototype.setAttribute=function(b){var A,C,S;return A=n(b),C=g(b,A),C.willValidate&&!C.checkValidity()?(C.setAttribute("data-trix-validate",""),C.classList.add("trix-validate"),C.focus()):((S=this.delegate)!=null&&S.toolbarDidUpdateAttribute(A,C.value),this.hideDialog())},m.prototype.removeAttribute=function(b){var A,C;return A=n(b),(C=this.delegate)!=null&&C.toolbarDidRemoveAttribute(A),this.hideDialog()},m.prototype.hideDialog=function(){var b,A;return(b=this.element.querySelector(o))?(b.removeAttribute("data-trix-active"),b.classList.remove("trix-active"),this.resetDialogInputs(),(A=this.delegate)!=null?A.toolbarDidHideDialog(l(b)):void 0):void 0},m.prototype.resetDialogInputs=function(){var b,A,C,S,I;for(S=this.element.querySelectorAll(c),I=[],b=0,C=S.length;C>b;b++)A=S[b],A.setAttribute("disabled","disabled"),A.removeAttribute("data-trix-validate"),I.push(A.classList.remove("trix-validate"));return I},m.prototype.getDialog=function(b){return this.element.querySelector("[data-trix-dialog="+b+"]")},g=function(b,A){return A==null&&(A=n(b)),b.querySelector("[data-trix-input][name='"+A+"']")},y=function(b){return b.getAttribute("data-trix-action")},n=function(b){var A;return(A=b.getAttribute("data-trix-attribute"))!=null?A:b.getAttribute("data-trix-dialog-attribute")},l=function(b){return b.getAttribute("data-trix-dialog")},m}(t.BasicObject)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.ImagePreloadOperation=function(v){function f(d){this.url=d}return a(f,v),f.prototype.perform=function(d){var s;return s=new Image,s.onload=function(p){return function(){return s.width=p.width=s.naturalWidth,s.height=p.height=s.naturalHeight,d(!0,s)}}(this),s.onerror=function(){return d(!1)},s.src=this.url},f}(t.Operation)}.call(this),function(){var a=function(f,d){return function(){return f.apply(d,arguments)}},h=function(f,d){function s(){this.constructor=f}for(var p in d)v.call(d,p)&&(f[p]=d[p]);return s.prototype=d.prototype,f.prototype=new s,f.__super__=d.prototype,f},v={}.hasOwnProperty;t.Attachment=function(f){function d(s){s==null&&(s={}),this.releaseFile=a(this.releaseFile,this),d.__super__.constructor.apply(this,arguments),this.attributes=t.Hash.box(s),this.didChangeAttributes()}return h(d,f),d.previewablePattern=/^image(\/(gif|png|jpe?g)|$)/,d.attachmentForFile=function(s){var p,m;return m=this.attributesForFile(s),p=new this(m),p.setFile(s),p},d.attributesForFile=function(s){return new t.Hash({filename:s.name,filesize:s.size,contentType:s.type})},d.fromJSON=function(s){return new this(s)},d.prototype.getAttribute=function(s){return this.attributes.get(s)},d.prototype.hasAttribute=function(s){return this.attributes.has(s)},d.prototype.getAttributes=function(){return this.attributes.toObject()},d.prototype.setAttributes=function(s){var p,m,e;return s==null&&(s={}),p=this.attributes.merge(s),this.attributes.isEqualTo(p)?void 0:(this.attributes=p,this.didChangeAttributes(),(m=this.previewDelegate)!=null&&typeof m.attachmentDidChangeAttributes=="function"&&m.attachmentDidChangeAttributes(this),(e=this.delegate)!=null&&typeof e.attachmentDidChangeAttributes=="function"?e.attachmentDidChangeAttributes(this):void 0)},d.prototype.didChangeAttributes=function(){return this.isPreviewable()?this.preloadURL():void 0},d.prototype.isPending=function(){return this.file!=null&&!(this.getURL()||this.getHref())},d.prototype.isPreviewable=function(){return this.attributes.has("previewable")?this.attributes.get("previewable"):this.constructor.previewablePattern.test(this.getContentType())},d.prototype.getType=function(){return this.hasContent()?"content":this.isPreviewable()?"preview":"file"},d.prototype.getURL=function(){return this.attributes.get("url")},d.prototype.getHref=function(){return this.attributes.get("href")},d.prototype.getFilename=function(){var s;return(s=this.attributes.get("filename"))!=null?s:""},d.prototype.getFilesize=function(){return this.attributes.get("filesize")},d.prototype.getFormattedFilesize=function(){var s;return s=this.attributes.get("filesize"),typeof s=="number"?t.config.fileSize.formatter(s):""},d.prototype.getExtension=function(){var s;return(s=this.getFilename().match(/\.(\w+)$/))!=null?s[1].toLowerCase():void 0},d.prototype.getContentType=function(){return this.attributes.get("contentType")},d.prototype.hasContent=function(){return this.attributes.has("content")},d.prototype.getContent=function(){return this.attributes.get("content")},d.prototype.getWidth=function(){return this.attributes.get("width")},d.prototype.getHeight=function(){return this.attributes.get("height")},d.prototype.getFile=function(){return this.file},d.prototype.setFile=function(s){return this.file=s,this.isPreviewable()?this.preloadFile():void 0},d.prototype.releaseFile=function(){return this.releasePreloadedFile(),this.file=null},d.prototype.getUploadProgress=function(){var s;return(s=this.uploadProgress)!=null?s:0},d.prototype.setUploadProgress=function(s){var p;return this.uploadProgress!==s?(this.uploadProgress=s,(p=this.uploadProgressDelegate)!=null&&typeof p.attachmentDidChangeUploadProgress=="function"?p.attachmentDidChangeUploadProgress(this):void 0):void 0},d.prototype.toJSON=function(){return this.getAttributes()},d.prototype.getCacheKey=function(){return[d.__super__.getCacheKey.apply(this,arguments),this.attributes.getCacheKey(),this.getPreviewURL()].join("/")},d.prototype.getPreviewURL=function(){return this.previewURL||this.preloadingURL},d.prototype.setPreviewURL=function(s){var p,m;return s!==this.getPreviewURL()?(this.previewURL=s,(p=this.previewDelegate)!=null&&typeof p.attachmentDidChangeAttributes=="function"&&p.attachmentDidChangeAttributes(this),(m=this.delegate)!=null&&typeof m.attachmentDidChangePreviewURL=="function"?m.attachmentDidChangePreviewURL(this):void 0):void 0},d.prototype.preloadURL=function(){return this.preload(this.getURL(),this.releaseFile)},d.prototype.preloadFile=function(){return this.file?(this.fileObjectURL=URL.createObjectURL(this.file),this.preload(this.fileObjectURL)):void 0},d.prototype.releasePreloadedFile=function(){return this.fileObjectURL?(URL.revokeObjectURL(this.fileObjectURL),this.fileObjectURL=null):void 0},d.prototype.preload=function(s,p){var m;return s&&s!==this.getPreviewURL()?(this.preloadingURL=s,m=new t.ImagePreloadOperation(s),m.then(function(e){return function(o){var i,r;return r=o.width,i=o.height,e.getWidth()&&e.getHeight()||e.setAttributes({width:r,height:i}),e.preloadingURL=null,e.setPreviewURL(s),typeof p=="function"?p():void 0}}(this)).catch(function(e){return function(){return e.preloadingURL=null,typeof p=="function"?p():void 0}}(this))):void 0},d}(t.Object)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.Piece=function(v){function f(d,s){s==null&&(s={}),f.__super__.constructor.apply(this,arguments),this.attributes=t.Hash.box(s)}return a(f,v),f.types={},f.registerType=function(d,s){return s.type=d,this.types[d]=s},f.fromJSON=function(d){var s;return(s=this.types[d.type])?s.fromJSON(d):void 0},f.prototype.copyWithAttributes=function(d){return new this.constructor(this.getValue(),d)},f.prototype.copyWithAdditionalAttributes=function(d){return this.copyWithAttributes(this.attributes.merge(d))},f.prototype.copyWithoutAttribute=function(d){return this.copyWithAttributes(this.attributes.remove(d))},f.prototype.copy=function(){return this.copyWithAttributes(this.attributes)},f.prototype.getAttribute=function(d){return this.attributes.get(d)},f.prototype.getAttributesHash=function(){return this.attributes},f.prototype.getAttributes=function(){return this.attributes.toObject()},f.prototype.getCommonAttributes=function(){var d,s,p;return(p=pieceList.getPieceAtIndex(0))?(d=p.attributes,s=d.getKeys(),pieceList.eachPiece(function(m){return s=d.getKeysCommonToHash(m.attributes),d=d.slice(s)}),d.toObject()):{}},f.prototype.hasAttribute=function(d){return this.attributes.has(d)},f.prototype.hasSameStringValueAsPiece=function(d){return d!=null&&this.toString()===d.toString()},f.prototype.hasSameAttributesAsPiece=function(d){return d!=null&&(this.attributes===d.attributes||this.attributes.isEqualTo(d.attributes))},f.prototype.isBlockBreak=function(){return!1},f.prototype.isEqualTo=function(d){return f.__super__.isEqualTo.apply(this,arguments)||this.hasSameConstructorAs(d)&&this.hasSameStringValueAsPiece(d)&&this.hasSameAttributesAsPiece(d)},f.prototype.isEmpty=function(){return this.length===0},f.prototype.isSerializable=function(){return!0},f.prototype.toJSON=function(){return{type:this.constructor.type,attributes:this.getAttributes()}},f.prototype.contentsForInspection=function(){return{type:this.constructor.type,attributes:this.attributes.inspect()}},f.prototype.canBeGrouped=function(){return this.hasAttribute("href")},f.prototype.canBeGroupedWith=function(d){return this.getAttribute("href")===d.getAttribute("href")},f.prototype.getLength=function(){return this.length},f.prototype.canBeConsolidatedWith=function(){return!1},f}(t.Object)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.Piece.registerType("attachment",t.AttachmentPiece=function(v){function f(d){this.attachment=d,f.__super__.constructor.apply(this,arguments),this.length=1,this.ensureAttachmentExclusivelyHasAttribute("href"),this.attachment.hasContent()||this.removeProhibitedAttributes()}return a(f,v),f.fromJSON=function(d){return new this(t.Attachment.fromJSON(d.attachment),d.attributes)},f.permittedAttributes=["caption","presentation"],f.prototype.ensureAttachmentExclusivelyHasAttribute=function(d){return this.hasAttribute(d)?(this.attachment.hasAttribute(d)||this.attachment.setAttributes(this.attributes.slice(d)),this.attributes=this.attributes.remove(d)):void 0},f.prototype.removeProhibitedAttributes=function(){var d;return d=this.attributes.slice(this.constructor.permittedAttributes),d.isEqualTo(this.attributes)?void 0:this.attributes=d},f.prototype.getValue=function(){return this.attachment},f.prototype.isSerializable=function(){return!this.attachment.isPending()},f.prototype.getCaption=function(){var d;return(d=this.attributes.get("caption"))!=null?d:""},f.prototype.isEqualTo=function(d){var s;return f.__super__.isEqualTo.apply(this,arguments)&&this.attachment.id===(d!=null&&(s=d.attachment)!=null?s.id:void 0)},f.prototype.toString=function(){return t.OBJECT_REPLACEMENT_CHARACTER},f.prototype.toJSON=function(){var d;return d=f.__super__.toJSON.apply(this,arguments),d.attachment=this.attachment,d},f.prototype.getCacheKey=function(){return[f.__super__.getCacheKey.apply(this,arguments),this.attachment.getCacheKey()].join("/")},f.prototype.toConsole=function(){return JSON.stringify(this.toString())},f}(t.Piece))}.call(this),function(){var a,h=function(f,d){function s(){this.constructor=f}for(var p in d)v.call(d,p)&&(f[p]=d[p]);return s.prototype=d.prototype,f.prototype=new s,f.__super__=d.prototype,f},v={}.hasOwnProperty;a=t.normalizeNewlines,t.Piece.registerType("string",t.StringPiece=function(f){function d(s){d.__super__.constructor.apply(this,arguments),this.string=a(s),this.length=this.string.length}return h(d,f),d.fromJSON=function(s){return new this(s.string,s.attributes)},d.prototype.getValue=function(){return this.string},d.prototype.toString=function(){return this.string.toString()},d.prototype.isBlockBreak=function(){return this.toString()===`
`&&this.getAttribute("blockBreak")===!0},d.prototype.toJSON=function(){var s;return s=d.__super__.toJSON.apply(this,arguments),s.string=this.string,s},d.prototype.canBeConsolidatedWith=function(s){return s!=null&&this.hasSameConstructorAs(s)&&this.hasSameAttributesAsPiece(s)},d.prototype.consolidateWith=function(s){return new this.constructor(this.toString()+s.toString(),this.attributes)},d.prototype.splitAtOffset=function(s){var p,m;return s===0?(p=null,m=this):s===this.length?(p=this,m=null):(p=new this.constructor(this.string.slice(0,s),this.attributes),m=new this.constructor(this.string.slice(s),this.attributes)),[p,m]},d.prototype.toConsole=function(){var s;return s=this.string,s.length>15&&(s=s.slice(0,14)+"\u2026"),JSON.stringify(s.toString())},d}(t.Piece))}.call(this),function(){var a,h=function(d,s){function p(){this.constructor=d}for(var m in s)v.call(s,m)&&(d[m]=s[m]);return p.prototype=s.prototype,d.prototype=new p,d.__super__=s.prototype,d},v={}.hasOwnProperty,f=[].slice;a=t.spliceArray,t.SplittableList=function(d){function s(o){o==null&&(o=[]),s.__super__.constructor.apply(this,arguments),this.objects=o.slice(0),this.length=this.objects.length}var p,m,e;return h(s,d),s.box=function(o){return o instanceof this?o:new this(o)},s.prototype.indexOf=function(o){return this.objects.indexOf(o)},s.prototype.splice=function(){var o;return o=1<=arguments.length?f.call(arguments,0):[],new this.constructor(a.apply(null,[this.objects].concat(f.call(o))))},s.prototype.eachObject=function(o){var i,r,c,u,y,n;for(y=this.objects,n=[],r=i=0,c=y.length;c>i;r=++i)u=y[r],n.push(o(u,r));return n},s.prototype.insertObjectAtIndex=function(o,i){return this.splice(i,0,o)},s.prototype.insertSplittableListAtIndex=function(o,i){return this.splice.apply(this,[i,0].concat(f.call(o.objects)))},s.prototype.insertSplittableListAtPosition=function(o,i){var r,c,u;return u=this.splitObjectAtPosition(i),c=u[0],r=u[1],new this.constructor(c).insertSplittableListAtIndex(o,r)},s.prototype.editObjectAtIndex=function(o,i){return this.replaceObjectAtIndex(i(this.objects[o]),o)},s.prototype.replaceObjectAtIndex=function(o,i){return this.splice(i,1,o)},s.prototype.removeObjectAtIndex=function(o){return this.splice(o,1)},s.prototype.getObjectAtIndex=function(o){return this.objects[o]},s.prototype.getSplittableListInRange=function(o){var i,r,c,u;return c=this.splitObjectsAtRange(o),r=c[0],i=c[1],u=c[2],new this.constructor(r.slice(i,u+1))},s.prototype.selectSplittableList=function(o){var i,r;return r=function(){var c,u,y,n;for(y=this.objects,n=[],c=0,u=y.length;u>c;c++)i=y[c],o(i)&&n.push(i);return n}.call(this),new this.constructor(r)},s.prototype.removeObjectsInRange=function(o){var i,r,c,u;return c=this.splitObjectsAtRange(o),r=c[0],i=c[1],u=c[2],new this.constructor(r).splice(i,u-i+1)},s.prototype.transformObjectsInRange=function(o,i){var r,c,u,y,n,l,g;return n=this.splitObjectsAtRange(o),y=n[0],c=n[1],l=n[2],g=function(){var w,b,A;for(A=[],r=w=0,b=y.length;b>w;r=++w)u=y[r],A.push(r>=c&&l>=r?i(u):u);return A}(),new this.constructor(g)},s.prototype.splitObjectsAtRange=function(o){var i,r,c,u,y,n;return u=this.splitObjectAtPosition(e(o)),r=u[0],i=u[1],c=u[2],y=new this.constructor(r).splitObjectAtPosition(p(o)+c),r=y[0],n=y[1],[r,i,n-1]},s.prototype.getObjectAtPosition=function(o){var i,r,c;return c=this.findIndexAndOffsetAtPosition(o),i=c.index,r=c.offset,this.objects[i]},s.prototype.splitObjectAtPosition=function(o){var i,r,c,u,y,n,l,g,w,b;return n=this.findIndexAndOffsetAtPosition(o),i=n.index,y=n.offset,u=this.objects.slice(0),i!=null?y===0?(w=i,b=0):(c=this.getObjectAtIndex(i),l=c.splitAtOffset(y),r=l[0],g=l[1],u.splice(i,1,r,g),w=i+1,b=r.getLength()-y):(w=u.length,b=0),[u,w,b]},s.prototype.consolidate=function(){var o,i,r,c,u,y;for(c=[],u=this.objects[0],y=this.objects.slice(1),o=0,i=y.length;i>o;o++)r=y[o],(typeof u.canBeConsolidatedWith=="function"?u.canBeConsolidatedWith(r):void 0)?u=u.consolidateWith(r):(c.push(u),u=r);return u!=null&&c.push(u),new this.constructor(c)},s.prototype.consolidateFromIndexToIndex=function(o,i){var r,c,u;return c=this.objects.slice(0),u=c.slice(o,i+1),r=new this.constructor(u).consolidate().toArray(),this.splice.apply(this,[o,u.length].concat(f.call(r)))},s.prototype.findIndexAndOffsetAtPosition=function(o){var i,r,c,u,y,n,l;for(i=0,l=this.objects,c=r=0,u=l.length;u>r;c=++r){if(n=l[c],y=i+n.getLength(),o>=i&&y>o)return{index:c,offset:o-i};i=y}return{index:null,offset:null}},s.prototype.findPositionAtIndexAndOffset=function(o,i){var r,c,u,y,n,l;for(n=0,l=this.objects,r=c=0,u=l.length;u>c;r=++c)if(y=l[r],o>r)n+=y.getLength();else if(r===o){n+=i;break}return n},s.prototype.getEndPosition=function(){var o,i;return this.endPosition!=null?this.endPosition:this.endPosition=function(){var r,c,u;for(i=0,u=this.objects,r=0,c=u.length;c>r;r++)o=u[r],i+=o.getLength();return i}.call(this)},s.prototype.toString=function(){return this.objects.join("")},s.prototype.toArray=function(){return this.objects.slice(0)},s.prototype.toJSON=function(){return this.toArray()},s.prototype.isEqualTo=function(o){return s.__super__.isEqualTo.apply(this,arguments)||m(this.objects,o!=null?o.objects:void 0)},m=function(o,i){var r,c,u,y,n;if(i==null&&(i=[]),o.length!==i.length)return!1;for(n=!0,c=r=0,u=o.length;u>r;c=++r)y=o[c],n&&!y.isEqualTo(i[c])&&(n=!1);return n},s.prototype.contentsForInspection=function(){var o;return{objects:"["+function(){var i,r,c,u;for(c=this.objects,u=[],i=0,r=c.length;r>i;i++)o=c[i],u.push(o.inspect());return u}.call(this).join(", ")+"]"}},e=function(o){return o[0]},p=function(o){return o[1]},s}(t.Object)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.Text=function(v){function f(d){var s;d==null&&(d=[]),f.__super__.constructor.apply(this,arguments),this.pieceList=new t.SplittableList(function(){var p,m,e;for(e=[],p=0,m=d.length;m>p;p++)s=d[p],s.isEmpty()||e.push(s);return e}())}return a(f,v),f.textForAttachmentWithAttributes=function(d,s){var p;return p=new t.AttachmentPiece(d,s),new this([p])},f.textForStringWithAttributes=function(d,s){var p;return p=new t.StringPiece(d,s),new this([p])},f.fromJSON=function(d){var s,p;return p=function(){var m,e,o;for(o=[],m=0,e=d.length;e>m;m++)s=d[m],o.push(t.Piece.fromJSON(s));return o}(),new this(p)},f.prototype.copy=function(){return this.copyWithPieceList(this.pieceList)},f.prototype.copyWithPieceList=function(d){return new this.constructor(d.consolidate().toArray())},f.prototype.copyUsingObjectMap=function(d){var s,p;return p=function(){var m,e,o,i,r;for(o=this.getPieces(),r=[],m=0,e=o.length;e>m;m++)s=o[m],r.push((i=d.find(s))!=null?i:s);return r}.call(this),new this.constructor(p)},f.prototype.appendText=function(d){return this.insertTextAtPosition(d,this.getLength())},f.prototype.insertTextAtPosition=function(d,s){return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(d.pieceList,s))},f.prototype.removeTextAtRange=function(d){return this.copyWithPieceList(this.pieceList.removeObjectsInRange(d))},f.prototype.replaceTextAtRange=function(d,s){return this.removeTextAtRange(s).insertTextAtPosition(d,s[0])},f.prototype.moveTextFromRangeToPosition=function(d,s){var p,m;if(!(d[0]<=s&&s<=d[1]))return m=this.getTextAtRange(d),p=m.getLength(),d[0]<s&&(s-=p),this.removeTextAtRange(d).insertTextAtPosition(m,s)},f.prototype.addAttributeAtRange=function(d,s,p){var m;return m={},m[d]=s,this.addAttributesAtRange(m,p)},f.prototype.addAttributesAtRange=function(d,s){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(s,function(p){return p.copyWithAdditionalAttributes(d)}))},f.prototype.removeAttributeAtRange=function(d,s){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(s,function(p){return p.copyWithoutAttribute(d)}))},f.prototype.setAttributesAtRange=function(d,s){return this.copyWithPieceList(this.pieceList.transformObjectsInRange(s,function(p){return p.copyWithAttributes(d)}))},f.prototype.getAttributesAtPosition=function(d){var s,p;return(s=(p=this.pieceList.getObjectAtPosition(d))!=null?p.getAttributes():void 0)!=null?s:{}},f.prototype.getCommonAttributes=function(){var d,s;return d=function(){var p,m,e,o;for(e=this.pieceList.toArray(),o=[],p=0,m=e.length;m>p;p++)s=e[p],o.push(s.getAttributes());return o}.call(this),t.Hash.fromCommonAttributesOfObjects(d).toObject()},f.prototype.getCommonAttributesAtRange=function(d){var s;return(s=this.getTextAtRange(d).getCommonAttributes())!=null?s:{}},f.prototype.getExpandedRangeForAttributeAtOffset=function(d,s){var p,m,e;for(p=e=s,m=this.getLength();p>0&&this.getCommonAttributesAtRange([p-1,e])[d];)p--;for(;m>e&&this.getCommonAttributesAtRange([s,e+1])[d];)e++;return[p,e]},f.prototype.getTextAtRange=function(d){return this.copyWithPieceList(this.pieceList.getSplittableListInRange(d))},f.prototype.getStringAtRange=function(d){return this.pieceList.getSplittableListInRange(d).toString()},f.prototype.getStringAtPosition=function(d){return this.getStringAtRange([d,d+1])},f.prototype.startsWithString=function(d){return this.getStringAtRange([0,d.length])===d},f.prototype.endsWithString=function(d){var s;return s=this.getLength(),this.getStringAtRange([s-d.length,s])===d},f.prototype.getAttachmentPieces=function(){var d,s,p,m,e;for(m=this.pieceList.toArray(),e=[],d=0,s=m.length;s>d;d++)p=m[d],p.attachment!=null&&e.push(p);return e},f.prototype.getAttachments=function(){var d,s,p,m,e;for(m=this.getAttachmentPieces(),e=[],d=0,s=m.length;s>d;d++)p=m[d],e.push(p.attachment);return e},f.prototype.getAttachmentAndPositionById=function(d){var s,p,m,e,o,i;for(e=0,o=this.pieceList.toArray(),s=0,p=o.length;p>s;s++){if(m=o[s],((i=m.attachment)!=null?i.id:void 0)===d)return{attachment:m.attachment,position:e};e+=m.length}return{attachment:null,position:null}},f.prototype.getAttachmentById=function(d){var s,p,m;return m=this.getAttachmentAndPositionById(d),s=m.attachment,p=m.position,s},f.prototype.getRangeOfAttachment=function(d){var s,p;return p=this.getAttachmentAndPositionById(d.id),d=p.attachment,s=p.position,d!=null?[s,s+1]:void 0},f.prototype.updateAttributesForAttachment=function(d,s){var p;return(p=this.getRangeOfAttachment(s))?this.addAttributesAtRange(d,p):this},f.prototype.getLength=function(){return this.pieceList.getEndPosition()},f.prototype.isEmpty=function(){return this.getLength()===0},f.prototype.isEqualTo=function(d){var s;return f.__super__.isEqualTo.apply(this,arguments)||(d!=null&&(s=d.pieceList)!=null?s.isEqualTo(this.pieceList):void 0)},f.prototype.isBlockBreak=function(){return this.getLength()===1&&this.pieceList.getObjectAtIndex(0).isBlockBreak()},f.prototype.eachPiece=function(d){return this.pieceList.eachObject(d)},f.prototype.getPieces=function(){return this.pieceList.toArray()},f.prototype.getPieceAtPosition=function(d){return this.pieceList.getObjectAtPosition(d)},f.prototype.contentsForInspection=function(){return{pieceList:this.pieceList.inspect()}},f.prototype.toSerializableText=function(){var d;return d=this.pieceList.selectSplittableList(function(s){return s.isSerializable()}),this.copyWithPieceList(d)},f.prototype.toString=function(){return this.pieceList.toString()},f.prototype.toJSON=function(){return this.pieceList.toJSON()},f.prototype.toConsole=function(){var d;return JSON.stringify(function(){var s,p,m,e;for(m=this.pieceList.toArray(),e=[],s=0,p=m.length;p>s;s++)d=m[s],e.push(JSON.parse(d.toConsole()));return e}.call(this))},f.prototype.getDirection=function(){return t.getDirection(this.toString())},f.prototype.isRTL=function(){return this.getDirection()==="rtl"},f}(t.Object)}.call(this),function(){var a,h,v,f,d,s=function(o,i){function r(){this.constructor=o}for(var c in i)p.call(i,c)&&(o[c]=i[c]);return r.prototype=i.prototype,o.prototype=new r,o.__super__=i.prototype,o},p={}.hasOwnProperty,m=[].indexOf||function(o){for(var i=0,r=this.length;r>i;i++)if(i in this&&this[i]===o)return i;return-1},e=[].slice;a=t.arraysAreEqual,d=t.spliceArray,v=t.getBlockConfig,h=t.getBlockAttributeNames,f=t.getListAttributeNames,t.Block=function(o){function i(A,C){A==null&&(A=new t.Text),C==null&&(C=[]),i.__super__.constructor.apply(this,arguments),this.text=c(A),this.attributes=C}var r,c,u,y,n,l,g,w,b;return s(i,o),i.fromJSON=function(A){var C;return C=t.Text.fromJSON(A.text),new this(C,A.attributes)},i.prototype.isEmpty=function(){return this.text.isBlockBreak()},i.prototype.isEqualTo=function(A){return i.__super__.isEqualTo.apply(this,arguments)||this.text.isEqualTo(A!=null?A.text:void 0)&&a(this.attributes,A!=null?A.attributes:void 0)},i.prototype.copyWithText=function(A){return new this.constructor(A,this.attributes)},i.prototype.copyWithoutText=function(){return this.copyWithText(null)},i.prototype.copyWithAttributes=function(A){return new this.constructor(this.text,A)},i.prototype.copyWithoutAttributes=function(){return this.copyWithAttributes(null)},i.prototype.copyUsingObjectMap=function(A){var C;return this.copyWithText((C=A.find(this.text))?C:this.text.copyUsingObjectMap(A))},i.prototype.addAttribute=function(A){var C;return C=this.attributes.concat(y(A)),this.copyWithAttributes(C)},i.prototype.removeAttribute=function(A){var C,S;return S=v(A).listAttribute,C=l(l(this.attributes,A),S),this.copyWithAttributes(C)},i.prototype.removeLastAttribute=function(){return this.removeAttribute(this.getLastAttribute())},i.prototype.getLastAttribute=function(){return n(this.attributes)},i.prototype.getAttributes=function(){return this.attributes.slice(0)},i.prototype.getAttributeLevel=function(){return this.attributes.length},i.prototype.getAttributeAtLevel=function(A){return this.attributes[A-1]},i.prototype.hasAttribute=function(A){return m.call(this.attributes,A)>=0},i.prototype.hasAttributes=function(){return this.getAttributeLevel()>0},i.prototype.getLastNestableAttribute=function(){return n(this.getNestableAttributes())},i.prototype.getNestableAttributes=function(){var A,C,S,I,P;for(I=this.attributes,P=[],C=0,S=I.length;S>C;C++)A=I[C],v(A).nestable&&P.push(A);return P},i.prototype.getNestingLevel=function(){return this.getNestableAttributes().length},i.prototype.decreaseNestingLevel=function(){var A;return(A=this.getLastNestableAttribute())?this.removeAttribute(A):this},i.prototype.increaseNestingLevel=function(){var A,C,S;return(A=this.getLastNestableAttribute())?(S=this.attributes.lastIndexOf(A),C=d.apply(null,[this.attributes,S+1,0].concat(e.call(y(A)))),this.copyWithAttributes(C)):this},i.prototype.getListItemAttributes=function(){var A,C,S,I,P;for(I=this.attributes,P=[],C=0,S=I.length;S>C;C++)A=I[C],v(A).listAttribute&&P.push(A);return P},i.prototype.isListItem=function(){var A;return(A=v(this.getLastAttribute()))!=null?A.listAttribute:void 0},i.prototype.isTerminalBlock=function(){var A;return(A=v(this.getLastAttribute()))!=null?A.terminal:void 0},i.prototype.breaksOnReturn=function(){var A;return(A=v(this.getLastAttribute()))!=null?A.breakOnReturn:void 0},i.prototype.findLineBreakInDirectionFromPosition=function(A,C){var S,I;return I=this.toString(),S=function(){switch(A){case"forward":return I.indexOf(`
`,C);case"backward":return I.slice(0,C).lastIndexOf(`
`)}}(),S!==-1?S:void 0},i.prototype.contentsForInspection=function(){return{text:this.text.inspect(),attributes:this.attributes}},i.prototype.toString=function(){return this.text.toString()},i.prototype.toJSON=function(){return{text:this.text,attributes:this.attributes}},i.prototype.getDirection=function(){return this.text.getDirection()},i.prototype.isRTL=function(){return this.text.isRTL()},i.prototype.getLength=function(){return this.text.getLength()},i.prototype.canBeConsolidatedWith=function(A){return!this.hasAttributes()&&!A.hasAttributes()&&this.getDirection()===A.getDirection()},i.prototype.consolidateWith=function(A){var C,S;return C=t.Text.textForStringWithAttributes(`
`),S=this.getTextWithoutBlockBreak().appendText(C),this.copyWithText(S.appendText(A.text))},i.prototype.splitAtOffset=function(A){var C,S;return A===0?(C=null,S=this):A===this.getLength()?(C=this,S=null):(C=this.copyWithText(this.text.getTextAtRange([0,A])),S=this.copyWithText(this.text.getTextAtRange([A,this.getLength()]))),[C,S]},i.prototype.getBlockBreakPosition=function(){return this.text.getLength()-1},i.prototype.getTextWithoutBlockBreak=function(){return g(this.text)?this.text.getTextAtRange([0,this.getBlockBreakPosition()]):this.text.copy()},i.prototype.canBeGrouped=function(A){return this.attributes[A]},i.prototype.canBeGroupedWith=function(A,C){var S,I,P,N;return P=A.getAttributes(),I=P[C],S=this.attributes[C],!(S!==I||v(S).group===!1&&(N=P[C+1],m.call(f(),N)<0)||this.getDirection()!==A.getDirection()&&!A.isEmpty())},c=function(A){return A=b(A),A=r(A)},b=function(A){var C,S,I,P,N,O;return P=!1,O=A.getPieces(),S=2<=O.length?e.call(O,0,C=O.length-1):(C=0,[]),I=O[C++],I==null?A:(S=function(){var T,x,k;for(k=[],T=0,x=S.length;x>T;T++)N=S[T],N.isBlockBreak()?(P=!0,k.push(w(N))):k.push(N);return k}(),P?new t.Text(e.call(S).concat([I])):A)},u=t.Text.textForStringWithAttributes(`
`,{blockBreak:!0}),r=function(A){return g(A)?A:A.appendText(u)},g=function(A){var C,S;return S=A.getLength(),S===0?!1:(C=A.getTextAtRange([S-1,S]),C.isBlockBreak())},w=function(A){return A.copyWithoutAttribute("blockBreak")},y=function(A){var C;return C=v(A).listAttribute,C!=null?[C,A]:[A]},n=function(A){return A.slice(-1)[0]},l=function(A,C){var S;return S=A.lastIndexOf(C),S===-1?A:d(A,S,1)},i}(t.Object)}.call(this),function(){var a,h,v,f=function(m,e){function o(){this.constructor=m}for(var i in e)d.call(e,i)&&(m[i]=e[i]);return o.prototype=e.prototype,m.prototype=new o,m.__super__=e.prototype,m},d={}.hasOwnProperty,s=[].indexOf||function(m){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===m)return e;return-1},p=[].slice;h=t.tagName,v=t.walkTree,a=t.nodeIsAttachmentElement,t.HTMLSanitizer=function(m){function e(u,y){var n;n=y??{},this.allowedAttributes=n.allowedAttributes,this.forbiddenProtocols=n.forbiddenProtocols,this.forbiddenElements=n.forbiddenElements,this.allowedAttributes==null&&(this.allowedAttributes=o),this.forbiddenProtocols==null&&(this.forbiddenProtocols=r),this.forbiddenElements==null&&(this.forbiddenElements=i),this.body=c(u)}var o,i,r,c;return f(e,m),o="style href src width height class".split(" "),r="javascript:".split(" "),i="script iframe".split(" "),e.sanitize=function(u,y){var n;return n=new this(u,y),n.sanitize(),n},e.prototype.sanitize=function(){return this.sanitizeElements(),this.normalizeListElementNesting()},e.prototype.getHTML=function(){return this.body.innerHTML},e.prototype.getBody=function(){return this.body},e.prototype.sanitizeElements=function(){var u,y,n,l,g;for(g=v(this.body),l=[];g.nextNode();)switch(n=g.currentNode,n.nodeType){case Node.ELEMENT_NODE:this.elementIsRemovable(n)?l.push(n):this.sanitizeElement(n);break;case Node.COMMENT_NODE:l.push(n)}for(u=0,y=l.length;y>u;u++)n=l[u],t.removeNode(n);return this.body},e.prototype.sanitizeElement=function(u){var y,n,l,g,w;for(u.hasAttribute("href")&&(g=u.protocol,s.call(this.forbiddenProtocols,g)>=0&&u.removeAttribute("href")),w=p.call(u.attributes),y=0,n=w.length;n>y;y++)l=w[y].name,s.call(this.allowedAttributes,l)>=0||l.indexOf("data-trix")===0||u.removeAttribute(l);return u},e.prototype.normalizeListElementNesting=function(){var u,y,n,l,g;for(g=p.call(this.body.querySelectorAll("ul,ol")),u=0,y=g.length;y>u;u++)n=g[u],(l=n.previousElementSibling)&&h(l)==="li"&&l.appendChild(n);return this.body},e.prototype.elementIsRemovable=function(u){return(u!=null?u.nodeType:void 0)===Node.ELEMENT_NODE?this.elementIsForbidden(u)||this.elementIsntSerializable(u):void 0},e.prototype.elementIsForbidden=function(u){var y;return y=h(u),s.call(this.forbiddenElements,y)>=0},e.prototype.elementIsntSerializable=function(u){return u.getAttribute("data-trix-serialize")==="false"&&!a(u)},c=function(u){var y,n,l,g,w;for(u==null&&(u=""),u=u.replace(/<\/html[^>]*>[^]*$/i,"</html>"),y=document.implementation.createHTMLDocument(""),y.documentElement.innerHTML=u,w=y.head.querySelectorAll("style"),l=0,g=w.length;g>l;l++)n=w[l],y.body.appendChild(n);return y.body},e}(t.BasicObject)}.call(this),function(){var a,h,v,f,d,s,p,m,e,o,i,r=function(y,n){function l(){this.constructor=y}for(var g in n)c.call(n,g)&&(y[g]=n[g]);return l.prototype=n.prototype,y.prototype=new l,y.__super__=n.prototype,y},c={}.hasOwnProperty,u=[].indexOf||function(y){for(var n=0,l=this.length;l>n;n++)if(n in this&&this[n]===y)return n;return-1};a=t.arraysAreEqual,s=t.makeElement,o=t.tagName,d=t.getBlockTagNames,i=t.walkTree,f=t.findClosestElementFromNode,v=t.elementContainsNode,p=t.nodeIsAttachmentElement,m=t.normalizeSpaces,h=t.breakableWhitespacePattern,e=t.squishBreakableWhitespace,t.HTMLParser=function(y){function n(x,k){this.html=x,this.referenceElement=(k??{}).referenceElement,this.blocks=[],this.blockElements=[],this.processedElements=[]}var l,g,w,b,A,C,S,I,P,N,O,T;return r(n,y),n.parse=function(x,k){var D;return D=new this(x,k),D.parse(),D},n.prototype.getDocument=function(){return t.Document.fromJSON(this.blocks)},n.prototype.parse=function(){var x,k;try{for(this.createHiddenContainer(),x=t.HTMLSanitizer.sanitize(this.html).getHTML(),this.containerElement.innerHTML=x,k=i(this.containerElement,{usingFilter:S});k.nextNode();)this.processNode(k.currentNode);return this.translateBlockElementMarginsToNewlines()}finally{this.removeHiddenContainer()}},n.prototype.createHiddenContainer=function(){return this.referenceElement?(this.containerElement=this.referenceElement.cloneNode(!1),this.containerElement.removeAttribute("id"),this.containerElement.setAttribute("data-trix-internal",""),this.containerElement.style.display="none",this.referenceElement.parentNode.insertBefore(this.containerElement,this.referenceElement.nextSibling)):(this.containerElement=s({tagName:"div",style:{display:"none"}}),document.body.appendChild(this.containerElement))},n.prototype.removeHiddenContainer=function(){return t.removeNode(this.containerElement)},S=function(x){return o(x)==="style"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},n.prototype.processNode=function(x){switch(x.nodeType){case Node.TEXT_NODE:if(!this.isInsignificantTextNode(x))return this.appendBlockForTextNode(x),this.processTextNode(x);break;case Node.ELEMENT_NODE:return this.appendBlockForElement(x),this.processElement(x)}},n.prototype.appendBlockForTextNode=function(x){var k,D,M;return D=x.parentNode,D===this.currentBlockElement&&this.isBlockElement(x.previousSibling)?this.appendStringWithAttributes(`
`):D!==this.containerElement&&!this.isBlockElement(D)||(k=this.getBlockAttributes(D),a(k,(M=this.currentBlock)!=null?M.attributes:void 0))?void 0:(this.currentBlock=this.appendBlockForAttributesWithElement(k,D),this.currentBlockElement=D)},n.prototype.appendBlockForElement=function(x){var k,D,M,F;if(M=this.isBlockElement(x),D=v(this.currentBlockElement,x),M&&!this.isBlockElement(x.firstChild)){if((!this.isInsignificantTextNode(x.firstChild)||!this.isBlockElement(x.firstElementChild))&&(k=this.getBlockAttributes(x),x.firstChild))return D&&a(k,this.currentBlock.attributes)?this.appendStringWithAttributes(`
`):(this.currentBlock=this.appendBlockForAttributesWithElement(k,x),this.currentBlockElement=x)}else if(this.currentBlockElement&&!D&&!M)return(F=this.findParentBlockElement(x))?this.appendBlockForElement(F):(this.currentBlock=this.appendEmptyBlock(),this.currentBlockElement=null)},n.prototype.findParentBlockElement=function(x){var k;for(k=x.parentElement;k&&k!==this.containerElement;){if(this.isBlockElement(k)&&u.call(this.blockElements,k)>=0)return k;k=k.parentElement}return null},n.prototype.processTextNode=function(x){var k,D;return D=x.data,g(x.parentNode)||(D=e(D),O((k=x.previousSibling)!=null?k.textContent:void 0)&&(D=A(D))),this.appendStringWithAttributes(D,this.getTextAttributes(x.parentNode))},n.prototype.processElement=function(x){var k,D,M,F,W;if(p(x))return k=I(x,"attachment"),Object.keys(k).length&&(F=this.getTextAttributes(x),this.appendAttachmentWithAttributes(k,F),x.innerHTML=""),this.processedElements.push(x);switch(o(x)){case"br":return this.isExtraBR(x)||this.isBlockElement(x.nextSibling)||this.appendStringWithAttributes(`
`,this.getTextAttributes(x)),this.processedElements.push(x);case"img":k={url:x.getAttribute("src"),contentType:"image"},M=b(x);for(D in M)W=M[D],k[D]=W;return this.appendAttachmentWithAttributes(k,this.getTextAttributes(x)),this.processedElements.push(x);case"tr":if(x.parentNode.firstChild!==x)return this.appendStringWithAttributes(`
`);break;case"td":if(x.parentNode.firstChild!==x)return this.appendStringWithAttributes(" | ")}},n.prototype.appendBlockForAttributesWithElement=function(x,k){var D;return this.blockElements.push(k),D=l(x),this.blocks.push(D),D},n.prototype.appendEmptyBlock=function(){return this.appendBlockForAttributesWithElement([],null)},n.prototype.appendStringWithAttributes=function(x,k){return this.appendPiece(N(x,k))},n.prototype.appendAttachmentWithAttributes=function(x,k){return this.appendPiece(P(x,k))},n.prototype.appendPiece=function(x){return this.blocks.length===0&&this.appendEmptyBlock(),this.blocks[this.blocks.length-1].text.push(x)},n.prototype.appendStringToTextAtIndex=function(x,k){var D,M;return M=this.blocks[k].text,D=M[M.length-1],(D!=null?D.type:void 0)==="string"?D.string+=x:M.push(N(x))},n.prototype.prependStringToTextAtIndex=function(x,k){var D,M;return M=this.blocks[k].text,D=M[0],(D!=null?D.type:void 0)==="string"?D.string=x+D.string:M.unshift(N(x))},N=function(x,k){var D;return k==null&&(k={}),D="string",x=m(x),{string:x,attributes:k,type:D}},P=function(x,k){var D;return k==null&&(k={}),D="attachment",{attachment:x,attributes:k,type:D}},l=function(x){var k;return x==null&&(x={}),k=[],{text:k,attributes:x}},n.prototype.getTextAttributes=function(x){var k,D,M,F,W,V,H,q,K,J,Z,G;M={},K=t.config.textAttributes;for(k in K)if(W=K[k],W.tagName&&f(x,{matchingSelector:W.tagName,untilNode:this.containerElement}))M[k]=!0;else if(W.parser){if(G=W.parser(x)){for(D=!1,J=this.findBlockElementAncestors(x),V=0,q=J.length;q>V;V++)if(F=J[V],W.parser(F)===G){D=!0;break}D||(M[k]=G)}}else W.styleProperty&&(G=x.style[W.styleProperty])&&(M[k]=G);if(p(x)){Z=I(x,"attributes");for(H in Z)G=Z[H],M[H]=G}return M},n.prototype.getBlockAttributes=function(x){var k,D,M,F;for(D=[];x&&x!==this.containerElement;){F=t.config.blockAttributes;for(k in F)M=F[k],M.parse!==!1&&o(x)===M.tagName&&((typeof M.test=="function"?M.test(x):void 0)||!M.test)&&(D.push(k),M.listAttribute&&D.push(M.listAttribute));x=x.parentNode}return D.reverse()},n.prototype.findBlockElementAncestors=function(x){var k,D;for(k=[];x&&x!==this.containerElement;)D=o(x),u.call(d(),D)>=0&&k.push(x),x=x.parentNode;return k},I=function(x,k){try{return JSON.parse(x.getAttribute("data-trix-"+k))}catch{return{}}},b=function(x){var k,D,M;return M=x.getAttribute("width"),D=x.getAttribute("height"),k={},M&&(k.width=parseInt(M,10)),D&&(k.height=parseInt(D,10)),k},n.prototype.isBlockElement=function(x){var k;if((x!=null?x.nodeType:void 0)===Node.ELEMENT_NODE&&!p(x)&&!f(x,{matchingSelector:"td",untilNode:this.containerElement}))return k=o(x),u.call(d(),k)>=0||window.getComputedStyle(x).display==="block"},n.prototype.isInsignificantTextNode=function(x){var k,D,M;if((x!=null?x.nodeType:void 0)===Node.TEXT_NODE&&T(x.data)&&(D=x.parentNode,M=x.previousSibling,k=x.nextSibling,(!C(D.previousSibling)||this.isBlockElement(D.previousSibling))&&!g(D)))return!M||this.isBlockElement(M)||!k||this.isBlockElement(k)},n.prototype.isExtraBR=function(x){return o(x)==="br"&&this.isBlockElement(x.parentNode)&&x.parentNode.lastChild===x},g=function(x){var k;return k=window.getComputedStyle(x).whiteSpace,k==="pre"||k==="pre-wrap"||k==="pre-line"},C=function(x){return x&&!O(x.textContent)},n.prototype.translateBlockElementMarginsToNewlines=function(){var x,k,D,M,F,W,V,H;for(k=this.getMarginOfDefaultBlockElement(),V=this.blocks,H=[],M=D=0,F=V.length;F>D;M=++D)x=V[M],(W=this.getMarginOfBlockElementAtIndex(M))&&(W.top>2*k.top&&this.prependStringToTextAtIndex(`
`,M),H.push(W.bottom>2*k.bottom?this.appendStringToTextAtIndex(`
`,M):void 0));return H},n.prototype.getMarginOfBlockElementAtIndex=function(x){var k,D;return!(k=this.blockElements[x])||!k.textContent||(D=o(k),u.call(d(),D)>=0||u.call(this.processedElements,k)>=0)?void 0:w(k)},n.prototype.getMarginOfDefaultBlockElement=function(){var x;return x=s(t.config.blockAttributes.default.tagName),this.containerElement.appendChild(x),w(x)},w=function(x){var k;return k=window.getComputedStyle(x),k.display==="block"?{top:parseInt(k.marginTop),bottom:parseInt(k.marginBottom)}:void 0},A=function(x){return x.replace(RegExp("^"+h.source+"+"),"")},T=function(x){return RegExp("^"+h.source+"*$").test(x)},O=function(x){return/\s$/.test(x)},n}(t.BasicObject)}.call(this),function(){var a,h,v,f,d=function(e,o){function i(){this.constructor=e}for(var r in o)s.call(o,r)&&(e[r]=o[r]);return i.prototype=o.prototype,e.prototype=new i,e.__super__=o.prototype,e},s={}.hasOwnProperty,p=[].slice,m=[].indexOf||function(e){for(var o=0,i=this.length;i>o;o++)if(o in this&&this[o]===e)return o;return-1};a=t.arraysAreEqual,v=t.normalizeRange,f=t.rangeIsCollapsed,h=t.getBlockConfig,t.Document=function(e){function o(r){r==null&&(r=[]),o.__super__.constructor.apply(this,arguments),r.length===0&&(r=[new t.Block]),this.blockList=t.SplittableList.box(r)}var i;return d(o,e),o.fromJSON=function(r){var c,u;return u=function(){var y,n,l;for(l=[],y=0,n=r.length;n>y;y++)c=r[y],l.push(t.Block.fromJSON(c));return l}(),new this(u)},o.fromHTML=function(r,c){return t.HTMLParser.parse(r,c).getDocument()},o.fromString=function(r,c){var u;return u=t.Text.textForStringWithAttributes(r,c),new this([new t.Block(u)])},o.prototype.isEmpty=function(){var r;return this.blockList.length===1&&(r=this.getBlockAtIndex(0),r.isEmpty()&&!r.hasAttributes())},o.prototype.copy=function(r){var c;return r==null&&(r={}),c=r.consolidateBlocks?this.blockList.consolidate().toArray():this.blockList.toArray(),new this.constructor(c)},o.prototype.copyUsingObjectsFromDocument=function(r){var c;return c=new t.ObjectMap(r.getObjects()),this.copyUsingObjectMap(c)},o.prototype.copyUsingObjectMap=function(r){var c,u,y;return u=function(){var n,l,g,w;for(g=this.getBlocks(),w=[],n=0,l=g.length;l>n;n++)c=g[n],w.push((y=r.find(c))?y:c.copyUsingObjectMap(r));return w}.call(this),new this.constructor(u)},o.prototype.copyWithBaseBlockAttributes=function(r){var c,u,y;return r==null&&(r=[]),y=function(){var n,l,g,w;for(g=this.getBlocks(),w=[],n=0,l=g.length;l>n;n++)u=g[n],c=r.concat(u.getAttributes()),w.push(u.copyWithAttributes(c));return w}.call(this),new this.constructor(y)},o.prototype.replaceBlock=function(r,c){var u;return u=this.blockList.indexOf(r),u===-1?this:new this.constructor(this.blockList.replaceObjectAtIndex(c,u))},o.prototype.insertDocumentAtRange=function(r,c){var u,y,n,l,g,w,b;return y=r.blockList,g=(c=v(c))[0],w=this.locationFromPosition(g),n=w.index,l=w.offset,b=this,u=this.getBlockAtPosition(g),f(c)&&u.isEmpty()&&!u.hasAttributes()?b=new this.constructor(b.blockList.removeObjectAtIndex(n)):u.getBlockBreakPosition()===l&&g++,b=b.removeTextAtRange(c),new this.constructor(b.blockList.insertSplittableListAtPosition(y,g))},o.prototype.mergeDocumentAtRange=function(r,c){var u,y,n,l,g,w,b,A,C,S,I,P;return I=(c=v(c))[0],S=this.locationFromPosition(I),y=this.getBlockAtIndex(S.index).getAttributes(),u=r.getBaseBlockAttributes(),P=y.slice(-u.length),a(u,P)?(b=y.slice(0,-u.length),w=r.copyWithBaseBlockAttributes(b)):w=r.copy({consolidateBlocks:!0}).copyWithBaseBlockAttributes(y),n=w.getBlockCount(),l=w.getBlockAtIndex(0),a(y,l.getAttributes())?(g=l.getTextWithoutBlockBreak(),C=this.insertTextAtRange(g,c),n>1&&(w=new this.constructor(w.getBlocks().slice(1)),A=I+g.getLength(),C=C.insertDocumentAtRange(w,A))):C=this.insertDocumentAtRange(w,c),C},o.prototype.insertTextAtRange=function(r,c){var u,y,n,l,g;return g=(c=v(c))[0],l=this.locationFromPosition(g),y=l.index,n=l.offset,u=this.removeTextAtRange(c),new this.constructor(u.blockList.editObjectAtIndex(y,function(w){return w.copyWithText(w.text.insertTextAtPosition(r,n))}))},o.prototype.removeTextAtRange=function(r){var c,u,y,n,l,g,w,b,A,C,S,I,P,N,O,T,x,k,D,M,F;return C=r=v(r),b=C[0],k=C[1],f(r)?this:(S=this.locationRangeFromRange(r),g=S[0],T=S[1],l=g.index,w=g.offset,n=this.getBlockAtIndex(l),O=T.index,x=T.offset,N=this.getBlockAtIndex(O),I=k-b==1&&n.getBlockBreakPosition()===w&&N.getBlockBreakPosition()!==x&&N.text.getStringAtPosition(x)===`
`,I?y=this.blockList.editObjectAtIndex(O,function(W){return W.copyWithText(W.text.removeTextAtRange([x,x+1]))}):(A=n.text.getTextAtRange([0,w]),D=N.text.getTextAtRange([x,N.getLength()]),M=A.appendText(D),P=l!==O&&w===0,F=P&&n.getAttributeLevel()>=N.getAttributeLevel(),u=F?N.copyWithText(M):n.copyWithText(M),c=O+1-l,y=this.blockList.splice(l,c,u)),new this.constructor(y))},o.prototype.moveTextFromRangeToPosition=function(r,c){var u,y,n,l,g,w,b,A,C,S;return w=r=v(r),C=w[0],n=w[1],c>=C&&n>=c?this:(y=this.getDocumentAtRange(r),A=this.removeTextAtRange(r),g=c>C,g&&(c-=y.getLength()),b=y.getBlocks(),l=b[0],u=2<=b.length?p.call(b,1):[],u.length===0?(S=l.getTextWithoutBlockBreak(),g&&(c+=1)):S=l.text,A=A.insertTextAtRange(S,c),u.length===0?A:(y=new this.constructor(u),c+=S.getLength(),A.insertDocumentAtRange(y,c)))},o.prototype.addAttributeAtRange=function(r,c,u){var y;return y=this.blockList,this.eachBlockAtRange(u,function(n,l,g){return y=y.editObjectAtIndex(g,function(){return h(r)?n.addAttribute(r,c):l[0]===l[1]?n:n.copyWithText(n.text.addAttributeAtRange(r,c,l))})}),new this.constructor(y)},o.prototype.addAttribute=function(r,c){var u;return u=this.blockList,this.eachBlock(function(y,n){return u=u.editObjectAtIndex(n,function(){return y.addAttribute(r,c)})}),new this.constructor(u)},o.prototype.removeAttributeAtRange=function(r,c){var u;return u=this.blockList,this.eachBlockAtRange(c,function(y,n,l){return h(r)?u=u.editObjectAtIndex(l,function(){return y.removeAttribute(r)}):n[0]!==n[1]?u=u.editObjectAtIndex(l,function(){return y.copyWithText(y.text.removeAttributeAtRange(r,n))}):void 0}),new this.constructor(u)},o.prototype.updateAttributesForAttachment=function(r,c){var u,y,n,l;return n=(y=this.getRangeOfAttachment(c))[0],u=this.locationFromPosition(n).index,l=this.getTextAtIndex(u),new this.constructor(this.blockList.editObjectAtIndex(u,function(g){return g.copyWithText(l.updateAttributesForAttachment(r,c))}))},o.prototype.removeAttributeForAttachment=function(r,c){var u;return u=this.getRangeOfAttachment(c),this.removeAttributeAtRange(r,u)},o.prototype.insertBlockBreakAtRange=function(r){var c,u,y,n;return n=(r=v(r))[0],y=this.locationFromPosition(n).offset,u=this.removeTextAtRange(r),y===0&&(c=[new t.Block]),new this.constructor(u.blockList.insertSplittableListAtPosition(new t.SplittableList(c),n))},o.prototype.applyBlockAttributeAtRange=function(r,c,u){var y,n,l,g;return l=this.expandRangeToLineBreaksAndSplitBlocks(u),n=l.document,u=l.range,y=h(r),y.listAttribute?(n=n.removeLastListAttributeAtRange(u,{exceptAttributeName:r}),g=n.convertLineBreaksToBlockBreaksInRange(u),n=g.document,u=g.range):n=y.exclusive?n.removeBlockAttributesAtRange(u):y.terminal?n.removeLastTerminalAttributeAtRange(u):n.consolidateBlocksAtRange(u),n.addAttributeAtRange(r,c,u)},o.prototype.removeLastListAttributeAtRange=function(r,c){var u;return c==null&&(c={}),u=this.blockList,this.eachBlockAtRange(r,function(y,n,l){var g;if((g=y.getLastAttribute())&&h(g).listAttribute&&g!==c.exceptAttributeName)return u=u.editObjectAtIndex(l,function(){return y.removeAttribute(g)})}),new this.constructor(u)},o.prototype.removeLastTerminalAttributeAtRange=function(r){var c;return c=this.blockList,this.eachBlockAtRange(r,function(u,y,n){var l;if((l=u.getLastAttribute())&&h(l).terminal)return c=c.editObjectAtIndex(n,function(){return u.removeAttribute(l)})}),new this.constructor(c)},o.prototype.removeBlockAttributesAtRange=function(r){var c;return c=this.blockList,this.eachBlockAtRange(r,function(u,y,n){return u.hasAttributes()?c=c.editObjectAtIndex(n,function(){return u.copyWithoutAttributes()}):void 0}),new this.constructor(c)},o.prototype.expandRangeToLineBreaksAndSplitBlocks=function(r){var c,u,y,n,l,g,w,b,A;return g=r=v(r),A=g[0],n=g[1],b=this.locationFromPosition(A),y=this.locationFromPosition(n),c=this,w=c.getBlockAtIndex(b.index),(b.offset=w.findLineBreakInDirectionFromPosition("backward",b.offset))!=null&&(l=c.positionFromLocation(b),c=c.insertBlockBreakAtRange([l,l+1]),y.index+=1,y.offset-=c.getBlockAtIndex(b.index).getLength(),b.index+=1),b.offset=0,y.offset===0&&y.index>b.index?(y.index-=1,y.offset=c.getBlockAtIndex(y.index).getBlockBreakPosition()):(u=c.getBlockAtIndex(y.index),u.text.getStringAtRange([y.offset-1,y.offset])===`
`?y.offset-=1:y.offset=u.findLineBreakInDirectionFromPosition("forward",y.offset),y.offset!==u.getBlockBreakPosition()&&(l=c.positionFromLocation(y),c=c.insertBlockBreakAtRange([l,l+1]))),A=c.positionFromLocation(b),n=c.positionFromLocation(y),r=v([A,n]),{document:c,range:r}},o.prototype.convertLineBreaksToBlockBreaksInRange=function(r){var c,u,y;return u=(r=v(r))[0],y=this.getStringAtRange(r).slice(0,-1),c=this,y.replace(/.*?\n/g,function(n){return u+=n.length,c=c.insertBlockBreakAtRange([u-1,u])}),{document:c,range:r}},o.prototype.consolidateBlocksAtRange=function(r){var c,u,y,n,l;return y=r=v(r),l=y[0],u=y[1],n=this.locationFromPosition(l).index,c=this.locationFromPosition(u).index,new this.constructor(this.blockList.consolidateFromIndexToIndex(n,c))},o.prototype.getDocumentAtRange=function(r){var c;return r=v(r),c=this.blockList.getSplittableListInRange(r).toArray(),new this.constructor(c)},o.prototype.getStringAtRange=function(r){var c,u,y;return y=r=v(r),u=y[y.length-1],u!==this.getLength()&&(c=-1),this.getDocumentAtRange(r).toString().slice(0,c)},o.prototype.getBlockAtIndex=function(r){return this.blockList.getObjectAtIndex(r)},o.prototype.getBlockAtPosition=function(r){var c;return c=this.locationFromPosition(r).index,this.getBlockAtIndex(c)},o.prototype.getTextAtIndex=function(r){var c;return(c=this.getBlockAtIndex(r))!=null?c.text:void 0},o.prototype.getTextAtPosition=function(r){var c;return c=this.locationFromPosition(r).index,this.getTextAtIndex(c)},o.prototype.getPieceAtPosition=function(r){var c,u,y;return y=this.locationFromPosition(r),c=y.index,u=y.offset,this.getTextAtIndex(c).getPieceAtPosition(u)},o.prototype.getCharacterAtPosition=function(r){var c,u,y;return y=this.locationFromPosition(r),c=y.index,u=y.offset,this.getTextAtIndex(c).getStringAtRange([u,u+1])},o.prototype.getLength=function(){return this.blockList.getEndPosition()},o.prototype.getBlocks=function(){return this.blockList.toArray()},o.prototype.getBlockCount=function(){return this.blockList.length},o.prototype.getEditCount=function(){return this.editCount},o.prototype.eachBlock=function(r){return this.blockList.eachObject(r)},o.prototype.eachBlockAtRange=function(r,c){var u,y,n,l,g,w,b,A,C,S,I,P;if(w=r=v(r),I=w[0],n=w[1],S=this.locationFromPosition(I),y=this.locationFromPosition(n),S.index===y.index)return u=this.getBlockAtIndex(S.index),P=[S.offset,y.offset],c(u,P,S.index);for(C=[],g=l=b=S.index,A=y.index;A>=b?A>=l:l>=A;g=A>=b?++l:--l)(u=this.getBlockAtIndex(g))?(P=function(){switch(g){case S.index:return[S.offset,u.text.getLength()];case y.index:return[0,y.offset];default:return[0,u.text.getLength()]}}(),C.push(c(u,P,g))):C.push(void 0);return C},o.prototype.getCommonAttributesAtRange=function(r){var c,u,y;return u=(r=v(r))[0],f(r)?this.getCommonAttributesAtPosition(u):(y=[],c=[],this.eachBlockAtRange(r,function(n,l){return l[0]!==l[1]?(y.push(n.text.getCommonAttributesAtRange(l)),c.push(i(n))):void 0}),t.Hash.fromCommonAttributesOfObjects(y).merge(t.Hash.fromCommonAttributesOfObjects(c)).toObject())},o.prototype.getCommonAttributesAtPosition=function(r){var c,u,y,n,l,g,w,b,A,C;if(A=this.locationFromPosition(r),l=A.index,b=A.offset,y=this.getBlockAtIndex(l),!y)return{};n=i(y),c=y.text.getAttributesAtPosition(b),u=y.text.getAttributesAtPosition(b-1),g=function(){var S,I;S=t.config.textAttributes,I=[];for(w in S)C=S[w],C.inheritable&&I.push(w);return I}();for(w in u)C=u[w],(C===c[w]||m.call(g,w)>=0)&&(n[w]=C);return n},o.prototype.getRangeOfCommonAttributeAtPosition=function(r,c){var u,y,n,l,g,w,b,A,C;return g=this.locationFromPosition(c),n=g.index,l=g.offset,C=this.getTextAtIndex(n),w=C.getExpandedRangeForAttributeAtOffset(r,l),A=w[0],y=w[1],b=this.positionFromLocation({index:n,offset:A}),u=this.positionFromLocation({index:n,offset:y}),v([b,u])},o.prototype.getBaseBlockAttributes=function(){var r,c,u,y,n,l,g;for(r=this.getBlockAtIndex(0).getAttributes(),u=y=1,g=this.getBlockCount();g>=1?g>y:y>g;u=g>=1?++y:--y)c=this.getBlockAtIndex(u).getAttributes(),l=Math.min(r.length,c.length),r=function(){var w,b,A;for(A=[],n=w=0,b=l;(b>=0?b>w:w>b)&&c[n]===r[n];n=b>=0?++w:--w)A.push(c[n]);return A}();return r},i=function(r){var c,u;return u={},(c=r.getLastAttribute())&&(u[c]=!0),u},o.prototype.getAttachmentById=function(r){var c,u,y,n;for(n=this.getAttachments(),u=0,y=n.length;y>u;u++)if(c=n[u],c.id===r)return c},o.prototype.getAttachmentPieces=function(){var r;return r=[],this.blockList.eachObject(function(c){var u;return u=c.text,r=r.concat(u.getAttachmentPieces())}),r},o.prototype.getAttachments=function(){var r,c,u,y,n;for(y=this.getAttachmentPieces(),n=[],r=0,c=y.length;c>r;r++)u=y[r],n.push(u.attachment);return n},o.prototype.getRangeOfAttachment=function(r){var c,u,y,n,l,g,w;for(n=0,l=this.blockList.toArray(),u=c=0,y=l.length;y>c;u=++c){if(g=l[u].text,w=g.getRangeOfAttachment(r))return v([n+w[0],n+w[1]]);n+=g.getLength()}},o.prototype.getLocationRangeOfAttachment=function(r){var c;return c=this.getRangeOfAttachment(r),this.locationRangeFromRange(c)},o.prototype.getAttachmentPieceForAttachment=function(r){var c,u,y,n;for(n=this.getAttachmentPieces(),c=0,u=n.length;u>c;c++)if(y=n[c],y.attachment===r)return y},o.prototype.findRangesForBlockAttribute=function(r){var c,u,y,n,l,g,w;for(l=0,g=[],w=this.getBlocks(),u=0,y=w.length;y>u;u++)c=w[u],n=c.getLength(),c.hasAttribute(r)&&g.push([l,l+n]),l+=n;return g},o.prototype.findRangesForTextAttribute=function(r,c){var u,y,n,l,g,w,b,A,C,S;for(S=(c??{}).withValue,w=0,b=[],A=[],l=function(I){return S!=null?I.getAttribute(r)===S:I.hasAttribute(r)},C=this.getPieces(),u=0,y=C.length;y>u;u++)g=C[u],n=g.getLength(),l(g)&&(b[1]===w?b[1]=w+n:A.push(b=[w,w+n])),w+=n;return A},o.prototype.locationFromPosition=function(r){var c,u;return u=this.blockList.findIndexAndOffsetAtPosition(Math.max(0,r)),u.index!=null?u:(c=this.getBlocks(),{index:c.length-1,offset:c[c.length-1].getLength()})},o.prototype.positionFromLocation=function(r){return this.blockList.findPositionAtIndexAndOffset(r.index,r.offset)},o.prototype.locationRangeFromPosition=function(r){return v(this.locationFromPosition(r))},o.prototype.locationRangeFromRange=function(r){var c,u,y,n;if(r=v(r))return n=r[0],u=r[1],y=this.locationFromPosition(n),c=this.locationFromPosition(u),v([y,c])},o.prototype.rangeFromLocationRange=function(r){var c,u;return r=v(r),c=this.positionFromLocation(r[0]),f(r)||(u=this.positionFromLocation(r[1])),v([c,u])},o.prototype.isEqualTo=function(r){return this.blockList.isEqualTo(r!=null?r.blockList:void 0)},o.prototype.getTexts=function(){var r,c,u,y,n;for(y=this.getBlocks(),n=[],c=0,u=y.length;u>c;c++)r=y[c],n.push(r.text);return n},o.prototype.getPieces=function(){var r,c,u,y,n;for(u=[],y=this.getTexts(),r=0,c=y.length;c>r;r++)n=y[r],u.push.apply(u,n.getPieces());return u},o.prototype.getObjects=function(){return this.getBlocks().concat(this.getTexts()).concat(this.getPieces())},o.prototype.toSerializableDocument=function(){var r;return r=[],this.blockList.eachObject(function(c){return r.push(c.copyWithText(c.text.toSerializableText()))}),new this.constructor(r)},o.prototype.toString=function(){return this.blockList.toString()},o.prototype.toJSON=function(){return this.blockList.toJSON()},o.prototype.toConsole=function(){var r;return JSON.stringify(function(){var c,u,y,n;for(y=this.blockList.toArray(),n=[],c=0,u=y.length;u>c;c++)r=y[c],n.push(JSON.parse(r.text.toConsole()));return n}.call(this))},o}(t.Object)}.call(this),function(){t.LineBreakInsertion=function(){function a(h){var v;this.composition=h,this.document=this.composition.document,v=this.composition.getSelectedRange(),this.startPosition=v[0],this.endPosition=v[1],this.startLocation=this.document.locationFromPosition(this.startPosition),this.endLocation=this.document.locationFromPosition(this.endPosition),this.block=this.document.getBlockAtIndex(this.endLocation.index),this.breaksOnReturn=this.block.breaksOnReturn(),this.previousCharacter=this.block.text.getStringAtPosition(this.endLocation.offset-1),this.nextCharacter=this.block.text.getStringAtPosition(this.endLocation.offset)}return a.prototype.shouldInsertBlockBreak=function(){return this.block.hasAttributes()&&this.block.isListItem()&&!this.block.isEmpty()?this.startLocation.offset!==0:this.breaksOnReturn&&this.nextCharacter!==`
`},a.prototype.shouldBreakFormattedBlock=function(){return this.block.hasAttributes()&&!this.block.isListItem()&&(this.breaksOnReturn&&this.nextCharacter===`
`||this.previousCharacter===`
`)},a.prototype.shouldDecreaseListLevel=function(){return this.block.hasAttributes()&&this.block.isListItem()&&this.block.isEmpty()},a.prototype.shouldPrependListItem=function(){return this.block.isListItem()&&this.startLocation.offset===0&&!this.block.isEmpty()},a.prototype.shouldRemoveLastBlockAttribute=function(){return this.block.hasAttributes()&&!this.block.isListItem()&&this.block.isEmpty()},a}()}.call(this),function(){var a,h,v,f,d,s,p,m,e,o,i=function(c,u){function y(){this.constructor=c}for(var n in u)r.call(u,n)&&(c[n]=u[n]);return y.prototype=u.prototype,c.prototype=new y,c.__super__=u.prototype,c},r={}.hasOwnProperty;s=t.normalizeRange,e=t.rangesAreEqual,m=t.rangeIsCollapsed,p=t.objectsAreEqual,a=t.arrayStartsWith,o=t.summarizeArrayChange,v=t.getAllAttributeNames,f=t.getBlockConfig,d=t.getTextConfig,h=t.extend,t.Composition=function(c){function u(){this.document=new t.Document,this.attachments=[],this.currentAttributes={},this.revision=0}var y;return i(u,c),u.prototype.setDocument=function(n){var l;return n.isEqualTo(this.document)?void 0:(this.document=n,this.refreshAttachments(),this.revision++,(l=this.delegate)!=null&&typeof l.compositionDidChangeDocument=="function"?l.compositionDidChangeDocument(n):void 0)},u.prototype.getSnapshot=function(){return{document:this.document,selectedRange:this.getSelectedRange()}},u.prototype.loadSnapshot=function(n){var l,g,w,b;return l=n.document,b=n.selectedRange,(g=this.delegate)!=null&&typeof g.compositionWillLoadSnapshot=="function"&&g.compositionWillLoadSnapshot(),this.setDocument(l??new t.Document),this.setSelection(b??[0,0]),(w=this.delegate)!=null&&typeof w.compositionDidLoadSnapshot=="function"?w.compositionDidLoadSnapshot():void 0},u.prototype.insertText=function(n,l){var g,w,b,A;return A=(l??{updatePosition:!0}).updatePosition,w=this.getSelectedRange(),this.setDocument(this.document.insertTextAtRange(n,w)),b=w[0],g=b+n.getLength(),A&&this.setSelection(g),this.notifyDelegateOfInsertionAtRange([b,g])},u.prototype.insertBlock=function(n){var l;return n==null&&(n=new t.Block),l=new t.Document([n]),this.insertDocument(l)},u.prototype.insertDocument=function(n){var l,g,w;return n==null&&(n=new t.Document),g=this.getSelectedRange(),this.setDocument(this.document.insertDocumentAtRange(n,g)),w=g[0],l=w+n.getLength(),this.setSelection(l),this.notifyDelegateOfInsertionAtRange([w,l])},u.prototype.insertString=function(n,l){var g,w;return g=this.getCurrentTextAttributes(),w=t.Text.textForStringWithAttributes(n,g),this.insertText(w,l)},u.prototype.insertBlockBreak=function(){var n,l,g;return l=this.getSelectedRange(),this.setDocument(this.document.insertBlockBreakAtRange(l)),g=l[0],n=g+1,this.setSelection(n),this.notifyDelegateOfInsertionAtRange([g,n])},u.prototype.insertLineBreak=function(){var n,l;return l=new t.LineBreakInsertion(this),l.shouldDecreaseListLevel()?(this.decreaseListLevel(),this.setSelection(l.startPosition)):l.shouldPrependListItem()?(n=new t.Document([l.block.copyWithoutText()]),this.insertDocument(n)):l.shouldInsertBlockBreak()?this.insertBlockBreak():l.shouldRemoveLastBlockAttribute()?this.removeLastBlockAttribute():l.shouldBreakFormattedBlock()?this.breakFormattedBlock(l):this.insertString(`
`)},u.prototype.insertHTML=function(n){var l,g,w,b;return l=t.Document.fromHTML(n),w=this.getSelectedRange(),this.setDocument(this.document.mergeDocumentAtRange(l,w)),b=w[0],g=b+l.getLength()-1,this.setSelection(g),this.notifyDelegateOfInsertionAtRange([b,g])},u.prototype.replaceHTML=function(n){var l,g,w;return l=t.Document.fromHTML(n).copyUsingObjectsFromDocument(this.document),g=this.getLocationRange({strict:!1}),w=this.document.rangeFromLocationRange(g),this.setDocument(l),this.setSelection(w)},u.prototype.insertFile=function(n){return this.insertFiles([n])},u.prototype.insertFiles=function(n){var l,g,w,b,A,C;for(g=[],b=0,A=n.length;A>b;b++)w=n[b],((C=this.delegate)!=null?C.compositionShouldAcceptFile(w):void 0)&&(l=t.Attachment.attachmentForFile(w),g.push(l));return this.insertAttachments(g)},u.prototype.insertAttachment=function(n){return this.insertAttachments([n])},u.prototype.insertAttachments=function(n){var l,g,w,b,A,C,S,I,P;for(I=new t.Text,b=0,A=n.length;A>b;b++)l=n[b],P=l.getType(),C=(S=t.config.attachments[P])!=null?S.presentation:void 0,w=this.getCurrentTextAttributes(),C&&(w.presentation=C),g=t.Text.textForAttachmentWithAttributes(l,w),I=I.appendText(g);return this.insertText(I)},u.prototype.shouldManageDeletingInDirection=function(n){var l;if(l=this.getLocationRange(),m(l)){if(n==="backward"&&l[0].offset===0||this.shouldManageMovingCursorInDirection(n))return!0}else if(l[0].index!==l[1].index)return!0;return!1},u.prototype.deleteInDirection=function(n,l){var g,w,b,A,C,S,I,P;return A=(l??{}).length,C=this.getLocationRange(),S=this.getSelectedRange(),I=m(S),I?b=n==="backward"&&C[0].offset===0:P=C[0].index!==C[1].index,b&&this.canDecreaseBlockAttributeLevel()&&(w=this.getBlock(),w.isListItem()?this.decreaseListLevel():this.decreaseBlockAttributeLevel(),this.setSelection(S[0]),w.isEmpty())?!1:(I&&(S=this.getExpandedRangeInDirection(n,{length:A}),n==="backward"&&(g=this.getAttachmentAtRange(S))),g?(this.editAttachment(g),!1):(this.setDocument(this.document.removeTextAtRange(S)),this.setSelection(S[0]),b||P?!1:void 0))},u.prototype.moveTextFromRange=function(n){var l;return l=this.getSelectedRange()[0],this.setDocument(this.document.moveTextFromRangeToPosition(n,l)),this.setSelection(l)},u.prototype.removeAttachment=function(n){var l;return(l=this.document.getRangeOfAttachment(n))?(this.stopEditingAttachment(),this.setDocument(this.document.removeTextAtRange(l)),this.setSelection(l[0])):void 0},u.prototype.removeLastBlockAttribute=function(){var n,l,g,w;return g=this.getSelectedRange(),w=g[0],l=g[1],n=this.document.getBlockAtPosition(l),this.removeCurrentAttribute(n.getLastAttribute()),this.setSelection(w)},y=" ",u.prototype.insertPlaceholder=function(){return this.placeholderPosition=this.getPosition(),this.insertString(y)},u.prototype.selectPlaceholder=function(){return this.placeholderPosition!=null?(this.setSelectedRange([this.placeholderPosition,this.placeholderPosition+y.length]),this.getSelectedRange()):void 0},u.prototype.forgetPlaceholder=function(){return this.placeholderPosition=null},u.prototype.hasCurrentAttribute=function(n){var l;return l=this.currentAttributes[n],l!=null&&l!==!1},u.prototype.toggleCurrentAttribute=function(n){var l;return(l=!this.currentAttributes[n])?this.setCurrentAttribute(n,l):this.removeCurrentAttribute(n)},u.prototype.canSetCurrentAttribute=function(n){return f(n)?this.canSetCurrentBlockAttribute(n):this.canSetCurrentTextAttribute(n)},u.prototype.canSetCurrentTextAttribute=function(){var n,l,g,w,b;if(l=this.getSelectedDocument()){for(b=l.getAttachments(),g=0,w=b.length;w>g;g++)if(n=b[g],!n.hasContent())return!1;return!0}},u.prototype.canSetCurrentBlockAttribute=function(){var n;if(n=this.getBlock())return!n.isTerminalBlock()},u.prototype.setCurrentAttribute=function(n,l){return f(n)?this.setBlockAttribute(n,l):(this.setTextAttribute(n,l),this.currentAttributes[n]=l,this.notifyDelegateOfCurrentAttributesChange())},u.prototype.setTextAttribute=function(n,l){var g,w,b,A;if(w=this.getSelectedRange())return b=w[0],g=w[1],b!==g?this.setDocument(this.document.addAttributeAtRange(n,l,w)):n==="href"?(A=t.Text.textForStringWithAttributes(l,{href:l}),this.insertText(A)):void 0},u.prototype.setBlockAttribute=function(n,l){var g,w;if(w=this.getSelectedRange())return this.canSetCurrentAttribute(n)?(g=this.getBlock(),this.setDocument(this.document.applyBlockAttributeAtRange(n,l,w)),this.setSelection(w)):void 0},u.prototype.removeCurrentAttribute=function(n){return f(n)?(this.removeBlockAttribute(n),this.updateCurrentAttributes()):(this.removeTextAttribute(n),delete this.currentAttributes[n],this.notifyDelegateOfCurrentAttributesChange())},u.prototype.removeTextAttribute=function(n){var l;if(l=this.getSelectedRange())return this.setDocument(this.document.removeAttributeAtRange(n,l))},u.prototype.removeBlockAttribute=function(n){var l;if(l=this.getSelectedRange())return this.setDocument(this.document.removeAttributeAtRange(n,l))},u.prototype.canDecreaseNestingLevel=function(){var n;return((n=this.getBlock())!=null?n.getNestingLevel():void 0)>0},u.prototype.canIncreaseNestingLevel=function(){var n,l,g;if(n=this.getBlock())return((g=f(n.getLastNestableAttribute()))!=null?g.listAttribute:0)?(l=this.getPreviousBlock())?a(l.getListItemAttributes(),n.getListItemAttributes()):void 0:n.getNestingLevel()>0},u.prototype.decreaseNestingLevel=function(){var n;if(n=this.getBlock())return this.setDocument(this.document.replaceBlock(n,n.decreaseNestingLevel()))},u.prototype.increaseNestingLevel=function(){var n;if(n=this.getBlock())return this.setDocument(this.document.replaceBlock(n,n.increaseNestingLevel()))},u.prototype.canDecreaseBlockAttributeLevel=function(){var n;return((n=this.getBlock())!=null?n.getAttributeLevel():void 0)>0},u.prototype.decreaseBlockAttributeLevel=function(){var n,l;return(n=(l=this.getBlock())!=null?l.getLastAttribute():void 0)?this.removeCurrentAttribute(n):void 0},u.prototype.decreaseListLevel=function(){var n,l,g,w,b,A;for(A=this.getSelectedRange()[0],b=this.document.locationFromPosition(A).index,g=b,n=this.getBlock().getAttributeLevel();(l=this.document.getBlockAtIndex(g+1))&&l.isListItem()&&l.getAttributeLevel()>n;)g++;return A=this.document.positionFromLocation({index:b,offset:0}),w=this.document.positionFromLocation({index:g,offset:0}),this.setDocument(this.document.removeLastListAttributeAtRange([A,w]))},u.prototype.updateCurrentAttributes=function(){var n,l,g,w,b,A;if(A=this.getSelectedRange({ignoreLock:!0})){for(l=this.document.getCommonAttributesAtRange(A),b=v(),g=0,w=b.length;w>g;g++)n=b[g],l[n]||this.canSetCurrentAttribute(n)||(l[n]=!1);if(!p(l,this.currentAttributes))return this.currentAttributes=l,this.notifyDelegateOfCurrentAttributesChange()}},u.prototype.getCurrentAttributes=function(){return h.call({},this.currentAttributes)},u.prototype.getCurrentTextAttributes=function(){var n,l,g,w;n={},g=this.currentAttributes;for(l in g)w=g[l],w!==!1&&d(l)&&(n[l]=w);return n},u.prototype.freezeSelection=function(){return this.setCurrentAttribute("frozen",!0)},u.prototype.thawSelection=function(){return this.removeCurrentAttribute("frozen")},u.prototype.hasFrozenSelection=function(){return this.hasCurrentAttribute("frozen")},u.proxyMethod("getSelectionManager().getPointRange"),u.proxyMethod("getSelectionManager().setLocationRangeFromPointRange"),u.proxyMethod("getSelectionManager().createLocationRangeFromDOMRange"),u.proxyMethod("getSelectionManager().locationIsCursorTarget"),u.proxyMethod("getSelectionManager().selectionIsExpanded"),u.proxyMethod("delegate?.getSelectionManager"),u.prototype.setSelection=function(n){var l,g;return l=this.document.locationRangeFromRange(n),(g=this.delegate)!=null?g.compositionDidRequestChangingSelectionToLocationRange(l):void 0},u.prototype.getSelectedRange=function(){var n;return(n=this.getLocationRange())?this.document.rangeFromLocationRange(n):void 0},u.prototype.setSelectedRange=function(n){var l;return l=this.document.locationRangeFromRange(n),this.getSelectionManager().setLocationRange(l)},u.prototype.getPosition=function(){var n;return(n=this.getLocationRange())?this.document.positionFromLocation(n[0]):void 0},u.prototype.getLocationRange=function(n){var l,g;return(l=(g=this.targetLocationRange)!=null?g:this.getSelectionManager().getLocationRange(n))!=null?l:s({index:0,offset:0})},u.prototype.withTargetLocationRange=function(n,l){var g;this.targetLocationRange=n;try{g=l()}finally{this.targetLocationRange=null}return g},u.prototype.withTargetRange=function(n,l){var g;return g=this.document.locationRangeFromRange(n),this.withTargetLocationRange(g,l)},u.prototype.withTargetDOMRange=function(n,l){var g;return g=this.createLocationRangeFromDOMRange(n,{strict:!1}),this.withTargetLocationRange(g,l)},u.prototype.getExpandedRangeInDirection=function(n,l){var g,w,b,A;return w=(l??{}).length,b=this.getSelectedRange(),A=b[0],g=b[1],n==="backward"?w?A-=w:A=this.translateUTF16PositionFromOffset(A,-1):w?g+=w:g=this.translateUTF16PositionFromOffset(g,1),s([A,g])},u.prototype.shouldManageMovingCursorInDirection=function(n){var l;return this.editingAttachment?!0:(l=this.getExpandedRangeInDirection(n),this.getAttachmentAtRange(l)!=null)},u.prototype.moveCursorInDirection=function(n){var l,g,w,b;return this.editingAttachment?w=this.document.getRangeOfAttachment(this.editingAttachment):(b=this.getSelectedRange(),w=this.getExpandedRangeInDirection(n),g=!e(b,w)),this.setSelectedRange(n==="backward"?w[0]:w[1]),g&&(l=this.getAttachmentAtRange(w))?this.editAttachment(l):void 0},u.prototype.expandSelectionInDirection=function(n,l){var g,w;return g=(l??{}).length,w=this.getExpandedRangeInDirection(n,{length:g}),this.setSelectedRange(w)},u.prototype.expandSelectionForEditing=function(){return this.hasCurrentAttribute("href")?this.expandSelectionAroundCommonAttribute("href"):void 0},u.prototype.expandSelectionAroundCommonAttribute=function(n){var l,g;return l=this.getPosition(),g=this.document.getRangeOfCommonAttributeAtPosition(n,l),this.setSelectedRange(g)},u.prototype.selectionContainsAttachments=function(){var n;return((n=this.getSelectedAttachments())!=null?n.length:void 0)>0},u.prototype.selectionIsInCursorTarget=function(){return this.editingAttachment||this.positionIsCursorTarget(this.getPosition())},u.prototype.positionIsCursorTarget=function(n){var l;return(l=this.document.locationFromPosition(n))?this.locationIsCursorTarget(l):void 0},u.prototype.positionIsBlockBreak=function(n){var l;return(l=this.document.getPieceAtPosition(n))!=null?l.isBlockBreak():void 0},u.prototype.getSelectedDocument=function(){var n;return(n=this.getSelectedRange())?this.document.getDocumentAtRange(n):void 0},u.prototype.getSelectedAttachments=function(){var n;return(n=this.getSelectedDocument())!=null?n.getAttachments():void 0},u.prototype.getAttachments=function(){return this.attachments.slice(0)},u.prototype.refreshAttachments=function(){var n,l,g,w,b,A,C,S,I,P,N,O;for(g=this.document.getAttachments(),S=o(this.attachments,g),n=S.added,N=S.removed,this.attachments=g,w=0,A=N.length;A>w;w++)l=N[w],l.delegate=null,(I=this.delegate)!=null&&typeof I.compositionDidRemoveAttachment=="function"&&I.compositionDidRemoveAttachment(l);for(O=[],b=0,C=n.length;C>b;b++)l=n[b],l.delegate=this,O.push((P=this.delegate)!=null&&typeof P.compositionDidAddAttachment=="function"?P.compositionDidAddAttachment(l):void 0);return O},u.prototype.attachmentDidChangeAttributes=function(n){var l;return this.revision++,(l=this.delegate)!=null&&typeof l.compositionDidEditAttachment=="function"?l.compositionDidEditAttachment(n):void 0},u.prototype.attachmentDidChangePreviewURL=function(n){var l;return this.revision++,(l=this.delegate)!=null&&typeof l.compositionDidChangeAttachmentPreviewURL=="function"?l.compositionDidChangeAttachmentPreviewURL(n):void 0},u.prototype.editAttachment=function(n,l){var g;if(n!==this.editingAttachment)return this.stopEditingAttachment(),this.editingAttachment=n,(g=this.delegate)!=null&&typeof g.compositionDidStartEditingAttachment=="function"?g.compositionDidStartEditingAttachment(this.editingAttachment,l):void 0},u.prototype.stopEditingAttachment=function(){var n;if(this.editingAttachment)return(n=this.delegate)!=null&&typeof n.compositionDidStopEditingAttachment=="function"&&n.compositionDidStopEditingAttachment(this.editingAttachment),this.editingAttachment=null},u.prototype.updateAttributesForAttachment=function(n,l){return this.setDocument(this.document.updateAttributesForAttachment(n,l))},u.prototype.removeAttributeForAttachment=function(n,l){return this.setDocument(this.document.removeAttributeForAttachment(n,l))},u.prototype.breakFormattedBlock=function(n){var l,g,w,b,A;return g=n.document,l=n.block,b=n.startPosition,A=[b-1,b],l.getBlockBreakPosition()===n.startLocation.offset?(l.breaksOnReturn()&&n.nextCharacter===`
`?b+=1:g=g.removeTextAtRange(A),A=[b,b]):n.nextCharacter===`
`?n.previousCharacter===`
`?A=[b-1,b+1]:(A=[b,b+1],b+=1):n.startLocation.offset-1!=0&&(b+=1),w=new t.Document([l.removeLastAttribute().copyWithoutText()]),this.setDocument(g.insertDocumentAtRange(w,A)),this.setSelection(b)},u.prototype.getPreviousBlock=function(){var n,l;return(l=this.getLocationRange())&&(n=l[0].index,n>0)?this.document.getBlockAtIndex(n-1):void 0},u.prototype.getBlock=function(){var n;return(n=this.getLocationRange())?this.document.getBlockAtIndex(n[0].index):void 0},u.prototype.getAttachmentAtRange=function(n){var l;return l=this.document.getDocumentAtRange(n),l.toString()===t.OBJECT_REPLACEMENT_CHARACTER+`
`?l.getAttachments()[0]:void 0},u.prototype.notifyDelegateOfCurrentAttributesChange=function(){var n;return(n=this.delegate)!=null&&typeof n.compositionDidChangeCurrentAttributes=="function"?n.compositionDidChangeCurrentAttributes(this.currentAttributes):void 0},u.prototype.notifyDelegateOfInsertionAtRange=function(n){var l;return(l=this.delegate)!=null&&typeof l.compositionDidPerformInsertionAtRange=="function"?l.compositionDidPerformInsertionAtRange(n):void 0},u.prototype.translateUTF16PositionFromOffset=function(n,l){var g,w;return w=this.document.toUTF16String(),g=w.offsetFromUCS2Offset(n),w.offsetToUCS2Offset(g+l)},u}(t.BasicObject)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.UndoManager=function(v){function f(s){this.composition=s,this.undoEntries=[],this.redoEntries=[]}var d;return a(f,v),f.prototype.recordUndoEntry=function(s,p){var m,e,o,i,r;return i=p??{},e=i.context,m=i.consolidatable,o=this.undoEntries.slice(-1)[0],m&&d(o,s,e)?void 0:(r=this.createEntry({description:s,context:e}),this.undoEntries.push(r),this.redoEntries=[])},f.prototype.undo=function(){var s,p;return(p=this.undoEntries.pop())?(s=this.createEntry(p),this.redoEntries.push(s),this.composition.loadSnapshot(p.snapshot)):void 0},f.prototype.redo=function(){var s,p;return(s=this.redoEntries.pop())?(p=this.createEntry(s),this.undoEntries.push(p),this.composition.loadSnapshot(s.snapshot)):void 0},f.prototype.canUndo=function(){return this.undoEntries.length>0},f.prototype.canRedo=function(){return this.redoEntries.length>0},f.prototype.createEntry=function(s){var p,m,e;return e=s??{},m=e.description,p=e.context,{description:m!=null?m.toString():void 0,context:JSON.stringify(p),snapshot:this.composition.getSnapshot()}},d=function(s,p,m){return(s!=null?s.description:void 0)===(p!=null?p.toString():void 0)&&(s!=null?s.context:void 0)===JSON.stringify(m)},f}(t.BasicObject)}.call(this),function(){var a;t.attachmentGalleryFilter=function(h){var v;return v=new a(h),v.perform(),v.getSnapshot()},a=function(){function h(s){this.document=s.document,this.selectedRange=s.selectedRange}var v,f,d;return v="attachmentGallery",f="presentation",d="gallery",h.prototype.perform=function(){return this.removeBlockAttribute(),this.applyBlockAttribute()},h.prototype.getSnapshot=function(){return{document:this.document,selectedRange:this.selectedRange}},h.prototype.removeBlockAttribute=function(){var s,p,m,e,o;for(e=this.findRangesOfBlocks(),o=[],s=0,p=e.length;p>s;s++)m=e[s],o.push(this.document=this.document.removeAttributeAtRange(v,m));return o},h.prototype.applyBlockAttribute=function(){var s,p,m,e,o,i;for(m=0,o=this.findRangesOfPieces(),i=[],s=0,p=o.length;p>s;s++)e=o[s],e[1]-e[0]>1&&(e[0]+=m,e[1]+=m,this.document.getCharacterAtPosition(e[1])!==`
`&&(this.document=this.document.insertBlockBreakAtRange(e[1]),e[1]<this.selectedRange[1]&&this.moveSelectedRangeForward(),e[1]++,m++),e[0]!==0&&this.document.getCharacterAtPosition(e[0]-1)!==`
`&&(this.document=this.document.insertBlockBreakAtRange(e[0]),e[0]<this.selectedRange[0]&&this.moveSelectedRangeForward(),e[0]++,m++),i.push(this.document=this.document.applyBlockAttributeAtRange(v,!0,e)));return i},h.prototype.findRangesOfBlocks=function(){return this.document.findRangesForBlockAttribute(v)},h.prototype.findRangesOfPieces=function(){return this.document.findRangesForTextAttribute(f,{withValue:d})},h.prototype.moveSelectedRangeForward=function(){return this.selectedRange[0]+=1,this.selectedRange[1]+=1},h}()}.call(this),function(){var a=function(h,v){return function(){return h.apply(v,arguments)}};t.Editor=function(){function h(f,d,s){this.composition=f,this.selectionManager=d,this.element=s,this.insertFiles=a(this.insertFiles,this),this.undoManager=new t.UndoManager(this.composition),this.filters=v.slice(0)}var v;return v=[t.attachmentGalleryFilter],h.prototype.loadDocument=function(f){return this.loadSnapshot({document:f,selectedRange:[0,0]})},h.prototype.loadHTML=function(f){return f==null&&(f=""),this.loadDocument(t.Document.fromHTML(f,{referenceElement:this.element}))},h.prototype.loadJSON=function(f){var d,s;return d=f.document,s=f.selectedRange,d=t.Document.fromJSON(d),this.loadSnapshot({document:d,selectedRange:s})},h.prototype.loadSnapshot=function(f){return this.undoManager=new t.UndoManager(this.composition),this.composition.loadSnapshot(f)},h.prototype.getDocument=function(){return this.composition.document},h.prototype.getSelectedDocument=function(){return this.composition.getSelectedDocument()},h.prototype.getSnapshot=function(){return this.composition.getSnapshot()},h.prototype.toJSON=function(){return this.getSnapshot()},h.prototype.deleteInDirection=function(f){return this.composition.deleteInDirection(f)},h.prototype.insertAttachment=function(f){return this.composition.insertAttachment(f)},h.prototype.insertAttachments=function(f){return this.composition.insertAttachments(f)},h.prototype.insertDocument=function(f){return this.composition.insertDocument(f)},h.prototype.insertFile=function(f){return this.composition.insertFile(f)},h.prototype.insertFiles=function(f){return this.composition.insertFiles(f)},h.prototype.insertHTML=function(f){return this.composition.insertHTML(f)},h.prototype.insertString=function(f){return this.composition.insertString(f)},h.prototype.insertText=function(f){return this.composition.insertText(f)},h.prototype.insertLineBreak=function(){return this.composition.insertLineBreak()},h.prototype.getSelectedRange=function(){return this.composition.getSelectedRange()},h.prototype.getPosition=function(){return this.composition.getPosition()},h.prototype.getClientRectAtPosition=function(f){var d;return d=this.getDocument().locationRangeFromRange([f,f+1]),this.selectionManager.getClientRectAtLocationRange(d)},h.prototype.expandSelectionInDirection=function(f){return this.composition.expandSelectionInDirection(f)},h.prototype.moveCursorInDirection=function(f){return this.composition.moveCursorInDirection(f)},h.prototype.setSelectedRange=function(f){return this.composition.setSelectedRange(f)},h.prototype.activateAttribute=function(f,d){return d==null&&(d=!0),this.composition.setCurrentAttribute(f,d)},h.prototype.attributeIsActive=function(f){return this.composition.hasCurrentAttribute(f)},h.prototype.canActivateAttribute=function(f){return this.composition.canSetCurrentAttribute(f)},h.prototype.deactivateAttribute=function(f){return this.composition.removeCurrentAttribute(f)},h.prototype.canDecreaseNestingLevel=function(){return this.composition.canDecreaseNestingLevel()},h.prototype.canIncreaseNestingLevel=function(){return this.composition.canIncreaseNestingLevel()},h.prototype.decreaseNestingLevel=function(){return this.canDecreaseNestingLevel()?this.composition.decreaseNestingLevel():void 0},h.prototype.increaseNestingLevel=function(){return this.canIncreaseNestingLevel()?this.composition.increaseNestingLevel():void 0},h.prototype.canRedo=function(){return this.undoManager.canRedo()},h.prototype.canUndo=function(){return this.undoManager.canUndo()},h.prototype.recordUndoEntry=function(f,d){var s,p,m;return m=d??{},p=m.context,s=m.consolidatable,this.undoManager.recordUndoEntry(f,{context:p,consolidatable:s})},h.prototype.redo=function(){return this.canRedo()?this.undoManager.redo():void 0},h.prototype.undo=function(){return this.canUndo()?this.undoManager.undo():void 0},h}()}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.ManagedAttachment=function(v){function f(d,s){var p;this.attachmentManager=d,this.attachment=s,p=this.attachment,this.id=p.id,this.file=p.file}return a(f,v),f.prototype.remove=function(){return this.attachmentManager.requestRemovalOfAttachment(this.attachment)},f.proxyMethod("attachment.getAttribute"),f.proxyMethod("attachment.hasAttribute"),f.proxyMethod("attachment.setAttribute"),f.proxyMethod("attachment.getAttributes"),f.proxyMethod("attachment.setAttributes"),f.proxyMethod("attachment.isPending"),f.proxyMethod("attachment.isPreviewable"),f.proxyMethod("attachment.getURL"),f.proxyMethod("attachment.getHref"),f.proxyMethod("attachment.getFilename"),f.proxyMethod("attachment.getFilesize"),f.proxyMethod("attachment.getFormattedFilesize"),f.proxyMethod("attachment.getExtension"),f.proxyMethod("attachment.getContentType"),f.proxyMethod("attachment.getFile"),f.proxyMethod("attachment.setFile"),f.proxyMethod("attachment.releaseFile"),f.proxyMethod("attachment.getUploadProgress"),f.proxyMethod("attachment.setUploadProgress"),f}(t.BasicObject)}.call(this),function(){var a=function(v,f){function d(){this.constructor=v}for(var s in f)h.call(f,s)&&(v[s]=f[s]);return d.prototype=f.prototype,v.prototype=new d,v.__super__=f.prototype,v},h={}.hasOwnProperty;t.AttachmentManager=function(v){function f(d){var s,p,m;for(d==null&&(d=[]),this.managedAttachments={},p=0,m=d.length;m>p;p++)s=d[p],this.manageAttachment(s)}return a(f,v),f.prototype.getAttachments=function(){var d,s,p,m;p=this.managedAttachments,m=[];for(s in p)d=p[s],m.push(d);return m},f.prototype.manageAttachment=function(d){var s,p;return(s=this.managedAttachments)[p=d.id]!=null?s[p]:s[p]=new t.ManagedAttachment(this,d)},f.prototype.attachmentIsManaged=function(d){return d.id in this.managedAttachments},f.prototype.requestRemovalOfAttachment=function(d){var s;return this.attachmentIsManaged(d)&&(s=this.delegate)!=null&&typeof s.attachmentManagerDidRequestRemovalOfAttachment=="function"?s.attachmentManagerDidRequestRemovalOfAttachment(d):void 0},f.prototype.unmanageAttachment=function(d){var s;return s=this.managedAttachments[d.id],delete this.managedAttachments[d.id],s},f}(t.BasicObject)}.call(this),function(){var a,h,v,f,d,s,p,m,e,o,i;a=t.elementContainsNode,h=t.findChildIndexOfNode,d=t.nodeIsBlockStart,s=t.nodeIsBlockStartComment,f=t.nodeIsBlockContainer,p=t.nodeIsCursorTarget,m=t.nodeIsEmptyTextNode,e=t.nodeIsTextNode,v=t.nodeIsAttachmentElement,o=t.tagName,i=t.walkTree,t.LocationMapper=function(){function r(l){this.element=l}var c,u,y,n;return r.prototype.findLocationFromContainerAndOffset=function(l,g,w){var b,A,C,S,I,P,N;for(P=(w??{strict:!0}).strict,A=0,C=!1,S={index:0,offset:0},(b=this.findAttachmentElementParentForNode(l))&&(l=b.parentNode,g=h(b)),N=i(this.element,{usingFilter:y});N.nextNode();){if(I=N.currentNode,I===l&&e(l)){p(I)||(S.offset+=g);break}if(I.parentNode===l){if(A++===g)break}else if(!a(l,I)&&A>0)break;d(I,{strict:P})?(C&&S.index++,S.offset=0,C=!0):S.offset+=u(I)}return S},r.prototype.findContainerAndOffsetFromLocation=function(l){var g,w,b,A,C;if(l.index===0&&l.offset===0){for(g=this.element,A=0;g.firstChild;)if(g=g.firstChild,f(g)){A=1;break}return[g,A]}if(C=this.findNodeAndOffsetFromLocation(l),w=C[0],b=C[1],w){if(e(w))u(w)===0?(g=w.parentNode.parentNode,A=h(w.parentNode),p(w,{name:"right"})&&A++):(g=w,A=l.offset-b);else{if(g=w.parentNode,!d(w.previousSibling)&&!f(g))for(;w===g.lastChild&&(w=g,g=g.parentNode,!f(g)););A=h(w),l.offset!==0&&A++}return[g,A]}},r.prototype.findNodeAndOffsetFromLocation=function(l){var g,w,b,A,C,S,I,P;for(I=0,P=this.getSignificantNodesForIndex(l.index),w=0,b=P.length;b>w;w++){if(g=P[w],A=u(g),l.offset<=I+A)if(e(g)){if(C=g,S=I,l.offset===S&&p(C))break}else C||(C=g,S=I);if(I+=A,I>l.offset)break}return[C,S]},r.prototype.findAttachmentElementParentForNode=function(l){for(;l&&l!==this.element;){if(v(l))return l;l=l.parentNode}},r.prototype.getSignificantNodesForIndex=function(l){var g,w,b,A,C;for(b=[],C=i(this.element,{usingFilter:c}),A=!1;C.nextNode();)if(w=C.currentNode,s(w)){if(typeof g!="undefined"&&g!==null?g++:g=0,g===l)A=!0;else if(A)break}else A&&b.push(w);return b},u=function(l){var g;return l.nodeType===Node.TEXT_NODE?p(l)?0:(g=l.textContent,g.length):o(l)==="br"||v(l)?1:0},c=function(l){return n(l)===NodeFilter.FILTER_ACCEPT?y(l):NodeFilter.FILTER_REJECT},n=function(l){return m(l)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},y=function(l){return v(l.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},r}()}.call(this),function(){var a,h,v=[].slice;a=t.getDOMRange,h=t.setDOMRange,t.PointMapper=function(){function f(){}return f.prototype.createDOMRangeFromPoint=function(d){var s,p,m,e,o,i,r,c;if(r=d.x,c=d.y,document.caretPositionFromPoint)return o=document.caretPositionFromPoint(r,c),m=o.offsetNode,p=o.offset,s=document.createRange(),s.setStart(m,p),s;if(document.caretRangeFromPoint)return document.caretRangeFromPoint(r,c);if(document.body.createTextRange){e=a();try{i=document.body.createTextRange(),i.moveToPoint(r,c),i.select()}catch{}return s=a(),h(e),s}},f.prototype.getClientRectsForDOMRange=function(d){var s,p,m;return p=v.call(d.getClientRects()),m=p[0],s=p[p.length-1],[m,s]},f}()}.call(this),function(){var a,h=function(s,p){return function(){return s.apply(p,arguments)}},v=function(s,p){function m(){this.constructor=s}for(var e in p)f.call(p,e)&&(s[e]=p[e]);return m.prototype=p.prototype,s.prototype=new m,s.__super__=p.prototype,s},f={}.hasOwnProperty,d=[].indexOf||function(s){for(var p=0,m=this.length;m>p;p++)if(p in this&&this[p]===s)return p;return-1};a=t.getDOMRange,t.SelectionChangeObserver=function(s){function p(){this.run=h(this.run,this),this.update=h(this.update,this),this.selectionManagers=[]}var m;return v(p,s),p.prototype.start=function(){return this.started?void 0:(this.started=!0,"onselectionchange"in document?document.addEventListener("selectionchange",this.update,!0):this.run())},p.prototype.stop=function(){return this.started?(this.started=!1,document.removeEventListener("selectionchange",this.update,!0)):void 0},p.prototype.registerSelectionManager=function(e){return d.call(this.selectionManagers,e)<0?(this.selectionManagers.push(e),this.start()):void 0},p.prototype.unregisterSelectionManager=function(e){var o;return this.selectionManagers=function(){var i,r,c,u;for(c=this.selectionManagers,u=[],i=0,r=c.length;r>i;i++)o=c[i],o!==e&&u.push(o);return u}.call(this),this.selectionManagers.length===0?this.stop():void 0},p.prototype.notifySelectionManagersOfSelectionChange=function(){var e,o,i,r,c;for(i=this.selectionManagers,r=[],e=0,o=i.length;o>e;e++)c=i[e],r.push(c.selectionDidChange());return r},p.prototype.update=function(){var e;return e=a(),m(e,this.domRange)?void 0:(this.domRange=e,this.notifySelectionManagersOfSelectionChange())},p.prototype.reset=function(){return this.domRange=null,this.update()},p.prototype.run=function(){return this.started?(this.update(),requestAnimationFrame(this.run)):void 0},m=function(e,o){return(e!=null?e.startContainer:void 0)===(o!=null?o.startContainer:void 0)&&(e!=null?e.startOffset:void 0)===(o!=null?o.startOffset:void 0)&&(e!=null?e.endContainer:void 0)===(o!=null?o.endContainer:void 0)&&(e!=null?e.endOffset:void 0)===(o!=null?o.endOffset:void 0)},p}(t.BasicObject),t.selectionChangeObserver==null&&(t.selectionChangeObserver=new t.SelectionChangeObserver)}.call(this),function(){var a,h,v,f,d,s,p,m,e,o,i=function(u,y){return function(){return u.apply(y,arguments)}},r=function(u,y){function n(){this.constructor=u}for(var l in y)c.call(y,l)&&(u[l]=y[l]);return n.prototype=y.prototype,u.prototype=new n,u.__super__=y.prototype,u},c={}.hasOwnProperty;v=t.getDOMSelection,h=t.getDOMRange,o=t.setDOMRange,a=t.elementContainsNode,s=t.nodeIsCursorTarget,d=t.innerElementIsActive,f=t.handleEvent,p=t.normalizeRange,m=t.rangeIsCollapsed,e=t.rangesAreEqual,t.SelectionManager=function(u){function y(n){this.element=n,this.selectionDidChange=i(this.selectionDidChange,this),this.didMouseDown=i(this.didMouseDown,this),this.locationMapper=new t.LocationMapper(this.element),this.pointMapper=new t.PointMapper,this.lockCount=0,f("mousedown",{onElement:this.element,withCallback:this.didMouseDown})}return r(y,u),y.prototype.getLocationRange=function(n){var l,g;return n==null&&(n={}),l=n.strict===!1?this.createLocationRangeFromDOMRange(h(),{strict:!1}):n.ignoreLock?this.currentLocationRange:(g=this.lockedLocationRange)!=null?g:this.currentLocationRange},y.prototype.setLocationRange=function(n){var l;if(!this.lockedLocationRange)return n=p(n),(l=this.createDOMRangeFromLocationRange(n))?(o(l),this.updateCurrentLocationRange(n)):void 0},y.prototype.setLocationRangeFromPointRange=function(n){var l,g;return n=p(n),g=this.getLocationAtPoint(n[0]),l=this.getLocationAtPoint(n[1]),this.setLocationRange([g,l])},y.prototype.getClientRectAtLocationRange=function(n){var l;return(l=this.createDOMRangeFromLocationRange(n))?this.getClientRectsForDOMRange(l)[1]:void 0},y.prototype.locationIsCursorTarget=function(n){var l,g,w;return w=this.findNodeAndOffsetFromLocation(n),l=w[0],g=w[1],s(l)},y.prototype.lock=function(){return this.lockCount++==0?(this.updateCurrentLocationRange(),this.lockedLocationRange=this.getLocationRange()):void 0},y.prototype.unlock=function(){var n;return--this.lockCount==0&&(n=this.lockedLocationRange,this.lockedLocationRange=null,n!=null)?this.setLocationRange(n):void 0},y.prototype.clearSelection=function(){var n;return(n=v())!=null?n.removeAllRanges():void 0},y.prototype.selectionIsCollapsed=function(){var n;return((n=h())!=null?n.collapsed:void 0)===!0},y.prototype.selectionIsExpanded=function(){return!this.selectionIsCollapsed()},y.prototype.createLocationRangeFromDOMRange=function(n,l){var g,w;if(n!=null&&this.domRangeWithinElement(n)&&(w=this.findLocationFromContainerAndOffset(n.startContainer,n.startOffset,l)))return n.collapsed||(g=this.findLocationFromContainerAndOffset(n.endContainer,n.endOffset,l)),p([w,g])},y.proxyMethod("locationMapper.findLocationFromContainerAndOffset"),y.proxyMethod("locationMapper.findContainerAndOffsetFromLocation"),y.proxyMethod("locationMapper.findNodeAndOffsetFromLocation"),y.proxyMethod("pointMapper.createDOMRangeFromPoint"),y.proxyMethod("pointMapper.getClientRectsForDOMRange"),y.prototype.didMouseDown=function(){return this.pauseTemporarily()},y.prototype.pauseTemporarily=function(){var n,l,g,w;return this.paused=!0,l=function(b){return function(){var A,C,S;for(b.paused=!1,clearTimeout(w),C=0,S=g.length;S>C;C++)A=g[C],A.destroy();return a(document,b.element)?b.selectionDidChange():void 0}}(this),w=setTimeout(l,200),g=function(){var b,A,C,S;for(C=["mousemove","keydown"],S=[],b=0,A=C.length;A>b;b++)n=C[b],S.push(f(n,{onElement:document,withCallback:l}));return S}()},y.prototype.selectionDidChange=function(){return this.paused||d(this.element)?void 0:this.updateCurrentLocationRange()},y.prototype.updateCurrentLocationRange=function(n){var l;return(n??(n=this.createLocationRangeFromDOMRange(h())))&&!e(n,this.currentLocationRange)?(this.currentLocationRange=n,(l=this.delegate)!=null&&typeof l.locationRangeDidChange=="function"?l.locationRangeDidChange(this.currentLocationRange.slice(0)):void 0):void 0},y.prototype.createDOMRangeFromLocationRange=function(n){var l,g,w,b;return w=this.findContainerAndOffsetFromLocation(n[0]),g=m(n)?w:(b=this.findContainerAndOffsetFromLocation(n[1]))!=null?b:w,w!=null&&g!=null?(l=document.createRange(),l.setStart.apply(l,w),l.setEnd.apply(l,g),l):void 0},y.prototype.getLocationAtPoint=function(n){var l,g;return(l=this.createDOMRangeFromPoint(n))&&(g=this.createLocationRangeFromDOMRange(l))!=null?g[0]:void 0},y.prototype.domRangeWithinElement=function(n){return n.collapsed?a(this.element,n.startContainer):a(this.element,n.startContainer)&&a(this.element,n.endContainer)},y}(t.BasicObject)}.call(this),function(){var a,h,v,f,d=function(m,e){function o(){this.constructor=m}for(var i in e)s.call(e,i)&&(m[i]=e[i]);return o.prototype=e.prototype,m.prototype=new o,m.__super__=e.prototype,m},s={}.hasOwnProperty,p=[].slice;v=t.rangeIsCollapsed,f=t.rangesAreEqual,h=t.objectsAreEqual,a=t.getBlockConfig,t.EditorController=function(m){function e(i){var r,c;this.editorElement=i.editorElement,r=i.document,c=i.html,this.selectionManager=new t.SelectionManager(this.editorElement),this.selectionManager.delegate=this,this.composition=new t.Composition,this.composition.delegate=this,this.attachmentManager=new t.AttachmentManager(this.composition.getAttachments()),this.attachmentManager.delegate=this,this.inputController=new t["Level"+t.config.input.getLevel()+"InputController"](this.editorElement),this.inputController.delegate=this,this.inputController.responder=this.composition,this.compositionController=new t.CompositionController(this.editorElement,this.composition),this.compositionController.delegate=this,this.toolbarController=new t.ToolbarController(this.editorElement.toolbarElement),this.toolbarController.delegate=this,this.editor=new t.Editor(this.composition,this.selectionManager,this.editorElement),r!=null?this.editor.loadDocument(r):this.editor.loadHTML(c)}var o;return d(e,m),e.prototype.registerSelectionManager=function(){return t.selectionChangeObserver.registerSelectionManager(this.selectionManager)},e.prototype.unregisterSelectionManager=function(){return t.selectionChangeObserver.unregisterSelectionManager(this.selectionManager)},e.prototype.render=function(){return this.compositionController.render()},e.prototype.reparse=function(){return this.composition.replaceHTML(this.editorElement.innerHTML)},e.prototype.compositionDidChangeDocument=function(){return this.notifyEditorElement("document-change"),this.handlingInput?void 0:this.render()},e.prototype.compositionDidChangeCurrentAttributes=function(i){return this.currentAttributes=i,this.toolbarController.updateAttributes(this.currentAttributes),this.updateCurrentActions(),this.notifyEditorElement("attributes-change",{attributes:this.currentAttributes})},e.prototype.compositionDidPerformInsertionAtRange=function(i){return this.pasting?this.pastedRange=i:void 0},e.prototype.compositionShouldAcceptFile=function(i){return this.notifyEditorElement("file-accept",{file:i})},e.prototype.compositionDidAddAttachment=function(i){var r;return r=this.attachmentManager.manageAttachment(i),this.notifyEditorElement("attachment-add",{attachment:r})},e.prototype.compositionDidEditAttachment=function(i){var r;return this.compositionController.rerenderViewForObject(i),r=this.attachmentManager.manageAttachment(i),this.notifyEditorElement("attachment-edit",{attachment:r}),this.notifyEditorElement("change")},e.prototype.compositionDidChangeAttachmentPreviewURL=function(i){return this.compositionController.invalidateViewForObject(i),this.notifyEditorElement("change")},e.prototype.compositionDidRemoveAttachment=function(i){var r;return r=this.attachmentManager.unmanageAttachment(i),this.notifyEditorElement("attachment-remove",{attachment:r})},e.prototype.compositionDidStartEditingAttachment=function(i,r){return this.attachmentLocationRange=this.composition.document.getLocationRangeOfAttachment(i),this.compositionController.installAttachmentEditorForAttachment(i,r),this.selectionManager.setLocationRange(this.attachmentLocationRange)},e.prototype.compositionDidStopEditingAttachment=function(){return this.compositionController.uninstallAttachmentEditor(),this.attachmentLocationRange=null},e.prototype.compositionDidRequestChangingSelectionToLocationRange=function(i){return!this.loadingSnapshot||this.isFocused()?(this.requestedLocationRange=i,this.compositionRevisionWhenLocationRangeRequested=this.composition.revision,this.handlingInput?void 0:this.render()):void 0},e.prototype.compositionWillLoadSnapshot=function(){return this.loadingSnapshot=!0},e.prototype.compositionDidLoadSnapshot=function(){return this.compositionController.refreshViewCache(),this.render(),this.loadingSnapshot=!1},e.prototype.getSelectionManager=function(){return this.selectionManager},e.proxyMethod("getSelectionManager().setLocationRange"),e.proxyMethod("getSelectionManager().getLocationRange"),e.prototype.attachmentManagerDidRequestRemovalOfAttachment=function(i){return this.removeAttachment(i)},e.prototype.compositionControllerWillSyncDocumentView=function(){return this.inputController.editorWillSyncDocumentView(),this.selectionManager.lock(),this.selectionManager.clearSelection()},e.prototype.compositionControllerDidSyncDocumentView=function(){return this.inputController.editorDidSyncDocumentView(),this.selectionManager.unlock(),this.updateCurrentActions(),this.notifyEditorElement("sync")},e.prototype.compositionControllerDidRender=function(){return this.requestedLocationRange!=null&&(this.compositionRevisionWhenLocationRangeRequested===this.composition.revision&&this.selectionManager.setLocationRange(this.requestedLocationRange),this.requestedLocationRange=null,this.compositionRevisionWhenLocationRangeRequested=null),this.renderedCompositionRevision!==this.composition.revision&&(this.runEditorFilters(),this.composition.updateCurrentAttributes(),this.notifyEditorElement("render")),this.renderedCompositionRevision=this.composition.revision},e.prototype.compositionControllerDidFocus=function(){return this.isFocusedInvisibly()&&this.setLocationRange({index:0,offset:0}),this.toolbarController.hideDialog(),this.notifyEditorElement("focus")},e.prototype.compositionControllerDidBlur=function(){return this.notifyEditorElement("blur")},e.prototype.compositionControllerDidSelectAttachment=function(i,r){return this.toolbarController.hideDialog(),this.composition.editAttachment(i,r)},e.prototype.compositionControllerDidRequestDeselectingAttachment=function(i){var r,c;return r=(c=this.attachmentLocationRange)!=null?c:this.composition.document.getLocationRangeOfAttachment(i),this.selectionManager.setLocationRange(r[1])},e.prototype.compositionControllerWillUpdateAttachment=function(i){return this.editor.recordUndoEntry("Edit Attachment",{context:i.id,consolidatable:!0})},e.prototype.compositionControllerDidRequestRemovalOfAttachment=function(i){return this.removeAttachment(i)},e.prototype.inputControllerWillHandleInput=function(){return this.handlingInput=!0,this.requestedRender=!1},e.prototype.inputControllerDidRequestRender=function(){return this.requestedRender=!0},e.prototype.inputControllerDidHandleInput=function(){return this.handlingInput=!1,this.requestedRender?(this.requestedRender=!1,this.render()):void 0},e.prototype.inputControllerDidAllowUnhandledInput=function(){return this.notifyEditorElement("change")},e.prototype.inputControllerDidRequestReparse=function(){return this.reparse()},e.prototype.inputControllerWillPerformTyping=function(){return this.recordTypingUndoEntry()},e.prototype.inputControllerWillPerformFormatting=function(i){return this.recordFormattingUndoEntry(i)},e.prototype.inputControllerWillCutText=function(){return this.editor.recordUndoEntry("Cut")},e.prototype.inputControllerWillPaste=function(i){return this.editor.recordUndoEntry("Paste"),this.pasting=!0,this.notifyEditorElement("before-paste",{paste:i})},e.prototype.inputControllerDidPaste=function(i){return i.range=this.pastedRange,this.pastedRange=null,this.pasting=null,this.notifyEditorElement("paste",{paste:i})},e.prototype.inputControllerWillMoveText=function(){return this.editor.recordUndoEntry("Move")},e.prototype.inputControllerWillAttachFiles=function(){return this.editor.recordUndoEntry("Drop Files")},e.prototype.inputControllerWillPerformUndo=function(){return this.editor.undo()},e.prototype.inputControllerWillPerformRedo=function(){return this.editor.redo()},e.prototype.inputControllerDidReceiveKeyboardCommand=function(i){return this.toolbarController.applyKeyboardCommand(i)},e.prototype.inputControllerDidStartDrag=function(){return this.locationRangeBeforeDrag=this.selectionManager.getLocationRange()},e.prototype.inputControllerDidReceiveDragOverPoint=function(i){return this.selectionManager.setLocationRangeFromPointRange(i)},e.prototype.inputControllerDidCancelDrag=function(){return this.selectionManager.setLocationRange(this.locationRangeBeforeDrag),this.locationRangeBeforeDrag=null},e.prototype.locationRangeDidChange=function(i){return this.composition.updateCurrentAttributes(),this.updateCurrentActions(),this.attachmentLocationRange&&!f(this.attachmentLocationRange,i)&&this.composition.stopEditingAttachment(),this.notifyEditorElement("selection-change")},e.prototype.toolbarDidClickButton=function(){return this.getLocationRange()?void 0:this.setLocationRange({index:0,offset:0})},e.prototype.toolbarDidInvokeAction=function(i){return this.invokeAction(i)},e.prototype.toolbarDidToggleAttribute=function(i){return this.recordFormattingUndoEntry(i),this.composition.toggleCurrentAttribute(i),this.render(),this.selectionFrozen?void 0:this.editorElement.focus()},e.prototype.toolbarDidUpdateAttribute=function(i,r){return this.recordFormattingUndoEntry(i),this.composition.setCurrentAttribute(i,r),this.render(),this.selectionFrozen?void 0:this.editorElement.focus()},e.prototype.toolbarDidRemoveAttribute=function(i){return this.recordFormattingUndoEntry(i),this.composition.removeCurrentAttribute(i),this.render(),this.selectionFrozen?void 0:this.editorElement.focus()},e.prototype.toolbarWillShowDialog=function(){return this.composition.expandSelectionForEditing(),this.freezeSelection()},e.prototype.toolbarDidShowDialog=function(i){return this.notifyEditorElement("toolbar-dialog-show",{dialogName:i})},e.prototype.toolbarDidHideDialog=function(i){return this.thawSelection(),this.editorElement.focus(),this.notifyEditorElement("toolbar-dialog-hide",{dialogName:i})},e.prototype.freezeSelection=function(){return this.selectionFrozen?void 0:(this.selectionManager.lock(),this.composition.freezeSelection(),this.selectionFrozen=!0,this.render())},e.prototype.thawSelection=function(){return this.selectionFrozen?(this.composition.thawSelection(),this.selectionManager.unlock(),this.selectionFrozen=!1,this.render()):void 0},e.prototype.actions={undo:{test:function(){return this.editor.canUndo()},perform:function(){return this.editor.undo()}},redo:{test:function(){return this.editor.canRedo()},perform:function(){return this.editor.redo()}},link:{test:function(){return this.editor.canActivateAttribute("href")}},increaseNestingLevel:{test:function(){return this.editor.canIncreaseNestingLevel()},perform:function(){return this.editor.increaseNestingLevel()&&this.render()}},decreaseNestingLevel:{test:function(){return this.editor.canDecreaseNestingLevel()},perform:function(){return this.editor.decreaseNestingLevel()&&this.render()}},attachFiles:{test:function(){return!0},perform:function(){return t.config.input.pickFiles(this.editor.insertFiles)}}},e.prototype.canInvokeAction=function(i){var r,c;return this.actionIsExternal(i)?!0:!!((r=this.actions[i])!=null&&(c=r.test)!=null?c.call(this):void 0)},e.prototype.invokeAction=function(i){var r,c;return this.actionIsExternal(i)?this.notifyEditorElement("action-invoke",{actionName:i}):(r=this.actions[i])!=null&&(c=r.perform)!=null?c.call(this):void 0},e.prototype.actionIsExternal=function(i){return/^x-./.test(i)},e.prototype.getCurrentActions=function(){var i,r;r={};for(i in this.actions)r[i]=this.canInvokeAction(i);return r},e.prototype.updateCurrentActions=function(){var i;return i=this.getCurrentActions(),h(i,this.currentActions)?void 0:(this.currentActions=i,this.toolbarController.updateActions(this.currentActions),this.notifyEditorElement("actions-change",{actions:this.currentActions}))},e.prototype.runEditorFilters=function(){var i,r,c,u,y,n,l,g;for(g=this.composition.getSnapshot(),y=this.editor.filters,c=0,u=y.length;u>c;c++)r=y[c],i=g.document,l=g.selectedRange,g=(n=r.call(this.editor,g))!=null?n:{},g.document==null&&(g.document=i),g.selectedRange==null&&(g.selectedRange=l);return o(g,this.composition.getSnapshot())?void 0:this.composition.loadSnapshot(g)},o=function(i,r){return f(i.selectedRange,r.selectedRange)&&i.document.isEqualTo(r.document)},e.prototype.updateInputElement=function(){var i,r;return i=this.compositionController.getSerializableElement(),r=t.serializeToContentType(i,"text/html"),this.editorElement.setInputElementValue(r)},e.prototype.notifyEditorElement=function(i,r){switch(i){case"document-change":this.documentChangedSinceLastRender=!0;break;case"render":this.documentChangedSinceLastRender&&(this.documentChangedSinceLastRender=!1,this.notifyEditorElement("change"));break;case"change":case"attachment-add":case"attachment-edit":case"attachment-remove":this.updateInputElement()}return this.editorElement.notify(i,r)},e.prototype.removeAttachment=function(i){return this.editor.recordUndoEntry("Delete Attachment"),this.composition.removeAttachment(i),this.render()},e.prototype.recordFormattingUndoEntry=function(i){var r,c;return r=a(i),c=this.selectionManager.getLocationRange(),r||!v(c)?this.editor.recordUndoEntry("Formatting",{context:this.getUndoContext(),consolidatable:!0}):void 0},e.prototype.recordTypingUndoEntry=function(){return this.editor.recordUndoEntry("Typing",{context:this.getUndoContext(this.currentAttributes),consolidatable:!0})},e.prototype.getUndoContext=function(){var i;return i=1<=arguments.length?p.call(arguments,0):[],[this.getLocationContext(),this.getTimeContext()].concat(p.call(i))},e.prototype.getLocationContext=function(){var i;return i=this.selectionManager.getLocationRange(),v(i)?i[0].index:i},e.prototype.getTimeContext=function(){return t.config.undoInterval>0?Math.floor(new Date().getTime()/t.config.undoInterval):0},e.prototype.isFocused=function(){var i;return this.editorElement===((i=this.editorElement.ownerDocument)!=null?i.activeElement:void 0)},e.prototype.isFocusedInvisibly=function(){return this.isFocused()&&!this.getLocationRange()},e}(t.Controller)}.call(this),function(){var a,h,v,f,d,s,p,m=[].indexOf||function(e){for(var o=0,i=this.length;i>o;o++)if(o in this&&this[o]===e)return o;return-1};h=t.browser,s=t.makeElement,p=t.triggerEvent,f=t.handleEvent,d=t.handleEventOnce,v=t.findClosestElementFromNode,a=t.AttachmentView.attachmentSelector,t.registerElement("trix-editor",function(){var e,o,i,r,c,u,y,n,l;return y=0,o=function(g){return!document.querySelector(":focus")&&g.hasAttribute("autofocus")&&document.querySelector("[autofocus]")===g?g.focus():void 0},n=function(g){return g.hasAttribute("contenteditable")?void 0:(g.setAttribute("contenteditable",""),d("focus",{onElement:g,withCallback:function(){return i(g)}}))},i=function(g){return c(g),l(g)},c=function(g){return(typeof document.queryCommandSupported=="function"?document.queryCommandSupported("enableObjectResizing"):void 0)?(document.execCommand("enableObjectResizing",!1,!1),f("mscontrolselect",{onElement:g,preventDefault:!0})):void 0},l=function(){var g;return(typeof document.queryCommandSupported=="function"?document.queryCommandSupported("DefaultParagraphSeparator"):void 0)&&(g=t.config.blockAttributes.default.tagName,g==="div"||g==="p")?document.execCommand("DefaultParagraphSeparator",!1,g):void 0},e=function(g){return g.hasAttribute("role")?void 0:g.setAttribute("role","textbox")},u=function(g){var w;if(!g.hasAttribute("aria-label")&&!g.hasAttribute("aria-labelledby"))return(w=function(){var b,A,C;return C=function(){var S,I,P,N;for(P=g.labels,N=[],S=0,I=P.length;I>S;S++)b=P[S],b.contains(g)||N.push(b.textContent);return N}(),(A=C.join(" "))?g.setAttribute("aria-label",A):g.removeAttribute("aria-label")})(),f("focus",{onElement:g,withCallback:w})},r=function(){return h.forcesObjectResizing?{display:"inline",width:"auto"}:{display:"inline-block",width:"1px"}}(),{defaultCSS:`%t {
  display: block;
}

%t:empty:not(:focus)::before {
  content: attr(placeholder);
  color: graytext;
  cursor: text;
  pointer-events: none;
}

%t a[contenteditable=false] {
  cursor: text;
}

%t img {
  max-width: 100%;
  height: auto;
}

%t `+a+` figcaption textarea {
  resize: none;
}

%t `+a+` figcaption textarea.trix-autoresize-clone {
  position: absolute;
  left: -9999px;
  max-height: 0px;
}

%t `+a+` figcaption[data-trix-placeholder]:empty::before {
  content: attr(data-trix-placeholder);
  color: graytext;
}

%t [data-trix-cursor-target] {
  display: `+r.display+` !important;
  width: `+r.width+` !important;
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
}

%t [data-trix-cursor-target=left] {
  vertical-align: top !important;
  margin-left: -1px !important;
}

%t [data-trix-cursor-target=right] {
  vertical-align: bottom !important;
  margin-right: -1px !important;
}`,trixId:{get:function(){return this.hasAttribute("trix-id")?this.getAttribute("trix-id"):(this.setAttribute("trix-id",++y),this.trixId)}},labels:{get:function(){var g,w,b;return w=[],this.id&&this.ownerDocument&&w.push.apply(w,this.ownerDocument.querySelectorAll("label[for='"+this.id+"']")),(g=v(this,{matchingSelector:"label"}))&&((b=g.control)===this||b===null)&&w.push(g),w}},toolbarElement:{get:function(){var g,w,b;return this.hasAttribute("toolbar")?(w=this.ownerDocument)!=null?w.getElementById(this.getAttribute("toolbar")):void 0:this.parentNode?(b="trix-toolbar-"+this.trixId,this.setAttribute("toolbar",b),g=s("trix-toolbar",{id:b}),this.parentNode.insertBefore(g,this),g):void 0}},inputElement:{get:function(){var g,w,b;return this.hasAttribute("input")?(b=this.ownerDocument)!=null?b.getElementById(this.getAttribute("input")):void 0:this.parentNode?(w="trix-input-"+this.trixId,this.setAttribute("input",w),g=s("input",{type:"hidden",id:w}),this.parentNode.insertBefore(g,this.nextElementSibling),g):void 0}},editor:{get:function(){var g;return(g=this.editorController)!=null?g.editor:void 0}},name:{get:function(){var g;return(g=this.inputElement)!=null?g.name:void 0}},value:{get:function(){var g;return(g=this.inputElement)!=null?g.value:void 0},set:function(g){var w;return this.defaultValue=g,(w=this.editor)!=null?w.loadHTML(this.defaultValue):void 0}},notify:function(g,w){return this.editorController?p("trix-"+g,{onElement:this,attributes:w}):void 0},setInputElementValue:function(g){var w;return(w=this.inputElement)!=null?w.value=g:void 0},initialize:function(){return this.hasAttribute("data-trix-internal")?void 0:(n(this),e(this),u(this))},connect:function(){return this.hasAttribute("data-trix-internal")?void 0:(this.editorController||(p("trix-before-initialize",{onElement:this}),this.editorController=new t.EditorController({editorElement:this,html:this.defaultValue=this.value}),requestAnimationFrame(function(g){return function(){return p("trix-initialize",{onElement:g})}}(this))),this.editorController.registerSelectionManager(),this.registerResetListener(),this.registerClickListener(),o(this))},disconnect:function(){var g;return(g=this.editorController)!=null&&g.unregisterSelectionManager(),this.unregisterResetListener(),this.unregisterClickListener()},registerResetListener:function(){return this.resetListener=this.resetBubbled.bind(this),window.addEventListener("reset",this.resetListener,!1)},unregisterResetListener:function(){return window.removeEventListener("reset",this.resetListener,!1)},registerClickListener:function(){return this.clickListener=this.clickBubbled.bind(this),window.addEventListener("click",this.clickListener,!1)},unregisterClickListener:function(){return window.removeEventListener("click",this.clickListener,!1)},resetBubbled:function(g){var w;if(!g.defaultPrevented&&g.target===((w=this.inputElement)!=null?w.form:void 0))return this.reset()},clickBubbled:function(g){var w;if(!(g.defaultPrevented||this.contains(g.target)||!(w=v(g.target,{matchingSelector:"label"}))||m.call(this.labels,w)<0))return this.focus()},reset:function(){return this.value=this.defaultValue}}}())}.call(this),function(){}.call(this)}).call(this),typeof at=="object"&&at.exports?at.exports=t:typeof define=="function"&&define.amd&&define(t)}.call(st)});var Wt=St(jt()),Tt=class{constructor(t,a){this.attachment=t,this.element=a,this.directUpload=new Wt.DirectUpload(t.file,this.directUploadUrl,this)}start(){this.directUpload.create(this.directUploadDidComplete.bind(this))}directUploadWillStoreFileWithXHR(t){t.upload.addEventListener("progress",a=>{let h=a.loaded/a.total*100;this.attachment.setUploadProgress(h)})}directUploadDidComplete(t,a){if(t)throw new Error(`Direct upload failed: ${t}`);this.attachment.setAttributes({sgid:a.attachable_sgid,url:this.createBlobUrl(a.signed_id,a.filename)})}createBlobUrl(t,a){return this.blobUrlTemplate.replace(":signed_id",t).replace(":filename",encodeURIComponent(a))}get directUploadUrl(){return this.element.dataset.directUploadUrl}get blobUrlTemplate(){return this.element.dataset.blobUrlTemplate}};addEventListener("trix-attachment-add",E=>{let{attachment:t,target:a}=E;t.file&&new Tt(t,a).start()});var Ut=class{constructor(t,a,h){this.eventTarget=t,this.eventName=a,this.eventOptions=h,this.unorderedBindings=new Set}connect(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}disconnect(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}bindingConnected(t){this.unorderedBindings.add(t)}bindingDisconnected(t){this.unorderedBindings.delete(t)}handleEvent(t){let a=Re(t);for(let h of this.bindings){if(a.immediatePropagationStopped)break;h.handleEvent(a)}}get bindings(){return Array.from(this.unorderedBindings).sort((t,a)=>{let h=t.index,v=a.index;return h<v?-1:h>v?1:0})}};function Re(E){if("immediatePropagationStopped"in E)return E;{let{stopImmediatePropagation:t}=E;return Object.assign(E,{immediatePropagationStopped:!1,stopImmediatePropagation(){this.immediatePropagationStopped=!0,t.call(this)}})}}var Vt=class{constructor(t){this.application=t,this.eventListenerMaps=new Map,this.started=!1}start(){this.started||(this.started=!0,this.eventListeners.forEach(t=>t.connect()))}stop(){this.started&&(this.started=!1,this.eventListeners.forEach(t=>t.disconnect()))}get eventListeners(){return Array.from(this.eventListenerMaps.values()).reduce((t,a)=>t.concat(Array.from(a.values())),[])}bindingConnected(t){this.fetchEventListenerForBinding(t).bindingConnected(t)}bindingDisconnected(t){this.fetchEventListenerForBinding(t).bindingDisconnected(t)}handleError(t,a,h={}){this.application.handleError(t,`Error ${a}`,h)}fetchEventListenerForBinding(t){let{eventTarget:a,eventName:h,eventOptions:v}=t;return this.fetchEventListener(a,h,v)}fetchEventListener(t,a,h){let v=this.fetchEventListenerMapForEventTarget(t),f=this.cacheKey(a,h),d=v.get(f);return d||(d=this.createEventListener(t,a,h),v.set(f,d)),d}createEventListener(t,a,h){let v=new Ut(t,a,h);return this.started&&v.connect(),v}fetchEventListenerMapForEventTarget(t){let a=this.eventListenerMaps.get(t);return a||(a=new Map,this.eventListenerMaps.set(t,a)),a}cacheKey(t,a){let h=[t];return Object.keys(a).sort().forEach(v=>{h.push(`${a[v]?"":"!"}${v}`)}),h.join(":")}},Oe=/^((.+?)(@(window|document))?->)?(.+?)(#([^:]+?))(:(.+))?$/;function Ne(E){let a=E.trim().match(Oe)||[];return{eventTarget:Me(a[4]),eventName:a[2],eventOptions:a[9]?Be(a[9]):{},identifier:a[5],methodName:a[7]}}function Me(E){if(E=="window")return window;if(E=="document")return document}function Be(E){return E.split(":").reduce((t,a)=>Object.assign(t,{[a.replace(/^!/,"")]:!/^!/.test(a)}),{})}function Ie(E){if(E==window)return"window";if(E==document)return"document"}function qt(E){return E.replace(/(?:[_-])([a-z0-9])/g,(t,a)=>a.toUpperCase())}function ft(E){return E.charAt(0).toUpperCase()+E.slice(1)}function Ht(E){return E.replace(/([A-Z])/g,(t,a)=>`-${a.toLowerCase()}`)}function _e(E){return E.match(/[^\s]+/g)||[]}var zt=class{constructor(t,a,h){this.element=t,this.index=a,this.eventTarget=h.eventTarget||t,this.eventName=h.eventName||Pe(t)||kt("missing event name"),this.eventOptions=h.eventOptions||{},this.identifier=h.identifier||kt("missing identifier"),this.methodName=h.methodName||kt("missing method name")}static forToken(t){return new this(t.element,t.index,Ne(t.content))}toString(){let t=this.eventTargetName?`@${this.eventTargetName}`:"";return`${this.eventName}${t}->${this.identifier}#${this.methodName}`}get params(){return this.eventTarget instanceof Element?this.getParamsFromEventTargetAttributes(this.eventTarget):{}}getParamsFromEventTargetAttributes(t){let a={},h=new RegExp(`^data-${this.identifier}-(.+)-param$`);return Array.from(t.attributes).forEach(({name:f,value:d})=>{let s=f.match(h),p=s&&s[1];p&&Object.assign(a,{[qt(p)]:Fe(d)})}),a}get eventTargetName(){return Ie(this.eventTarget)}},Kt={a:E=>"click",button:E=>"click",form:E=>"submit",details:E=>"toggle",input:E=>E.getAttribute("type")=="submit"?"click":"input",select:E=>"change",textarea:E=>"input"};function Pe(E){let t=E.tagName.toLowerCase();if(t in Kt)return Kt[t](E)}function kt(E){throw new Error(E)}function Fe(E){try{return JSON.parse(E)}catch{return E}}var $t=class{constructor(t,a){this.context=t,this.action=a}get index(){return this.action.index}get eventTarget(){return this.action.eventTarget}get eventOptions(){return this.action.eventOptions}get identifier(){return this.context.identifier}handleEvent(t){this.willBeInvokedByEvent(t)&&this.invokeWithEvent(t)}get eventName(){return this.action.eventName}get method(){let t=this.controller[this.methodName];if(typeof t=="function")return t;throw new Error(`Action "${this.action}" references undefined method "${this.methodName}"`)}invokeWithEvent(t){let{target:a,currentTarget:h}=t;try{let{params:v}=this.action,f=Object.assign(t,{params:v});this.method.call(this.controller,f),this.context.logDebugActivity(this.methodName,{event:t,target:a,currentTarget:h,action:this.methodName})}catch(v){let{identifier:f,controller:d,element:s,index:p}=this,m={identifier:f,controller:d,element:s,index:p,event:t};this.context.handleError(v,`invoking action "${this.action}"`,m)}}willBeInvokedByEvent(t){let a=t.target;return this.element===a?!0:a instanceof Element&&this.element.contains(a)?this.scope.containsElement(a):this.scope.containsElement(this.action.element)}get controller(){return this.context.controller}get methodName(){return this.action.methodName}get element(){return this.scope.element}get scope(){return this.context.scope}},Jt=class{constructor(t,a){this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=t,this.started=!1,this.delegate=a,this.elements=new Set,this.mutationObserver=new MutationObserver(h=>this.processMutations(h))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}pause(t){this.started&&(this.mutationObserver.disconnect(),this.started=!1),t(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started){let t=new Set(this.matchElementsInTree());for(let a of Array.from(this.elements))t.has(a)||this.removeElement(a);for(let a of Array.from(t))this.addElement(a)}}processMutations(t){if(this.started)for(let a of t)this.processMutation(a)}processMutation(t){t.type=="attributes"?this.processAttributeChange(t.target,t.attributeName):t.type=="childList"&&(this.processRemovedNodes(t.removedNodes),this.processAddedNodes(t.addedNodes))}processAttributeChange(t,a){let h=t;this.elements.has(h)?this.delegate.elementAttributeChanged&&this.matchElement(h)?this.delegate.elementAttributeChanged(h,a):this.removeElement(h):this.matchElement(h)&&this.addElement(h)}processRemovedNodes(t){for(let a of Array.from(t)){let h=this.elementFromNode(a);h&&this.processTree(h,this.removeElement)}}processAddedNodes(t){for(let a of Array.from(t)){let h=this.elementFromNode(a);h&&this.elementIsActive(h)&&this.processTree(h,this.addElement)}}matchElement(t){return this.delegate.matchElement(t)}matchElementsInTree(t=this.element){return this.delegate.matchElementsInTree(t)}processTree(t,a){for(let h of this.matchElementsInTree(t))a.call(this,h)}elementFromNode(t){if(t.nodeType==Node.ELEMENT_NODE)return t}elementIsActive(t){return t.isConnected!=this.element.isConnected?!1:this.element.contains(t)}addElement(t){this.elements.has(t)||this.elementIsActive(t)&&(this.elements.add(t),this.delegate.elementMatched&&this.delegate.elementMatched(t))}removeElement(t){this.elements.has(t)&&(this.elements.delete(t),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(t))}},Gt=class{constructor(t,a,h){this.attributeName=a,this.delegate=h,this.elementObserver=new Jt(t,this)}get element(){return this.elementObserver.element}get selector(){return`[${this.attributeName}]`}start(){this.elementObserver.start()}pause(t){this.elementObserver.pause(t)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get started(){return this.elementObserver.started}matchElement(t){return t.hasAttribute(this.attributeName)}matchElementsInTree(t){let a=this.matchElement(t)?[t]:[],h=Array.from(t.querySelectorAll(this.selector));return a.concat(h)}elementMatched(t){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(t,this.attributeName)}elementUnmatched(t){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(t,this.attributeName)}elementAttributeChanged(t,a){this.delegate.elementAttributeValueChanged&&this.attributeName==a&&this.delegate.elementAttributeValueChanged(t,a)}},Xt=class{constructor(t,a){this.element=t,this.delegate=a,this.started=!1,this.stringMap=new Map,this.mutationObserver=new MutationObserver(h=>this.processMutations(h))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,attributeOldValue:!0}),this.refresh())}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started)for(let t of this.knownAttributeNames)this.refreshAttribute(t,null)}processMutations(t){if(this.started)for(let a of t)this.processMutation(a)}processMutation(t){let a=t.attributeName;a&&this.refreshAttribute(a,t.oldValue)}refreshAttribute(t,a){let h=this.delegate.getStringMapKeyForAttribute(t);if(h!=null){this.stringMap.has(t)||this.stringMapKeyAdded(h,t);let v=this.element.getAttribute(t);if(this.stringMap.get(t)!=v&&this.stringMapValueChanged(v,h,a),v==null){let f=this.stringMap.get(t);this.stringMap.delete(t),f&&this.stringMapKeyRemoved(h,t,f)}else this.stringMap.set(t,v)}}stringMapKeyAdded(t,a){this.delegate.stringMapKeyAdded&&this.delegate.stringMapKeyAdded(t,a)}stringMapValueChanged(t,a,h){this.delegate.stringMapValueChanged&&this.delegate.stringMapValueChanged(t,a,h)}stringMapKeyRemoved(t,a,h){this.delegate.stringMapKeyRemoved&&this.delegate.stringMapKeyRemoved(t,a,h)}get knownAttributeNames(){return Array.from(new Set(this.currentAttributeNames.concat(this.recordedAttributeNames)))}get currentAttributeNames(){return Array.from(this.element.attributes).map(t=>t.name)}get recordedAttributeNames(){return Array.from(this.stringMap.keys())}};function je(E,t,a){Yt(E,t).add(a)}function We(E,t,a){Yt(E,t).delete(a),Ue(E,t)}function Yt(E,t){let a=E.get(t);return a||(a=new Set,E.set(t,a)),a}function Ue(E,t){let a=E.get(t);a!=null&&a.size==0&&E.delete(t)}var gt=class{constructor(){this.valuesByKey=new Map}get keys(){return Array.from(this.valuesByKey.keys())}get values(){return Array.from(this.valuesByKey.values()).reduce((a,h)=>a.concat(Array.from(h)),[])}get size(){return Array.from(this.valuesByKey.values()).reduce((a,h)=>a+h.size,0)}add(t,a){je(this.valuesByKey,t,a)}delete(t,a){We(this.valuesByKey,t,a)}has(t,a){let h=this.valuesByKey.get(t);return h!=null&&h.has(a)}hasKey(t){return this.valuesByKey.has(t)}hasValue(t){return Array.from(this.valuesByKey.values()).some(h=>h.has(t))}getValuesForKey(t){let a=this.valuesByKey.get(t);return a?Array.from(a):[]}getKeysForValue(t){return Array.from(this.valuesByKey).filter(([a,h])=>h.has(t)).map(([a,h])=>a)}};var Lt=class{constructor(t,a,h){this.attributeObserver=new Gt(t,a,this),this.delegate=h,this.tokensByElement=new gt}get started(){return this.attributeObserver.started}start(){this.attributeObserver.start()}pause(t){this.attributeObserver.pause(t)}stop(){this.attributeObserver.stop()}refresh(){this.attributeObserver.refresh()}get element(){return this.attributeObserver.element}get attributeName(){return this.attributeObserver.attributeName}elementMatchedAttribute(t){this.tokensMatched(this.readTokensForElement(t))}elementAttributeValueChanged(t){let[a,h]=this.refreshTokensForElement(t);this.tokensUnmatched(a),this.tokensMatched(h)}elementUnmatchedAttribute(t){this.tokensUnmatched(this.tokensByElement.getValuesForKey(t))}tokensMatched(t){t.forEach(a=>this.tokenMatched(a))}tokensUnmatched(t){t.forEach(a=>this.tokenUnmatched(a))}tokenMatched(t){this.delegate.tokenMatched(t),this.tokensByElement.add(t.element,t)}tokenUnmatched(t){this.delegate.tokenUnmatched(t),this.tokensByElement.delete(t.element,t)}refreshTokensForElement(t){let a=this.tokensByElement.getValuesForKey(t),h=this.readTokensForElement(t),v=qe(a,h).findIndex(([f,d])=>!He(f,d));return v==-1?[[],[]]:[a.slice(v),h.slice(v)]}readTokensForElement(t){let a=this.attributeName,h=t.getAttribute(a)||"";return Ve(h,t,a)}};function Ve(E,t,a){return E.trim().split(/\s+/).filter(h=>h.length).map((h,v)=>({element:t,attributeName:a,content:h,index:v}))}function qe(E,t){let a=Math.max(E.length,t.length);return Array.from({length:a},(h,v)=>[E[v],t[v]])}function He(E,t){return E&&t&&E.index==t.index&&E.content==t.content}var Dt=class{constructor(t,a,h){this.tokenListObserver=new Lt(t,a,this),this.delegate=h,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}get started(){return this.tokenListObserver.started}start(){this.tokenListObserver.start()}stop(){this.tokenListObserver.stop()}refresh(){this.tokenListObserver.refresh()}get element(){return this.tokenListObserver.element}get attributeName(){return this.tokenListObserver.attributeName}tokenMatched(t){let{element:a}=t,{value:h}=this.fetchParseResultForToken(t);h&&(this.fetchValuesByTokenForElement(a).set(t,h),this.delegate.elementMatchedValue(a,h))}tokenUnmatched(t){let{element:a}=t,{value:h}=this.fetchParseResultForToken(t);h&&(this.fetchValuesByTokenForElement(a).delete(t),this.delegate.elementUnmatchedValue(a,h))}fetchParseResultForToken(t){let a=this.parseResultsByToken.get(t);return a||(a=this.parseToken(t),this.parseResultsByToken.set(t,a)),a}fetchValuesByTokenForElement(t){let a=this.valuesByTokenByElement.get(t);return a||(a=new Map,this.valuesByTokenByElement.set(t,a)),a}parseToken(t){try{return{value:this.delegate.parseValueForToken(t)}}catch(a){return{error:a}}}},Qt=class{constructor(t,a){this.context=t,this.delegate=a,this.bindingsByAction=new Map}start(){this.valueListObserver||(this.valueListObserver=new Dt(this.element,this.actionAttribute,this),this.valueListObserver.start())}stop(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())}get element(){return this.context.element}get identifier(){return this.context.identifier}get actionAttribute(){return this.schema.actionAttribute}get schema(){return this.context.schema}get bindings(){return Array.from(this.bindingsByAction.values())}connectAction(t){let a=new $t(this.context,t);this.bindingsByAction.set(t,a),this.delegate.bindingConnected(a)}disconnectAction(t){let a=this.bindingsByAction.get(t);a&&(this.bindingsByAction.delete(t),this.delegate.bindingDisconnected(a))}disconnectAllActions(){this.bindings.forEach(t=>this.delegate.bindingDisconnected(t)),this.bindingsByAction.clear()}parseValueForToken(t){let a=zt.forToken(t);if(a.identifier==this.identifier)return a}elementMatchedValue(t,a){this.connectAction(a)}elementUnmatchedValue(t,a){this.disconnectAction(a)}},Zt=class{constructor(t,a){this.context=t,this.receiver=a,this.stringMapObserver=new Xt(this.element,this),this.valueDescriptorMap=this.controller.valueDescriptorMap,this.invokeChangedCallbacksForDefaultValues()}start(){this.stringMapObserver.start()}stop(){this.stringMapObserver.stop()}get element(){return this.context.element}get controller(){return this.context.controller}getStringMapKeyForAttribute(t){if(t in this.valueDescriptorMap)return this.valueDescriptorMap[t].name}stringMapKeyAdded(t,a){let h=this.valueDescriptorMap[a];this.hasValue(t)||this.invokeChangedCallback(t,h.writer(this.receiver[t]),h.writer(h.defaultValue))}stringMapValueChanged(t,a,h){let v=this.valueDescriptorNameMap[a];t!==null&&(h===null&&(h=v.writer(v.defaultValue)),this.invokeChangedCallback(a,t,h))}stringMapKeyRemoved(t,a,h){let v=this.valueDescriptorNameMap[t];this.hasValue(t)?this.invokeChangedCallback(t,v.writer(this.receiver[t]),h):this.invokeChangedCallback(t,v.writer(v.defaultValue),h)}invokeChangedCallbacksForDefaultValues(){for(let{key:t,name:a,defaultValue:h,writer:v}of this.valueDescriptors)h!=null&&!this.controller.data.has(t)&&this.invokeChangedCallback(a,v(h),void 0)}invokeChangedCallback(t,a,h){let v=`${t}Changed`,f=this.receiver[v];if(typeof f=="function"){let d=this.valueDescriptorNameMap[t],s=d.reader(a),p=h;h&&(p=d.reader(h)),f.call(this.receiver,s,p)}}get valueDescriptors(){let{valueDescriptorMap:t}=this;return Object.keys(t).map(a=>t[a])}get valueDescriptorNameMap(){let t={};return Object.keys(this.valueDescriptorMap).forEach(a=>{let h=this.valueDescriptorMap[a];t[h.name]=h}),t}hasValue(t){let a=this.valueDescriptorNameMap[t],h=`has${ft(a.name)}`;return this.receiver[h]}},te=class{constructor(t,a){this.context=t,this.delegate=a,this.targetsByName=new gt}start(){this.tokenListObserver||(this.tokenListObserver=new Lt(this.element,this.attributeName,this),this.tokenListObserver.start())}stop(){this.tokenListObserver&&(this.disconnectAllTargets(),this.tokenListObserver.stop(),delete this.tokenListObserver)}tokenMatched({element:t,content:a}){this.scope.containsElement(t)&&this.connectTarget(t,a)}tokenUnmatched({element:t,content:a}){this.disconnectTarget(t,a)}connectTarget(t,a){var h;this.targetsByName.has(a,t)||(this.targetsByName.add(a,t),(h=this.tokenListObserver)===null||h===void 0||h.pause(()=>this.delegate.targetConnected(t,a)))}disconnectTarget(t,a){var h;this.targetsByName.has(a,t)&&(this.targetsByName.delete(a,t),(h=this.tokenListObserver)===null||h===void 0||h.pause(()=>this.delegate.targetDisconnected(t,a)))}disconnectAllTargets(){for(let t of this.targetsByName.keys)for(let a of this.targetsByName.getValuesForKey(t))this.disconnectTarget(a,t)}get attributeName(){return`data-${this.context.identifier}-target`}get element(){return this.context.element}get scope(){return this.context.scope}},ee=class{constructor(t,a){this.logDebugActivity=(h,v={})=>{let{identifier:f,controller:d,element:s}=this;v=Object.assign({identifier:f,controller:d,element:s},v),this.application.logDebugActivity(this.identifier,h,v)},this.module=t,this.scope=a,this.controller=new t.controllerConstructor(this),this.bindingObserver=new Qt(this,this.dispatcher),this.valueObserver=new Zt(this,this.controller),this.targetObserver=new te(this,this);try{this.controller.initialize(),this.logDebugActivity("initialize")}catch(h){this.handleError(h,"initializing controller")}}connect(){this.bindingObserver.start(),this.valueObserver.start(),this.targetObserver.start();try{this.controller.connect(),this.logDebugActivity("connect")}catch(t){this.handleError(t,"connecting controller")}}disconnect(){try{this.controller.disconnect(),this.logDebugActivity("disconnect")}catch(t){this.handleError(t,"disconnecting controller")}this.targetObserver.stop(),this.valueObserver.stop(),this.bindingObserver.stop()}get application(){return this.module.application}get identifier(){return this.module.identifier}get schema(){return this.application.schema}get dispatcher(){return this.application.dispatcher}get element(){return this.scope.element}get parentElement(){return this.element.parentElement}handleError(t,a,h={}){let{identifier:v,controller:f,element:d}=this;h=Object.assign({identifier:v,controller:f,element:d},h),this.application.handleError(t,`Error ${a}`,h)}targetConnected(t,a){this.invokeControllerMethod(`${a}TargetConnected`,t)}targetDisconnected(t,a){this.invokeControllerMethod(`${a}TargetDisconnected`,t)}invokeControllerMethod(t,...a){let h=this.controller;typeof h[t]=="function"&&h[t](...a)}};function Rt(E,t){let a=ne(E);return Array.from(a.reduce((h,v)=>(Ke(v,t).forEach(f=>h.add(f)),h),new Set))}function ze(E,t){return ne(E).reduce((h,v)=>(h.push(...$e(v,t)),h),[])}function ne(E){let t=[];for(;E;)t.push(E),E=Object.getPrototypeOf(E);return t.reverse()}function Ke(E,t){let a=E[t];return Array.isArray(a)?a:[]}function $e(E,t){let a=E[t];return a?Object.keys(a).map(h=>[h,a[h]]):[]}function Je(E){return Ge(E,Xe(E))}function Ge(E,t){let a=tn(E),h=Ye(E.prototype,t);return Object.defineProperties(a.prototype,h),a}function Xe(E){return Rt(E,"blessings").reduce((a,h)=>{let v=h(E);for(let f in v){let d=a[f]||{};a[f]=Object.assign(d,v[f])}return a},{})}function Ye(E,t){return Ze(t).reduce((a,h)=>{let v=Qe(E,t,h);return v&&Object.assign(a,{[h]:v}),a},{})}function Qe(E,t,a){let h=Object.getOwnPropertyDescriptor(E,a);if(!(h&&"value"in h)){let f=Object.getOwnPropertyDescriptor(t,a).value;return h&&(f.get=h.get||f.get,f.set=h.set||f.set),f}}var Ze=(()=>typeof Object.getOwnPropertySymbols=="function"?E=>[...Object.getOwnPropertyNames(E),...Object.getOwnPropertySymbols(E)]:Object.getOwnPropertyNames)(),tn=(()=>{function E(a){function h(){return Reflect.construct(a,arguments,new.target)}return h.prototype=Object.create(a.prototype,{constructor:{value:h}}),Reflect.setPrototypeOf(h,a),h}function t(){let h=E(function(){this.a.call(this)});return h.prototype.a=function(){},new h}try{return t(),E}catch{return h=>class extends h{}}})();function en(E){return{identifier:E.identifier,controllerConstructor:Je(E.controllerConstructor)}}var ie=class{constructor(t,a){this.application=t,this.definition=en(a),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}get identifier(){return this.definition.identifier}get controllerConstructor(){return this.definition.controllerConstructor}get contexts(){return Array.from(this.connectedContexts)}connectContextForScope(t){let a=this.fetchContextForScope(t);this.connectedContexts.add(a),a.connect()}disconnectContextForScope(t){let a=this.contextsByScope.get(t);a&&(this.connectedContexts.delete(a),a.disconnect())}fetchContextForScope(t){let a=this.contextsByScope.get(t);return a||(a=new ee(this,t),this.contextsByScope.set(t,a)),a}},re=class{constructor(t){this.scope=t}has(t){return this.data.has(this.getDataKey(t))}get(t){return this.getAll(t)[0]}getAll(t){let a=this.data.get(this.getDataKey(t))||"";return _e(a)}getAttributeName(t){return this.data.getAttributeNameForKey(this.getDataKey(t))}getDataKey(t){return`${t}-class`}get data(){return this.scope.data}},oe=class{constructor(t){this.scope=t}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get(t){let a=this.getAttributeNameForKey(t);return this.element.getAttribute(a)}set(t,a){let h=this.getAttributeNameForKey(t);return this.element.setAttribute(h,a),this.get(t)}has(t){let a=this.getAttributeNameForKey(t);return this.element.hasAttribute(a)}delete(t){if(this.has(t)){let a=this.getAttributeNameForKey(t);return this.element.removeAttribute(a),!0}else return!1}getAttributeNameForKey(t){return`data-${this.identifier}-${Ht(t)}`}},se=class{constructor(t){this.warnedKeysByObject=new WeakMap,this.logger=t}warn(t,a,h){let v=this.warnedKeysByObject.get(t);v||(v=new Set,this.warnedKeysByObject.set(t,v)),v.has(a)||(v.add(a),this.logger.warn(h,t))}};function Ot(E,t){return`[${E}~="${t}"]`}var ae=class{constructor(t){this.scope=t}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(t){return this.find(t)!=null}find(...t){return t.reduce((a,h)=>a||this.findTarget(h)||this.findLegacyTarget(h),void 0)}findAll(...t){return t.reduce((a,h)=>[...a,...this.findAllTargets(h),...this.findAllLegacyTargets(h)],[])}findTarget(t){let a=this.getSelectorForTargetName(t);return this.scope.findElement(a)}findAllTargets(t){let a=this.getSelectorForTargetName(t);return this.scope.findAllElements(a)}getSelectorForTargetName(t){let a=this.schema.targetAttributeForScope(this.identifier);return Ot(a,t)}findLegacyTarget(t){let a=this.getLegacySelectorForTargetName(t);return this.deprecate(this.scope.findElement(a),t)}findAllLegacyTargets(t){let a=this.getLegacySelectorForTargetName(t);return this.scope.findAllElements(a).map(h=>this.deprecate(h,t))}getLegacySelectorForTargetName(t){let a=`${this.identifier}.${t}`;return Ot(this.schema.targetAttribute,a)}deprecate(t,a){if(t){let{identifier:h}=this,v=this.schema.targetAttribute,f=this.schema.targetAttributeForScope(h);this.guide.warn(t,`target:${a}`,`Please replace ${v}="${h}.${a}" with ${f}="${a}". The ${v} attribute is deprecated and will be removed in a future version of Stimulus.`)}return t}get guide(){return this.scope.guide}},ue=class{constructor(t,a,h,v){this.targets=new ae(this),this.classes=new re(this),this.data=new oe(this),this.containsElement=f=>f.closest(this.controllerSelector)===this.element,this.schema=t,this.element=a,this.identifier=h,this.guide=new se(v)}findElement(t){return this.element.matches(t)?this.element:this.queryElements(t).find(this.containsElement)}findAllElements(t){return[...this.element.matches(t)?[this.element]:[],...this.queryElements(t).filter(this.containsElement)]}queryElements(t){return Array.from(this.element.querySelectorAll(t))}get controllerSelector(){return Ot(this.schema.controllerAttribute,this.identifier)}},ce=class{constructor(t,a,h){this.element=t,this.schema=a,this.delegate=h,this.valueListObserver=new Dt(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}start(){this.valueListObserver.start()}stop(){this.valueListObserver.stop()}get controllerAttribute(){return this.schema.controllerAttribute}parseValueForToken(t){let{element:a,content:h}=t,v=this.fetchScopesByIdentifierForElement(a),f=v.get(h);return f||(f=this.delegate.createScopeForElementAndIdentifier(a,h),v.set(h,f)),f}elementMatchedValue(t,a){let h=(this.scopeReferenceCounts.get(a)||0)+1;this.scopeReferenceCounts.set(a,h),h==1&&this.delegate.scopeConnected(a)}elementUnmatchedValue(t,a){let h=this.scopeReferenceCounts.get(a);h&&(this.scopeReferenceCounts.set(a,h-1),h==1&&this.delegate.scopeDisconnected(a))}fetchScopesByIdentifierForElement(t){let a=this.scopesByIdentifierByElement.get(t);return a||(a=new Map,this.scopesByIdentifierByElement.set(t,a)),a}},le=class{constructor(t){this.application=t,this.scopeObserver=new ce(this.element,this.schema,this),this.scopesByIdentifier=new gt,this.modulesByIdentifier=new Map}get element(){return this.application.element}get schema(){return this.application.schema}get logger(){return this.application.logger}get controllerAttribute(){return this.schema.controllerAttribute}get modules(){return Array.from(this.modulesByIdentifier.values())}get contexts(){return this.modules.reduce((t,a)=>t.concat(a.contexts),[])}start(){this.scopeObserver.start()}stop(){this.scopeObserver.stop()}loadDefinition(t){this.unloadIdentifier(t.identifier);let a=new ie(this.application,t);this.connectModule(a)}unloadIdentifier(t){let a=this.modulesByIdentifier.get(t);a&&this.disconnectModule(a)}getContextForElementAndIdentifier(t,a){let h=this.modulesByIdentifier.get(a);if(h)return h.contexts.find(v=>v.element==t)}handleError(t,a,h){this.application.handleError(t,a,h)}createScopeForElementAndIdentifier(t,a){return new ue(this.schema,t,a,this.logger)}scopeConnected(t){this.scopesByIdentifier.add(t.identifier,t);let a=this.modulesByIdentifier.get(t.identifier);a&&a.connectContextForScope(t)}scopeDisconnected(t){this.scopesByIdentifier.delete(t.identifier,t);let a=this.modulesByIdentifier.get(t.identifier);a&&a.disconnectContextForScope(t)}connectModule(t){this.modulesByIdentifier.set(t.identifier,t),this.scopesByIdentifier.getValuesForKey(t.identifier).forEach(h=>t.connectContextForScope(h))}disconnectModule(t){this.modulesByIdentifier.delete(t.identifier),this.scopesByIdentifier.getValuesForKey(t.identifier).forEach(h=>t.disconnectContextForScope(h))}},nn={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:E=>`data-${E}-target`},lt=class{constructor(t=document.documentElement,a=nn){this.logger=console,this.debug=!1,this.logDebugActivity=(h,v,f={})=>{this.debug&&this.logFormattedMessage(h,v,f)},this.element=t,this.schema=a,this.dispatcher=new Vt(this),this.router=new le(this)}static start(t,a){let h=new lt(t,a);return h.start(),h}async start(){await rn(),this.logDebugActivity("application","starting"),this.dispatcher.start(),this.router.start(),this.logDebugActivity("application","start")}stop(){this.logDebugActivity("application","stopping"),this.dispatcher.stop(),this.router.stop(),this.logDebugActivity("application","stop")}register(t,a){a.shouldLoad&&this.load({identifier:t,controllerConstructor:a})}load(t,...a){(Array.isArray(t)?t:[t,...a]).forEach(v=>this.router.loadDefinition(v))}unload(t,...a){(Array.isArray(t)?t:[t,...a]).forEach(v=>this.router.unloadIdentifier(v))}get controllers(){return this.router.contexts.map(t=>t.controller)}getControllerForElementAndIdentifier(t,a){let h=this.router.getContextForElementAndIdentifier(t,a);return h?h.controller:null}handleError(t,a,h){var v;this.logger.error(`%s

%o

%o`,a,t,h),(v=window.onerror)===null||v===void 0||v.call(window,a,"",0,0,t)}logFormattedMessage(t,a,h={}){h=Object.assign({application:this},h),this.logger.groupCollapsed(`${t} #${a}`),this.logger.log("details:",Object.assign({},h)),this.logger.groupEnd()}};function rn(){return new Promise(E=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",()=>E()):E()})}function on(E){return Rt(E,"classes").reduce((a,h)=>Object.assign(a,sn(h)),{})}function sn(E){return{[`${E}Class`]:{get(){let{classes:t}=this;if(t.has(E))return t.get(E);{let a=t.getAttributeName(E);throw new Error(`Missing attribute "${a}"`)}}},[`${E}Classes`]:{get(){return this.classes.getAll(E)}},[`has${ft(E)}Class`]:{get(){return this.classes.has(E)}}}}function an(E){return Rt(E,"targets").reduce((a,h)=>Object.assign(a,un(h)),{})}function un(E){return{[`${E}Target`]:{get(){let t=this.targets.find(E);if(t)return t;throw new Error(`Missing target element "${E}" for "${this.identifier}" controller`)}},[`${E}Targets`]:{get(){return this.targets.findAll(E)}},[`has${ft(E)}Target`]:{get(){return this.targets.has(E)}}}}function cn(E){let t=ze(E,"values"),a={valueDescriptorMap:{get(){return t.reduce((h,v)=>{let f=he(v),d=this.data.getAttributeNameForKey(f.key);return Object.assign(h,{[d]:f})},{})}}};return t.reduce((h,v)=>Object.assign(h,ln(v)),a)}function ln(E){let t=he(E),{key:a,name:h,reader:v,writer:f}=t;return{[h]:{get(){let d=this.data.get(a);return d!==null?v(d):t.defaultValue},set(d){d===void 0?this.data.delete(a):this.data.set(a,f(d))}},[`has${ft(h)}`]:{get(){return this.data.has(a)||t.hasCustomDefaultValue}}}}function he([E,t]){return fn(E,t)}function Nt(E){switch(E){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function Mt(E){switch(typeof E){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(E))return"array";if(Object.prototype.toString.call(E)==="[object Object]")return"object"}function hn(E){let t=Nt(E.type);if(t){let a=Mt(E.default);if(t!==a)throw new Error(`Type "${t}" must match the type of the default value. Given default value: "${E.default}" as "${a}"`);return t}}function dn(E){let t=hn(E),a=Mt(E),h=Nt(E),v=t||a||h;if(v)return v;throw new Error(`Unknown value type "${E}"`)}function pn(E){let t=Nt(E);if(t)return gn[t];let a=E.default;return a!==void 0?a:E}function fn(E,t){let a=`${Ht(E)}-value`,h=dn(t);return{type:h,key:a,name:qt(a),get defaultValue(){return pn(t)},get hasCustomDefaultValue(){return Mt(t)!==void 0},reader:mn[h],writer:de[h]||de.default}}var gn={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},mn={array(E){let t=JSON.parse(E);if(!Array.isArray(t))throw new TypeError("Expected array");return t},boolean(E){return!(E=="0"||E=="false")},number(E){return Number(E)},object(E){let t=JSON.parse(E);if(t===null||typeof t!="object"||Array.isArray(t))throw new TypeError("Expected object");return t},string(E){return E}},de={default:vn,array:pe,object:pe};function pe(E){return JSON.stringify(E)}function vn(E){return`${E}`}var Y=class{constructor(t){this.context=t}static get shouldLoad(){return!0}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:a=this.element,detail:h={},prefix:v=this.identifier,bubbles:f=!0,cancelable:d=!0}={}){let s=v?`${v}:${t}`:t,p=new CustomEvent(s,{detail:h,bubbles:f,cancelable:d});return a.dispatchEvent(p),p}};Y.blessings=[on,an,cn];Y.targets=[];Y.values={};var mt=class extends Y{connect(){window.addEventListener("trix-file-accept",E=>{E.preventDefault(),alert("File attachments are not supported at this time.")})}};Q(mt,"targets",[]);var me=St(fe()),ve=St(ge()),vt=class extends Y{connect(){if(this.searchKeyValue||(this.searchKeyValue="query"),this.modeValue||(this.modeValue=this.element.editor?"trix":"input"),!this.urlValue)return console.debug("Autocomplete needs both URL value (i.e. 'https://autocomplete.com')"),this.disconnect();this.initializeTribute(),this.listen()}disconnect(){this.tribute.detach(this.element)}initializeTribute(){this.tribute=new me.default({trigger:this.triggerValue||"@",allowSpaces:!0,lookup:"name",fillAttr:this.modeValue==="trix"?"value":"name",autocompleteMode:this.autoValue,replaceTextSuffix:", ",values:this._fetch.bind(this)}),this.tribute.attach(this.element),this.tribute.range.pasteHtml=this._pasteHTML.bind(this)}listen(){this.element.addEventListener("tribute-replaced",E=>{let t=E.detail.item.original;this.modeValue==="trix"&&this._insertTrixAttachment(t)})}_fetch(E,t){let a=new URLSearchParams;a.append(this.searchKeyValue,E),fetch(`${this.urlValue}?${a}`).then(h=>h.json()).then(h=>t(h)).catch(t([]))}_insertTrixAttachment(E){let t=new ve.default.Attachment({sgid:E.sgid,content:E.content});this.element.editor.insertAttachment(t),this.element.editor.insertString("")}_pasteHTML(E,t,a){let v=this.element.editor.getSelectedRange()[0],f=a-t;this.element.editor.setSelectedRange([v-f,v]),this.element.editor.deleteInDirection("backward")}};Q(vt,"values",{url:String,searchKey:String,mode:String,trigger:String,auto:Boolean});var yt=class{constructor(t){this.response=t}get statusCode(){return this.response.status}get redirected(){return this.response.redirected}get ok(){return this.response.ok}get unauthenticated(){return this.statusCode===401}get authenticationURL(){return this.response.headers.get("WWW-Authenticate")}get contentType(){return(this.response.headers.get("Content-Type")||"").replace(/;.*$/,"")}get headers(){return this.response.headers}get html(){return this.contentType.match(/^(application|text)\/(html|xhtml\+xml)$/)?this.text:Promise.reject(new Error(`Expected an HTML response but got "${this.contentType}" instead`))}get json(){return this.contentType.match(/^application\/json/)?this.responseJson||(this.responseJson=this.response.json()):Promise.reject(new Error(`Expected a JSON response but got "${this.contentType}" instead`))}get text(){return this.responseText||(this.responseText=this.response.text())}get isTurboStream(){return this.contentType.match(/^text\/vnd\.turbo-stream\.html/)}async renderTurboStream(){if(this.isTurboStream)window.Turbo?window.Turbo.renderStreamMessage(await this.text):console.warn("You must set `window.Turbo = Turbo` to automatically process Turbo Stream events with request.js");else return Promise.reject(new Error(`Expected a Turbo Stream response but got "${this.contentType}" instead`))}};var bt=class{static register(t){this.interceptor=t}static get(){return this.interceptor}static reset(){this.interceptor=void 0}};function ye(E){let t=document.cookie?document.cookie.split("; "):[],a=`${encodeURIComponent(E)}=`,h=t.find(v=>v.startsWith(a));if(h){let v=h.split("=").slice(1).join("=");if(v)return decodeURIComponent(v)}}function be(E){let t={};for(let a in E){let h=E[a];h!==void 0&&(t[a]=h)}return t}function _t(E){let t=document.head.querySelector(`meta[name="${E}"]`);return t&&t.content}function Ae(E){return[...E].reduce((t,[a,h])=>t.concat(typeof h=="string"?[[a,h]]:[]),[])}function we(E,t){for(let[a,h]of t)h instanceof window.File||(E.has(a)?(E.delete(a),E.set(a,h)):E.append(a,h))}var At=class{constructor(t,a,h={}){this.method=t,this.options=h,this.originalUrl=a}async perform(){try{let a=bt.get();a&&await a(this)}catch(a){console.error(a)}let t=new yt(await window.fetch(this.url,this.fetchOptions));return t.unauthenticated&&t.authenticationURL?Promise.reject(window.location.href=t.authenticationURL):(t.ok&&t.isTurboStream&&t.renderTurboStream(),t)}addHeader(t,a){let h=this.additionalHeaders;h[t]=a,this.options.headers=h}get fetchOptions(){return{method:this.method.toUpperCase(),headers:this.headers,body:this.formattedBody,signal:this.signal,credentials:"same-origin",redirect:this.redirect}}get headers(){return be(Object.assign({"X-Requested-With":"XMLHttpRequest","X-CSRF-Token":this.csrfToken,"Content-Type":this.contentType,Accept:this.accept},this.additionalHeaders))}get csrfToken(){return ye(_t("csrf-param"))||_t("csrf-token")}get contentType(){return this.options.contentType?this.options.contentType:this.body==null||this.body instanceof window.FormData?void 0:this.body instanceof window.File?this.body.type:"application/json"}get accept(){switch(this.responseKind){case"html":return"text/html, application/xhtml+xml";case"turbo-stream":return"text/vnd.turbo-stream.html, text/html, application/xhtml+xml";case"json":return"application/json";default:return"*/*"}}get body(){return this.options.body}get query(){let t=(this.originalUrl.split("?")[1]||"").split("#")[0],a=new URLSearchParams(t),h=this.options.query;h instanceof window.FormData?h=Ae(h):h instanceof window.URLSearchParams?h=h.entries():h=Object.entries(h||{}),we(a,h);let v=a.toString();return v.length>0?`?${v}`:""}get url(){return this.originalUrl.split("?")[0]+this.query}get responseKind(){return this.options.responseKind||"html"}get signal(){return this.options.signal}get redirect(){return this.options.redirect||"follow"}get additionalHeaders(){return this.options.headers||{}}get formattedBody(){let t=Object.prototype.toString.call(this.body)==="[object String]";return this.headers["Content-Type"]==="application/json"&&!t?JSON.stringify(this.body):this.body}};async function Pt(E,t){return new At("get",E,t).perform()}var ht=class extends Y{change(E){let t=new URLSearchParams;t.append(this.paramValue,E.target.selectedOptions[0].value),t.append("target",this.selectTarget.id),Pt(`${this.urlValue}?${t}`,{responseKind:"turbo-stream"})}};Q(ht,"targets",["select"]),Q(ht,"values",{url:String,param:String});var wt=class extends Y{connect(){this.setNetworkStatus(),window.addEventListener("offline",()=>this.setNetworkStatus()),window.addEventListener("online",()=>this.setNetworkStatus())}setNetworkStatus(){this.indicatorTarget.classList.toggle("hidden",navigator.onLine)}};Q(wt,"targets",["indicator"]);var Ct=class extends Y{connect(){this.sourceTarget.addEventListener("input",this.sync.bind(this)),this.outputTargets.forEach(E=>E.textContent=this.sourceTarget.value)}sync(E){this.outputTargets.forEach(t=>t.textContent=E.target.value)}};Q(Ct,"targets",["source","output"]);var ut=class extends Y{connect(){this.sourceTarget.addEventListener("input",this.sync.bind(this)),this.sync()}sync(E){this.outputTargets.forEach(t=>{let a=this.wordModeValue?this.sourceTarget.value.split(" "):this.sourceTarget.value;t.textContent=`${a.length} ${this.wordModeValue?"words":"characters"}`,a.length>this.limitValue?t.classList.add(...this.errorClasses):t.classList.remove(...this.errorClasses)})}};Q(ut,"targets",["source","output"]),Q(ut,"classes",["error"]),Q(ut,"values",{limit:Number,wordMode:Boolean});var xt=class extends Y{get shouldEnable(){return this.hasToggleTarget?!0:(console.debug("No toggle component found for theme controller"),!1)}connect(){this.loadTheme(),!!this.shouldEnable&&(this.theme=localStorage.theme,this.themeTarget.classList=[this.theme])}toggleTheme(E){this.theme=E.target.value,localStorage.theme=this.theme,this.themeTarget.classList=[this.theme]}loadTheme(){this.theme=localStorage.theme,this.themeTarget.classList=[this.theme],this.hasToggleTarget&&(this.toggleTarget.value=this.theme)}};Q(xt,"targets",["theme","toggle"]);window.Stimulus=lt.start();Stimulus.register("attachment-blocker",mt);Stimulus.register("autocomplete",vt);Stimulus.register("dynamic-select",ht);Stimulus.register("offline",wt);Stimulus.register("reactive-text",Ct);Stimulus.register("text-counter",ut);Stimulus.register("theme",xt);})();
